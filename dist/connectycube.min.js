/*! For license information please see connectycube.min.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("node-fetch"),require("form-data")):"function"==typeof define&&define.amd?define(["node-fetch","form-data"],t):"object"==typeof exports?exports.ConnectyCube=t(require("node-fetch"),require("form-data")):e.ConnectyCube=t(e["node-fetch"],e["form-data"])}(self,((e,t)=>(()=>{var r={1862:(e,t,r)=>{"use strict";e.exports.encode=function(e){return r.g.btoa(e)},e.exports.decode=function(e){return r.g.atob(e)}},5734:(e,t,r)=>{"use strict";const n=r(5251),i=r(7930),s=r(1192);e.exports.Client=n,e.exports.xml=i,e.exports.jid=s},5251:(e,t,r)=>{"use strict";const n=r(3073);class i extends n{constructor(e){super(e),this.transports=[]}send(e,...t){return this.Transport.prototype.send.call(this,e,...t)}sendMany(...e){return this.Transport.prototype.sendMany.call(this,...e)}_findTransport(e){return this.transports.find((t=>{try{return void 0!==t.prototype.socketParameters(e)}catch{return!1}}))}connect(e){const t=this._findTransport(e);if(!t)throw new Error("No compatible connection method found.");return this.Transport=t,this.Socket=t.prototype.Socket,this.Parser=t.prototype.Parser,super.connect(e)}socketParameters(...e){return this.Transport.prototype.socketParameters(...e)}header(...e){return this.Transport.prototype.header(...e)}headerElement(...e){return this.Transport.prototype.headerElement(...e)}footer(...e){return this.Transport.prototype.footer(...e)}footerElement(...e){return this.Transport.prototype.footerElement(...e)}}i.prototype.NS="jabber:client",e.exports=i},3073:(e,t,r)=>{"use strict";const{EventEmitter:n,promise:i}=r(3572),s=r(1192),a=r(7930),o=r(3611),{parseHost:c,parseService:u}=r(1473);class l extends n{constructor(e={}){super(),this.jid=null,this.timeout=2e3,this.options=e,this.socketListeners=Object.create(null),this.parserListeners=Object.create(null),this.status="offline",this.socket=null,this.parser=null,this.root=null}_reset(){this.jid=null,this.status="offline",this._detachSocket(),this._detachParser()}async _streamError(e,t){try{await this.send(a("stream:error",{},[a(e,{xmlns:"urn:ietf:params:xml:ns:xmpp-streams"},t)]))}catch{}return this._end()}_onData(e){const t=e.toString("utf8");this.emit("input",t),this.parser.write(t)}_onParserError(e){this._streamError("bad-format"),this._detachParser(),this.emit("error",e)}_attachSocket(e){this.socket=e;const t=this.socketListeners;t.data=this._onData.bind(this),t.close=(e,t)=>{this._reset(),this._status("disconnect",{clean:!e,event:t})},t.connect=()=>{this._status("connect")},t.error=e=>{this.emit("error",e)},this.socket.on("close",t.close),this.socket.on("data",t.data),this.socket.on("error",t.error),this.socket.on("connect",t.connect)}_detachSocket(){const{socketListeners:e,socket:t}=this;for(const r of Object.getOwnPropertyNames(e))t.removeListener(r,e[r]),delete e[r];return this.socket=null,t}_onElement(e){const t=e.is("error","http://etherx.jabber.org/streams");t&&this._onStreamError(e),this.emit("element",e),this.emit(this.isStanza(e)?"stanza":"nonza",e),t&&this._end()}_onStreamError(e){const t=o.fromElement(e);if("see-other-host"===t.condition)return this._onSeeOtherHost(t);this.emit("error",t)}async _onSeeOtherHost(e){const{protocol:t}=u(this.options.service),r=e.element.getChildText("see-other-host"),{port:n}=c(r);let s;s=n?`${t||"xmpp:"}//${r}`:(t?`${t}//`:"")+r;try{await i(this,"disconnect");const{domain:e,lang:t}=this.options;await this.connect(s),await this.open({domain:e,lang:t})}catch(e){this.emit("error",e)}}_attachParser(e){this.parser=e;const t=this.parserListeners;t.element=this._onElement.bind(this),t.error=this._onParserError.bind(this),t.end=e=>{this._detachParser(),this._status("close",e)},t.start=e=>{this._status("open",e)},this.parser.on("error",t.error),this.parser.on("element",t.element),this.parser.on("end",t.end),this.parser.on("start",t.start)}_detachParser(){const e=this.parserListeners;for(const t of Object.getOwnPropertyNames(e))this.parser.removeListener(t,e[t]),delete e[t];this.parser=null}_jid(e){return this.jid=s(e),this.jid}_status(e,...t){this.status=e,this.emit("status",e,...t),this.emit(e,...t)}async _end(){let e;try{e=await this.close()}catch{}try{await this.disconnect()}catch{}return e}async start(){if("offline"!==this.status)throw new Error("Connection is not offline");const{service:e,domain:t,lang:r}=this.options;await this.connect(e);const n=i(this,"online");return await this.open({domain:t,lang:r}),n}async connect(e){this._status("connecting",e);const t=new this.Socket;return this._attachSocket(t),t.connect(this.socketParameters(e)),i(t,"connect")}async disconnect(e=this.timeout){this.socket&&this._status("disconnecting"),this.socket.end(),await i(this.socket,"close","error",e)}async open(e){this._status("opening"),"string"==typeof e&&(e={domain:e});const{domain:t,lang:r,timeout:n=this.timeout}=e,s=this.headerElement();return s.attrs.to=t,s.attrs["xml:lang"]=r,this.root=s,this._attachParser(new this.Parser),await this.write(this.header(s)),i(this,"open","error",n)}async stop(){const e=await this._end();return"offline"!==this.status&&this._status("offline",e),e}async close(e=this.timeout){const t=this.footer(this.footerElement()),r=Promise.all([i(this.parser,"end","error",e),this.write(t)]);this.parser&&this.socket&&this._status("closing");const[n]=await r;return this.root=null,n}async restart(){this._detachParser();const{domain:e,lang:t}=this.options;return this.open({domain:e,lang:t})}async send(e){e.parent=this.root,await this.write(e.toString()),this.emit("send",e)}sendReceive(e,t=this.timeout){return Promise.all([this.send(e),i(this,"element","error",t)]).then((([,e])=>e))}write(e){return new Promise(((t,r)=>{"closing"!==this.status?this.socket.write(e,(n=>{if(n)return r(n);this.emit("output",e),t()})):r(new Error("Connection is closing"))}))}isStanza(e){const{name:t}=e;return"iq"===t||"message"===t||"presence"===t}isNonza(e){return!this.isStanza(e)}header(e){return e.toString()}headerElement(){return new a.Element("",{version:"1.0",xmlns:this.NS})}footer(e){return e.toString()}footerElement(){}socketParameters(){}}l.prototype.NS="",l.prototype.Socket=null,l.prototype.Parser=null,e.exports=l},3611:(e,t,r)=>{"use strict";const n=r(2649);e.exports=class extends n{constructor(...e){super(...e),this.name="StreamError"}}},1473:e=>{"use strict";function t(e){let{port:t,hostname:r,protocol:n}=new URL(e);return"[::1]"===r&&(r="::1"),{port:t,hostname:r,protocol:n}}function r(e){const{port:r,hostname:n}=t(`http://${e}`);return{port:r,hostname:n}}Object.assign(e.exports,{parseURI:t,parseHost:r,parseService:function(e){return e.includes("://")?t(e):r(e)}})},2649:e=>{"use strict";class t extends Error{constructor(e,t,r){super(e+(t?` - ${t}`:"")),this.name="XMPPError",this.condition=e,this.text=t,this.application=r}static fromElement(e){const[t,r,n]=e.children;let i,s;r&&(r.is("text")?i=r:r&&(s=r),n&&(s=n));const a=new this(t.name,i?i.text():"",s);return a.element=e,a}}e.exports=t},3572:(e,t,r)=>{"use strict";const n=r(7788),i=r(9639),s=r(6585),a=r(7989),o=r(7007),c=r(4845);t.EventEmitter=o,t.timeout=n,t.delay=i,t.TimeoutError=s,t.promise=a,t.Deferred=c},4845:e=>{"use strict";e.exports=function(){this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}},6585:e=>{"use strict";e.exports=class extends Error{constructor(e){super(e),this.name="TimeoutError"}}},9639:e=>{"use strict";e.exports=function(e){let t;const r=new Promise((r=>{t=setTimeout(r,e)}));return r.timeout=t,r}},7989:(e,t,r)=>{"use strict";const n=r(6585);e.exports=function(e,t,r="error",i){return new Promise(((s,a)=>{let o;const c=()=>{clearTimeout(o),e.removeListener(t,l),e.removeListener(r,u)};function u(e){a(e),c()}function l(e){s(e),c()}e.once(t,l),r&&e.once(r,u),i&&(o=setTimeout((()=>{c(),a(new n)}),i))}))}},7788:(e,t,r)=>{"use strict";const n=r(6585),i=r(9639);e.exports=function(e,t){const r=i(t);return Promise.race([e.finally((function(){clearTimeout(r.timeout)})),r.then((()=>{throw new n}))])}},1208:e=>{"use strict";e.exports=function(){let e;for(;!e;)e=Math.random().toString(36).slice(2,12);return e}},353:(e,t,r)=>{"use strict";const n=r(7930);function i({stanza:e}){return n("iq",{to:e.attrs.from,from:e.attrs.to,id:e.attrs.id})}function s(e,t,r){const n=i(e);return n.attrs.type="error",r&&n.append(r),n.append(t),n}function a(e,t){return n("error",{type:e},n(t,"urn:ietf:params:xml:ns:xmpp-stanzas"))}function o(e,t,r,n){return(i,s)=>i.type!==e|!i.element||!i.element.is(r,t)?s():n(i,s)}e.exports=function({middleware:e,entity:t}){return e.use(function(e){return async function(t,r){if(!function({name:e,type:t}){return"iq"===e&&"error"!==t&&"result"!==t}(t))return r();const{stanza:o}=t,c=o.getChildElements(),[u]=c;if(!function({type:e},t,r){return("get"===e||"set"===e)&&1===t.length&&!!r}(t,c,u))return s(t,a("modify","bad-request"),u);let l;t.element=u;try{l=await r()}catch(t){e.emit("error",t),l=a("cancel","internal-server-error")}return l||(l=a("cancel","service-unavailable")),l instanceof n.Element&&l.is("error")?s(t,l,u):function(e,t){const r=i(e);return r.attrs.type="result",t&&r.append(t),r}(t,l instanceof n.Element?l:void 0)}}(t)),{get(t,r,n){e.use(o("get",t,r,n))},set(t,r,n){e.use(o("set",t,r,n))}}}},3812:(e,t,r)=>{"use strict";const n=r(1208),i=r(6808),{Deferred:s}=r(3572),a=r(3572).timeout,o=r(7930);class c{constructor({entity:e,middleware:t}){this.handlers=new Map,this.entity=e,this.middleware=t}start(){this.middleware.use(this._route.bind(this))}_route({type:e,name:t,id:r,stanza:n},s){if(!function({name:e,type:t}){return"iq"===e&&("error"===t||"result"===t)}({name:t,type:e}))return s();const a=this.handlers.get(r);if(!a)return s();"error"===e?a.reject(i.fromElement(n.getChild("error"))):a.resolve(n),this.handlers.delete(r)}async request(e,t=3e4){e.attrs.id||(e.attrs.id=n());const r=new s;this.handlers.set(e.attrs.id,r);try{await this.entity.send(e),await a(r.promise,t)}catch(t){throw this.handlers.delete(e.attrs.id),t}return r.promise}_childRequest(e,t,r,...n){const{name:i,attrs:{xmlns:s}}=t;return this.request(o("iq",{type:e,to:r},t),...n).then((e=>e.getChild(i,s)))}async get(...e){return this._childRequest("get",...e)}async set(...e){return this._childRequest("set",...e)}}e.exports=function(...e){const t=new c(...e);return t.start(),t}},1192:(e,t,r)=>{"use strict";const n=r(3435),i=r(5294),s=r(1287);function a(...e){return e[1]||e[2]?new n(...e):s(...e)}e.exports=a.bind(),e.exports.jid=a,e.exports.JID=n,e.exports.equal=function(e,t){return e.equals(t)},e.exports.detectEscape=i.detect,e.exports.escapeLocal=i.escape,e.exports.unescapeLocal=i.unescape,e.exports.parse=s},3435:(e,t,r)=>{"use strict";const n=r(5294);class i{constructor(e,t,r){if("string"!=typeof t||!t)throw new TypeError("Invalid domain.");this.setDomain(t),this.setLocal("string"==typeof e?e:""),this.setResource("string"==typeof r?r:"")}[Symbol.toPrimitive](e){return"number"===e?NaN:this.toString()}toString(e){let t=this._domain;return this._local&&(t=this.getLocal(e)+"@"+t),this._resource&&(t=t+"/"+this._resource),t}bare(){return this._resource?new i(this._local,this._domain,null):this}equals(e){return this._local===e._local&&this._domain===e._domain&&this._resource===e._resource}setLocal(e,t){return(t=t||n.detect(e))&&(e=n.escape(e)),this._local=e&&e.toLowerCase(),this}getLocal(e=!1){let t=null;return t=e?n.unescape(this._local):this._local,t}setDomain(e){return this._domain=e.toLowerCase(),this}getDomain(){return this._domain}setResource(e){return this._resource=e,this}getResource(){return this._resource}}Object.defineProperty(i.prototype,"local",{get:i.prototype.getLocal,set:i.prototype.setLocal}),Object.defineProperty(i.prototype,"domain",{get:i.prototype.getDomain,set:i.prototype.setDomain}),Object.defineProperty(i.prototype,"resource",{get:i.prototype.getResource,set:i.prototype.setResource}),e.exports=i},5294:e=>{"use strict";e.exports.detect=function(e){return!!e&&-1!==e.replace(/\\20/g,"").replace(/\\22/g,"").replace(/\\26/g,"").replace(/\\27/g,"").replace(/\\2f/g,"").replace(/\\3a/g,"").replace(/\\3c/g,"").replace(/\\3e/g,"").replace(/\\40/g,"").replace(/\\5c/g,"").search(/[ "&'/:<>@\\]/g)},e.exports.escape=function(e){return null===e?null:e.replace(/^\s+|\s+$/g,"").replace(/\\/g,"\\5c").replace(/ /g,"\\20").replace(/"/g,"\\22").replace(/&/g,"\\26").replace(/'/g,"\\27").replace(/\//g,"\\2f").replace(/:/g,"\\3a").replace(/</g,"\\3c").replace(/>/g,"\\3e").replace(/@/g,"\\40")},e.exports.unescape=function(e){return null===e?null:e.replace(/\\20/g," ").replace(/\\22/g,'"').replace(/\\26/g,"&").replace(/\\27/g,"'").replace(/\\2f/g,"/").replace(/\\3a/g,":").replace(/\\3c/g,"<").replace(/\\3e/g,">").replace(/\\40/g,"@").replace(/\\5c/g,"\\")}},1287:(e,t,r)=>{"use strict";const n=r(3435);e.exports=function(e){let t,r;const i=e.indexOf("/");-1!==i&&(r=e.slice(i+1),e=e.slice(0,i));const s=e.indexOf("@");return-1!==s&&(t=e.slice(0,s),e=e.slice(s+1)),new n(t,e,r)}},5013:(e,t,r)=>{"use strict";const n=r(8287),i=r(6210),s=r(1600);function a(e,t,r){return i=>{const s=new r(e,i);return n(t)(s)}}function o(e){return(t,r)=>{r().then((t=>t&&e.send(t))).catch((t=>e.emit("error",t)))}}e.exports=function({entity:e}){const t=[o(e)],r=[],n=a(e,t,i),c=a(e,r,s);return e.on("element",n),e.hookOutgoing=c,{use:e=>(t.push(e),e),filter:e=>(r.push(e),e)}}},1354:e=>{"use strict";e.exports=class{constructor(e,t){this.stanza=t,this.entity=e;const{name:r,attrs:n}=t,{type:i,id:s}=n;this.name=r,this.id=s||"",this.type="message"===r?i||"normal":"presence"===r?i||"available":i||"",this.from=null,this.to=null,this.local="",this.domain="",this.resource=""}}},6210:(e,t,r)=>{"use strict";const n=r(1354),i=r(1192);e.exports=class extends n{constructor(e,t){super(e,t);const{jid:r,domain:n}=e,s=t.attrs.to||r&&r.toString(),a=t.attrs.from||n;s&&(this.to=new i(s)),a&&(this.from=new i(a),this.local=this.from.local,this.domain=this.from.domain,this.resource=this.from.resource)}}},1600:(e,t,r)=>{"use strict";const n=r(1354),i=r(1192);e.exports=class extends n{constructor(e,t){super(e,t);const{jid:r,domain:n}=e,s=t.attrs.from||r&&r.toString(),a=t.attrs.to||n;s&&(this.from=new i(s)),a&&(this.to=new i(a),this.local=this.to.local,this.domain=this.to.domain,this.resource=this.to.resource)}}},6808:(e,t,r)=>{"use strict";const n=r(2649);e.exports=class extends n{constructor(e,t,r,n){super(e,t,r),this.type=n,this.name="StanzaError"}static fromElement(e){const t=super.fromElement(e);return t.type=e.attrs.type,t}}},6826:(e,t,r)=>{"use strict";const{EventEmitter:n}=r(3572);class i extends n{constructor(e){super(),this.delay=1e3,this.entity=e,this._timeout=null}scheduleReconnect(){const{entity:e,delay:t,_timeout:r}=this;clearTimeout(r),this._timeout=setTimeout((async()=>{if("disconnect"===e.status)try{await this.reconnect()}catch{}}),t)}async reconnect(){const{entity:e}=this;this.emit("reconnecting");const{service:t,domain:r,lang:n}=e.options;await e.connect(t),await e.open({domain:r,lang:n}),this.emit("reconnected")}start(){const{entity:e}=this,t={};t.disconnect=()=>{this.scheduleReconnect()},this.listeners=t,e.on("disconnect",t.disconnect)}stop(){const{entity:e,listeners:t,_timeout:r}=this;e.removeListener("disconnect",t.disconnect),clearTimeout(r)}}e.exports=function({entity:e}){const t=new i(e);return t.start(),t}},7127:(e,t,r)=>{"use strict";const n=r(6119),{promise:i}=r(3572);async function s(e,t){if(0===t.length)throw new Error("Couldn't connect");const r=t.shift(),n=e._findTransport(r);if(!n)return s(e,t);e._status("connecting",r);const a=n.prototype.socketParameters(r),o=new n.prototype.Socket;try{o.connect(a),await i(o,"connect")}catch{return s(e,t)}e._attachSocket(o),o.emit("connect"),e.Transport=n,e.Socket=n.prototype.Socket,e.Parser=n.prototype.Parser}e.exports=function({entity:e}){const t=e.connect;e.connect=async function(r){if(!r||/:\/\//.test(r))return t.call(this,r);const i=function(e,t){return t.filter((t=>e._findTransport(t)))}(e,await async function(e){const t=await n(e,{srv:[{service:"xmpps-client",protocol:"tcp"},{service:"xmpp-client",protocol:"tcp"}]});return[...new Set(t.map((e=>e.uri)))]}(r));if(0===i.length)throw new Error("No compatible transport found.");try{await s(e,i)}catch(t){throw e._reset(),e._status("disconnect"),t}}}},8096:e=>{"use strict";function t(e){return e.startsWith("https")||e.startsWith("wss")}e.exports.U=function(e,r){let n,i;return n=t(e.uri)&&!t(r.uri)?-1:!t(e.uri)&&t(r.uri)?1:0,0!==n?n:(i=e.method===r.method?0:"websocket"===e.method?-1:"websocket"===r.method?1:"xbosh"===e.method?-1:"xbosh"===r.method?1:"httppoll"===e.method?-1:"httppoll"===r.method?1:0,0!==i?i:0)}},163:(e,t,r)=>{"use strict";const n=r.g.fetch||r(8849),i=r(3837),s=r(8096).U;e.exports.resolve=function(e){return n(`https://${e}/.well-known/host-meta`).then((e=>e.text())).then((e=>i(e).getChildren("Link").filter((e=>["urn:xmpp:alt-connections:websocket","urn:xmpp:alt-connections:httppoll","urn:xmpp:alt-connections:xbosh"].includes(e.attrs.rel))).map((({attrs:e})=>({rel:e.rel,href:e.href,method:e.rel.split(":").pop(),uri:e.href}))).sort(s))).catch((()=>[]))}},6119:(e,t,r)=>{"use strict";const n=r(2969),i=r(163);e.exports=function(...e){return Promise.all([n.resolve?n.resolve(...e):Promise.resolve([]),i.resolve(...e)]).then((([e,t])=>[...e,...t]))},n.resolve&&(e.exports.dns=n),e.exports.http=i},145:(e,t,r)=>{"use strict";const n=r(7930),i="urn:ietf:params:xml:ns:xmpp-bind";async function s(e,t,r){const s=await t.set(function(e){return n("bind",{xmlns:i},e&&n("resource",{},e))}(r)),a=s.getChildText("jid");return e._jid(a),a}e.exports=function({streamFeatures:e,iqCaller:t},r){e.use("bind",i,function({iqCaller:e},t){return async({entity:r},n)=>{await("function"==typeof t?t((t=>s(r,e,t))):s(r,e,t)),n()}}({iqCaller:t},r))}},7718:(e,t,r)=>{"use strict";const n=r(3481);e.exports=function(e){e.use(n)}},4767:(e,t,r)=>{"use strict";const n=r(1978);e.exports=function(e){e.use(n)}},7802:(e,t,r)=>{"use strict";const{encode:n,decode:i}=r(1862),s=r(401),a=r(7930),o=r(5591),c="urn:ietf:params:xml:ns:xmpp-sasl";async function u(e,t,r,o){const u=e.create([r]);if(!u)throw new Error("No compatible mechanism");const{domain:l}=t.options,d={username:null,password:null,server:l,host:l,realm:l,serviceType:"xmpp",serviceName:l,...o};return new Promise(((e,r)=>{const o=l=>{if(l.attrs.xmlns===c)if("challenge"!==l.name)"failure"===l.name?r(s.fromElement(l)):"success"===l.name&&e(),t.removeListener("nonza",o);else{u.challenge(i(l.text()));const e=u.response(d);t.send(a("response",{xmlns:c,mechanism:u.name},"string"==typeof e?n(e):""))}};t.on("nonza",o),u.clientFirst&&t.send(a("auth",{xmlns:c,mechanism:u.name},n(u.response(d))))}))}e.exports=function({streamFeatures:e},t){const r=new o;return e.use("mechanisms",c,(async({stanza:e,entity:n})=>{const i=e.getChild("mechanisms",c).children.map((e=>e.text())),s=r._mechs.map((({name:e})=>e)).filter((e=>i.includes(e)));let a=s[0];"function"==typeof t?await t((e=>u(r,n,a,e)),a):(t.username||t.password||(a="ANONYMOUS"),await u(r,n,a,t)),await n.restart()})),{use:(...e)=>r.use(...e)}}},401:(e,t,r)=>{"use strict";const n=r(2649);e.exports=class extends n{constructor(...e){super(...e),this.name="SASLError"}}},9717:(e,t,r)=>{"use strict";const n=r(7930),i="urn:ietf:params:xml:ns:xmpp-session";e.exports=function({iqCaller:e,streamFeatures:t}){t.use("session",i,(async(t,r,s)=>(s.getChild("optional")||await e.set(n("session",i)),r())))}},3323:(e,t,r)=>{"use strict";const n=r(7342);e.exports=function({middleware:e}){return e.use(n()),{use:function(t,r,n){return e.use(((e,i)=>{const{stanza:s}=e;if(!s.is("features","http://etherx.jabber.org/streams"))return i();const a=s.getChild(t,r);return a?n(e,i,a):i()}))}}}},7342:e=>{"use strict";e.exports=function(){return async({stanza:e,entity:t},r)=>{if(!e.is("features","http://etherx.jabber.org/streams"))return r();!await r()&&t.jid&&t._status("online",t.jid)}}},3312:(e,t,r)=>{"use strict";const n=r(6174);e.exports=function({entity:e}){e.transports.push(n)}},6174:(e,t,r)=>{"use strict";const n=r(47),i=r(3073),s=r(7930),a=r(9558),o="urn:ietf:params:xml:ns:xmpp-framing";class c extends i{send(e,...t){return!e.attrs.xmlns&&super.isStanza(e)&&(e.attrs.xmlns="jabber:client"),super.send(e,...t)}async sendMany(e){for(const t of e)await this.send(t)}footerElement(){return new s.Element("close",{xmlns:o})}headerElement(){const e=super.headerElement();return e.name="open",e.attrs.xmlns=o,e}socketParameters(e){return/^wss?:\/\//.test(e)?e:void 0}}c.prototype.Socket=n,c.prototype.NS="jabber:client",c.prototype.Parser=a,e.exports=c},9558:(e,t,r)=>{"use strict";const{Parser:n,Element:i,XMLError:s}=r(7930);e.exports=class extends n{onStartElement(e,t){const r=new i(e,t),{cursor:n}=this;n&&n.append(r),this.cursor=r}onEndElement(e){const{cursor:t}=this;e===t.name?t.parent?this.cursor=t.parent:(t.is("open","urn:ietf:params:xml:ns:xmpp-framing")?this.emit("start",t):t.is("close","urn:ietf:params:xml:ns:xmpp-framing")?this.emit("end",t):this.emit("element",t),this.cursor=null):this.emit("error",new s(`${t.name} must be closed.`))}}},47:(e,t,r)=>{"use strict";const n=r(732),i=r.g.WebSocket||n,s=r(7007),a="ECONNERROR";e.exports=class extends s{constructor(){super(),this.listeners=Object.create(null)}connect(e){this.url=e,this._attachSocket(new i(e,["xmpp"]))}_attachSocket(e){this.socket=e;const{listeners:t}=this;t.open=()=>{this.emit("connect")},t.message=({data:e})=>this.emit("data",e),t.error=e=>{const{url:t}=this;let{error:r}=e;r||(r=new Error(`WebSocket ${a} ${t}`),r.errno=a,r.code=a),r.event=e,r.url=t,this.emit("error",r)},t.close=e=>{this._detachSocket(),this.emit("close",!e.wasClean,e)},this.socket.addEventListener("open",t.open),this.socket.addEventListener("message",t.message),this.socket.addEventListener("error",t.error),this.socket.addEventListener("close",t.close)}_detachSocket(){delete this.url;const{socket:e,listeners:t}=this;for(const r of Object.getOwnPropertyNames(t))e.removeEventListener(r,t[r]),delete t[r];delete this.socket}end(){this.socket.close()}write(e,t){i===n?this.socket.send(e,t):(this.socket.send(e),t())}}},7930:(e,t,r)=>{"use strict";const n=r(9022),i=r(7830),s=r(4063),{escapeXML:a,unescapeXML:o,escapeXMLText:c,unescapeXMLText:u}=r(611),l=r(2037);e.exports=function(...e){return i(...e)},Object.assign(e.exports,{Element:n,createElement:i,Parser:s,escapeXML:a,unescapeXML:o,escapeXMLText:c,unescapeXMLText:u,XMLError:l})},4063:(e,t,r)=>{"use strict";const n=r(9573),i=r(9022),s=r(7007),a=r(2037);class o extends s{constructor(){super();const e=new n;this.root=null,this.cursor=null,e.on("startElement",this.onStartElement.bind(this)),e.on("endElement",this.onEndElement.bind(this)),e.on("text",this.onText.bind(this)),this.parser=e}onStartElement(e,t){const r=new i(e,t),{root:n,cursor:s}=this;n?s!==n&&s.append(r):(this.root=r,this.emit("start",r)),this.cursor=r}onEndElement(e){const{root:t,cursor:r}=this;if(e===r.name){if(r!==t)return r.parent?void(this.cursor=r.parent):(r.parent=t,this.emit("element",r),void(this.cursor=t));this.emit("end",t)}else this.emit("error",new a(`${r.name} must be closed.`))}onText(e){const{cursor:t}=this;t?t.t(e):this.emit("error",new a(`${e} must be a child.`))}write(e){this.parser.write(e)}end(e){e&&this.parser.write(e)}}o.XMLError=a,e.exports=o},2037:e=>{"use strict";e.exports=class extends Error{constructor(...e){super(...e),this.name="XMLError"}}},3837:(e,t,r)=>{"use strict";const n=r(4063);e.exports=function(e){const t=new n;let r=null,i=null;if(t.on("start",(e=>{r=e})),t.on("element",(e=>{r.append(e)})),t.on("error",(e=>{i=e})),t.write(e),t.end(),i)throw i;return r}},3091:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(3532),o=r(5842),c=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.proxy=t}),[{key:"uploadAddressBook",value:function(e,t){if(a.isArray(e)){var r={contacts:e};t&&(t.force&&(r.force=t.force),t.udid&&(r.udid=t.udid));var n={type:"POST",url:a.getUrl(o.urls.addressbook),data:r};return this.proxy.ajax(n)}new Error("First parameter must be an Array.")}},{key:"get",value:function(e){var t={type:"GET",url:a.getUrl(o.urls.addressbook)};return e&&(t.data={udid:e}),this.proxy.ajax(t)}},{key:"getRegisteredUsers",value:function(e){var t={type:"GET",url:a.getUrl(o.urls.addressbookRegistered)};return e&&(t.data={compact:1}),this.proxy.ajax(t)}}])}();e.exports=c},2934:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(5842),o=r(3532),c=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.proxy=t,this.webSessionCheckInterval=null}),[{key:"setSession",value:function(e){this.proxy.setSession(e)}},{key:"getSession",value:function(){var e=this,t={type:"GET",url:o.getUrl(a.urls.session)};return new Promise((function(r,n){e.proxy.ajax(t).then((function(e){r(e.session)})).catch((function(e){n(e)}))}))}},{key:"createSession",value:function(e){var t=this;if(""===a.creds.appId||""===a.creds.authKey||""===a.creds.authSecret)throw new Error("Cannot create a new session without app credentials (app ID, auth key and auth secret)");var r=e&&e.hasOwnProperty("long")?a.urls.webSession:a.urls.session,n=o.generateCreateSessionParams(e);n.signature=o.signParams(n,a.creds.authSecret);var i={type:"POST",url:o.getUrl(r),data:n};return new Promise((function(e,r){t.proxy.ajax(i).then((function(r){var n=r.qr_code?r.qr_code:r.session;t.proxy.setSession(r.session),t.proxy.setCurrentUserId(r.session.user_id),e(n)})).catch((function(e){r(e)}))}))}},{key:"destroySession",value:function(){var e=this,t={type:"DELETE",url:o.getUrl(a.urls.session),dataType:"text"};return new Promise((function(r,n){e.proxy.ajax(t).then((function(t){e.proxy.setSession(null),e.proxy.setCurrentUserId(null),r()})).catch((function(e){n(e)}))}))}},{key:"createWebSession",value:function(e){return e||(e={long:0}),this.createSession(e)}},{key:"checkWebSessionUntilUpgrade",value:function(e){var t=this,r=a.webSession.getSessionTimeInterval,n=new Error("The web session check interval was stopped (timeout)"),i=a.webSession.getSessionTimeout,s=function(){t.webSessionCheckInterval&&clearInterval(t.webSessionCheckInterval)};return s(),this.webSessionCheckInterval=setInterval((function(){t.getSession().then((function(a){0!==a.user_id?(s(),t.proxy.setCurrentUserId(a.user_id),t.proxy.setSession(a),e(null,a)):i>r?i-=r:(s(),e(n,null))})).catch((function(t){s(),e(t,null)}))}),1e3*r),this.webSessionCheckInterval}},{key:"upgradeWebSession",value:function(e){var t={type:"PATCH",url:o.getUrl(a.urls.webSession),dataType:"text",data:{web_token:e}};return this.proxy.ajax(t)}},{key:"login",value:function(e){var t=this,r={type:"POST",url:o.getUrl(a.urls.login),data:e};return new Promise((function(e,n){t.proxy.ajax(r).then((function(r){t.proxy.setCurrentUserId(r.user.id),e(r.user)})).catch((function(e){n(e)}))}))}},{key:"logout",value:function(){var e={type:"DELETE",url:o.getUrl(a.urls.login),dataType:"text"};return this.proxy.setCurrentUserId(null),this.proxy.ajax(e)}}])}();e.exports=c},5842:(e,t,r)=>{"use strict";var n=r(4994)(r(3738)),i={version:r(8330).rE,creds:{appId:"",authKey:"",authSecret:""},endpoints:{api:"api.connectycube.com",chat:"chat.connectycube.com",muc:"muc.chat.connectycube.com"},hash:"sha1",chatProtocol:{bosh:"https://chat.connectycube.com:5281",websocket:"wss://chat.connectycube.com:5291",active:2},webSession:{getSessionTimeInterval:3,getSessionTimeout:120},chat:{contactList:{subscriptionMode:{mutual:!0}},streamManagement:{enable:!1},ping:{enable:!1,timeInterval:60},reconnect:{enable:!0,timeInterval:5}},videochat:{alwaysRelayCalls:!1,answerTimeInterval:60,dialingTimeInterval:5,disconnectTimeInterval:30,statsReportTimeInterval:!1,iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:turn.connectycube.com"},{urls:"turn:turn.connectycube.com:5349?transport=udp",username:"connectycube",credential:"4c29501ca9207b7fb9c4b4b6b04faeb1"},{urls:"turn:turn.connectycube.com:5349?transport=tcp",username:"connectycube",credential:"4c29501ca9207b7fb9c4b4b6b04faeb1"}]},conference:{server:"wss://janus.connectycube.com:8989"},whiteboard:{server:"https://whiteboard.connectycube.com"},urls:{session:"session",webSession:"session/web",login:"login",users:"users",chat:"chat",blobs:"blobs",subscriptions:"subscriptions",events:"events",data:"data",addressbook:"address_book",addressbookRegistered:"address_book/registered_users",meetings:"meetings",whiteboards:"whiteboards",calls:"calls",type:".json"},on:{sessionExpired:null,xmppDataWrite:null,xmppDataRead:null},timeout:null,debug:{mode:0},set:function(e){"object"===(0,n.default)(e.endpoints)&&e.endpoints.chat&&(i.endpoints.muc="muc."+e.endpoints.chat,i.chatProtocol.bosh="https://"+e.endpoints.chat+":5281",i.chatProtocol.websocket="wss://"+e.endpoints.chat+":5291"),Object.keys(e).forEach((function(t){"set"!==t&&i.hasOwnProperty(t)&&("object"!==(0,n.default)(e[t])?i[t]=e[t]:Object.keys(e[t]).forEach((function(r){i[t].hasOwnProperty(r)&&(i[t][r]=e[t][r])})))}))}};e.exports=i},6248:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(7383)),a=n(r(4579));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}var c=r(5842),u=r(3532),l=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.proxy=t}),[{key:"create",value:function(e,t){var r={type:"POST"};return u.isArray(t)?(r.url=u.getUrl(c.urls.data,"".concat(e,"/multi")),r.data={record:{}},t.forEach((function(e,t){return r.data.record[t]=e}))):(r.url=u.getUrl(c.urls.data,e),r.data=t),this.proxy.ajax(r)}},{key:"list",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={};return"string"==typeof t?r.url=u.getUrl(c.urls.data,"".concat(e,"/").concat(t)):u.isArray(t)?r.url=u.getUrl(c.urls.data,"".concat(e,"/").concat(t.toString())):u.isObject(t)&&(r.url=u.getUrl(c.urls.data,e),r.data=t),this.proxy.ajax(r)}},{key:"readPermissions",value:function(e,t){var r={url:u.getUrl(c.urls.data,"".concat(e,"/").concat(t)),data:{permissions:1}};return this.proxy.ajax(r)}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={type:"PUT"};return u.isArray(t)?(r.url=u.getUrl(c.urls.data,"".concat(e,"/multi")),r.data={record:{}},t.forEach((function(e,t){var n=e.id?e:function(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}({id:e._id},e);r.data.record[t+1]=n}))):t.search_criteria?(r.url=u.getUrl(c.urls.data,"".concat(e,"/by_criteria")),r.data=t):(r.url=u.getUrl(c.urls.data,"".concat(e,"/").concat(t._id||t.id)),r.data=t),this.proxy.ajax(r)}},{key:"delete",value:function(e,t){var r,n={type:"DELETE"};return"string"==typeof t?r=1:u.isArray(t)?r=t.length>1?2:1:u.isObject(t)&&(r=3),1===r?(n.url=u.getUrl(c.urls.data,"".concat(e,"/").concat(t)),n.dataType="text"):2===r?n.url=u.getUrl(c.urls.data,"".concat(e,"/").concat(t.toString())):3===r&&(n.url=u.getUrl(c.urls.data,"".concat(e,"/by_criteria")),n.data=t),this.proxy.ajax(n)}}])}();e.exports=l},4673:(e,t,r)=>{"use strict";var n,i,s,a,o,c,u,l,d,p,h,f,m=r(3532);m.getEnv().browser?(n=fetch,i=FormData,s=window.adapter,f=navigator,a=navigator.mediaDevices,o=window.MediaStream,c=window.MediaStreamTrack,d=window.RTCIceCandidate,u=window.RTCPeerConnection,l=window.RTCSessionDescription,p=window.RTCRtpReceiver,h=window.RTCRtpSender):m.getEnv().node&&(n=r(8849),i=r(6245)),e.exports={fetchImpl:n,formDataImpl:i,adapter:s,mediaDevices:a,MediaStream:o,MediaStreamTrack:c,RTCIceCandidate:d,RTCPeerConnection:u,RTCRtpReceiver:p,RTCRtpSender:h,RTCSessionDescription:l,navigator:f}},3532:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=n(r(3738)),o=r(5842),c="object"===("undefined"==typeof window?"undefined":(0,a.default)(window))&&"object"===("undefined"==typeof document?"undefined":(0,a.default)(document)),u="object"===("undefined"==typeof navigator?"undefined":(0,a.default)(navigator))&&"ReactNative"===navigator.product,l="object"===(void 0===r.g?"undefined":(0,a.default)(r.g))&&(void 0!==r.g.android||void 0!==r.g.NSObject),d="object"===("undefined"==typeof process?"undefined":(0,a.default)(process))&&"object"===(0,a.default)(process.versions)&&!!process.versions.node,p=void 0!==r.g.Expo,h=function(){return(0,s.default)((function e(){(0,i.default)(this,e)}),null,[{key:"getEnv",value:function(){return{nativescript:l,reactnative:u,browser:c,node:d,expo:p}}},{key:"isRNWebRTCAvailable",value:function(){if(u&&!p){var e=r(4673),t=e.RTCView,n=e.RTCPeerConnection,i=e.RTCIceCandidate,s=e.RTCSessionDescription,a=e.MediaStream,o=e.mediaDevices;return t&&n&&i&&s&&a&&o}return!1}},{key:"isWebRTCAvailable",value:function(){return u&&this.isRNWebRTCAvailable()||c&&window.RTCPeerConnection&&window.RTCIceCandidate&&window.RTCSessionDescription}},{key:"safeCallbackCall",value:function(){var e=arguments[0];if("function"==typeof e){for(var t,r=e.toString().split("(")[0].split(" ")[1],n=[],i=0;i<arguments.length;i++)n.push(arguments[i]);t=n.shift();try{t.apply(null,n)}catch(e){""===r?console.error("Error: "+e):console.error("Error in listener "+r+": "+e)}}}},{key:"randomNonce",value:function(){return Math.floor(1e4*Math.random())}},{key:"unixTime",value:function(){return Math.floor(Date.now()/1e3)}},{key:"getUrl",value:function(e,t,r){var n="".concat(t?"/"+t:"");return r="".concat(r?"/"+r:""),"https://".concat(o.endpoints.api,"/").concat(e).concat(n).concat(r).concat(o.urls.type)}},{key:"isArray",value:function(e){return"[object Array]"===Object.prototype.toString.call(e)}},{key:"isObject",value:function(e){return"[object Object]"===Object.prototype.toString.call(e)}},{key:"getBsonObjectId",value:function(){var e=this.unixTime().toString(16),t=(f.increment++).toString(16);return t>16777215&&(f.increment=0),"00000000".substr(0,8-e.length)+e+"000000".substr(0,6-f.machine.length)+f.machine+"0000".substr(0,4-f.pid.length)+f.pid+"000000".substr(0,6-t.length)+t}},{key:"DLog",value:function(){if(this.loggers)for(var e=0;e<this.loggers.length;++e)this.loggers[e](arguments);else{var t;this.loggers=[];var r=function(){return function(e){console.log.apply(console,Array.prototype.slice.call(e))}};if("object"===(0,a.default)(o.debug)&&("number"==typeof o.debug.mode?1==o.debug.mode&&(t=r(),this.loggers.push(t)):"object"===(0,a.default)(o.debug.mode)&&o.debug.mode.forEach((function(e){1===e&&(t=r(),this.loggers.push(t))}))),this.loggers)for(var n=0;n<this.loggers.length;++n)this.loggers[n](arguments)}}},{key:"isExpiredSessionError",value:function(e){try{return e&&401===e.code&&"Required session does not exist"===e.info.errors.base[0]}catch(e){return!1}}},{key:"mergeArrays",value:function(e,t){var r=this.cloneObject(e);e:for(var n=0;n<t.length;n++){for(var i=t[n],s=0;s<r.length;s++)if(i.user_id===r[s].user_id){r[s]=i;continue e}r.push(i)}return r}},{key:"toBase64",value:function(e){return this.getEnv().browser?btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(function(e,t){return String.fromCharCode("0x"+t)}))):this.getEnv().reactnative?r.g.encodeToBase64(e):Buffer.from(e).toString("base64")}},{key:"generateCreateSessionParams",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={application_id:o.creds.appId,auth_key:o.creds.authKey,nonce:this.randomNonce(),timestamp:e.timestamp||this.unixTime()};return e&&(e.guest?t.user=e:e.login&&e.password?t.user={login:e.login,password:e.password}:e.email&&e.password?t.user={email:e.email,password:e.password}:e.provider?(t.provider=e.provider,e.scope&&(t.scope=e.scope),e.keys&&e.keys.token&&(t.keys={token:e.keys.token}),e.keys&&e.keys.secret&&(t.keys.secret=e.keys.secret)):e.hasOwnProperty("long")&&(t.long=e.long)),t}},{key:"signParams",value:function(e,t){var n,i=Object.keys(e).map((function(t){return"object"===(0,a.default)(e[t])?Object.keys(e[t]).map((function(r){return t+"["+r+"]="+e[t][r]})).sort().join("&"):t+"="+e[t]})).sort().join("&");if("sha1"===o.hash)n=r(7327)(i,t).toString();else{if("sha256"!==o.hash)throw new Error("Unknown crypto standards, available sha1 or sha256");n=r(3793)(i,t).toString()}return n}},{key:"getSizeOfString",value:function(e){return new Blob([e]).size}},{key:"getDateSize",value:function(e){var t=0;if(e.body){var r=e.body;"string"!=typeof r&&(r=JSON.stringify(r)),t+=this.getSizeOfString(r)}return e.headers&&(t+=this.getSizeOfString(JSON.stringify(e.headers))),t}},{key:"callTrafficUsageCallback",value:function(e,t){"function"==typeof o.on[e]&&o.on[e](this.getDateSize(t))}},{key:"cloneObject",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];try{var r=JSON.stringify(e),n=t?r.replace(/null/g,'""'):r;return JSON.parse(n)}catch(t){return e}}}])}(),f={machine:Math.floor(16777216*Math.random()).toString(16),pid:Math.floor(32767*Math.random()).toString(16),increment:0};e.exports=h},3453:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3738)),s=n(r(7383)),a=n(r(4579)),o=r(5842),c=r(3532),u=function(){return(0,a.default)((function e(){(0,s.default)(this,e),c.getEnv().reactnative&&c.isWebRTCAvailable()&&(this.RTCView=r(4673).RTCView)}),[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;t&&"object"===(0,i.default)(t)&&o.set(t);var n=r(1238),s=r(2934),a=r(9154),u=r(4911),l=r(9818),d=r(6248),p=r(3091),h=r(4167),f=r(6473),m=r(6246),v=r(9659),g=r(2475);if(this.service=new n,this.auth=new s(this.service),this.users=new a(this.service),this.storage=new u(this.service),this.pushnotifications=new l(this.service),this.data=new d(this.service),this.addressbook=new p(this.service),this.chat=new h(this.service),this.chat.dialog=new f(this.service),this.chat.message=new m(this.service),this.meeting=new v(this.service),this.whiteboard=new g(this.service),this.utils=c,c.isWebRTCAvailable()){var y=r(6008),b=r(8860);this.videochat=new y(this.chat.xmppClient,this.service),this.videochatconference=new b(this.service),this.chat.webrtcSignalingProcessor=this.videochat.signalingProcessor}else this.videochat=null,this.videochatconference=null;e.token?(o.creds.appId=e.appId,this.service.setSession({token:e.token})):(o.creds.appId=e.appId,o.creds.authKey=e.authKey,o.creds.authSecret=e.authSecret)}},{key:"setSession",value:function(e){this.auth.setSession(e)}},{key:"getSession",value:function(){return this.auth.getSession()}},{key:"createSession",value:function(e){return this.auth.createSession(e)}},{key:"destroySession",value:function(){return this.auth.destroySession()}},{key:"createWebSession",value:function(e){return this.auth.createWebSession(e)}},{key:"checkWebSessionUntilUpgrade",value:function(e){return this.auth.checkWebSessionUntilUpgrade(e)}},{key:"upgradeWebSession",value:function(e){return this.auth.upgradeWebSession(e)}},{key:"login",value:function(e){return this.auth.login(e)}},{key:"logout",value:function(){return this.auth.logout()}}])}(),l=new u;l.ConnectyCube=u,e.exports=l},9659:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(7383)),a=n(r(4579));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=r(5842),l=r(3532),d=u.urls.meetings,p=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.proxy=t}),[{key:"get",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={type:"GET",url:l.getUrl(d),data:e};return this.proxy.ajax(t)}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=Math.ceil(Date.now()/1e3),r=t+3600,n={name:new Date(t).toLocaleString("en",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric"}),start_date:t,end_date:r,attendees:[],record:!1,chat:!1},i={type:"POST",url:l.getUrl(d),data:c(c({},n),e)};return this.proxy.ajax(i)}},{key:"update",value:function(e,t){var r={type:"PUT",url:l.getUrl(d,e),data:t};return this.proxy.ajax(r)}},{key:"delete",value:function(e){var t={type:"DELETE",url:l.getUrl(d,e),dataType:"text"};return this.proxy.ajax(t)}},{key:"getRecordings",value:function(e){var t={type:"GET",url:l.getUrl(d,"recordings/".concat(e))};return this.proxy.ajax(t)}}])}();e.exports=p},1238:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(7383)),a=n(r(4579));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=r(5842),l=r(3532),d=r(4673).fetchImpl,p=r(4673).formDataImpl,h=function(){return(0,a.default)((function e(){(0,s.default)(this,e),this.sdkInstance={config:u,session:null},this.currentUserId=null,this.requestsNumber=0,this.fetchImpl=d,this.abortControllersMap={}}),[{key:"setSession",value:function(e){this.sdkInstance.session=e,e&&e.user_id&&this.setCurrentUserId(e.user_id)}},{key:"getSession",value:function(){return this.sdkInstance.session}},{key:"setCurrentUserId",value:function(e){this.currentUserId=e}},{key:"getCurrentUserId",value:function(){return this.currentUserId}},{key:"logRequest",value:function(e,t){l.DLog("[Request][".concat(t,"]"),"".concat(e.type||"GET"," ").concat(e.url),e)}},{key:"logResponse",value:function(e,t){l.DLog("[Response][".concat(t,"]"),e)}},{key:"buildRequestAndURL",value:function(e){var t,r=!e.type||"GET"===e.type||"HEAD"===e.type,n=e.type&&("POST"===e.type||"PUT"===e.type),i=this.sdkInstance&&this.sdkInstance.session&&this.sdkInstance.session.token,s=-1===e.url.indexOf("s3.amazonaws.com"),a=!1===e.contentType,o=e.url,c={};return c.method=e.type||"GET",e.data&&(t=this.buildRequestBody(e,a,n),r?o+="?"+t:c.body=t),a||(c.headers={"Content-Type":n?"application/json;charset=utf-8":"application/x-www-form-urlencoded; charset=UTF-8"}),s&&(c.headers||(c.headers={}),c.headers["CB-SDK"]="JS "+u.version+" - Client",i&&(c.headers["CB-Token"]=i)),u.timeout&&(c.timeout=u.timeout),[c,o]}},{key:"buildRequestBody",value:function(e,t,r){var n,i=e.data,s=e.useArrayQuery;return t?(n=new p,Object.keys(i).forEach((function(t){e.fileToCustomObject&&"file"===t?n.append(t,i[t].data,i[t].name):n.append(t,e.data[t])}))):n=r?JSON.stringify(i):this.serializeQueryParams(i,null,s,0),n}},{key:"serializeQueryParams",value:function(e,t,r,n){n=n||0;var i=[],s=void 0;for(s in e){var a=this.encodeURIComponent(s);l.isArray(e)&&(a="");var o=t?t+"[".concat(a,"]"):a,c=e[s],u=l.isArray(c);u&&(r||0===n)||l.isObject(c)?i.push(this.serializeQueryParams(c,o,r,++n)):(c=u?c.sort().join(","):c,i.push("".concat(o,"=").concat(this.encodeURIComponent(c))))}return i.sort().join("&")}},{key:"encodeURIComponent",value:function(e){function t(t){return e.apply(this,arguments)}return t.toString=function(){return e.toString()},t}((function(e){return encodeURIComponent(e).replace(/[#$&+,/:;=?@\[\]]/g,(function(e){return"%"+e.charCodeAt(0).toString(16)}))}))},{key:"abortRequest",value:function(e){if(this.abortControllersMap[e]){var t=this.abortControllersMap[e].controllers||{};Object.values(t).forEach((function(e){e.abort()}))}}},{key:"processSuccessfulOrFailedRequest",value:function(e){if(this.abortControllersMap[e]){var t=this.abortControllersMap[e].controllers||{},r=Object.keys(t).length;this.abortControllersMap[e].doneRequestsCount?this.abortControllersMap[e].doneRequestsCount+=1:this.abortControllersMap[e].doneRequestsCount=1,this.abortControllersMap[e].doneRequestsCount===r&&delete this.abortControllersMap[e]}}},{key:"ajax",value:function(e){var t=this,r=++this.requestsNumber;return new Promise((function(n,i){t.logRequest(e,r);var s,a=t.buildRequestAndURL(e),o=a[0],u=a[1],l=e.abort_id;if(l){var p;if(t.abortControllersMap[l]){var h=t.abortControllersMap[l].controllers||[],f=Object.keys(h).length;t.abortControllersMap[l].controllers.push(new AbortController),p=f}else t.abortControllersMap[l]={controllers:[new AbortController]},p=0;var m=t.abortControllersMap[l].controllers[p].signal;o=c(c({},o),{},{signal:m})}d(u,o).then((function(t){return s=t,"text"===(e.dataType||"json")?s.text():s.json()})).then((function(a){t.processSuccessfulOrFailedRequest(l),s.ok?t.processAjaxResponse(a,n,r):t.processAjaxError(s,a,null,i,n,e,r)})).catch((function(a){t.processSuccessfulOrFailedRequest(l),t.processAjaxError(s," ",a,i,n,e,r)}))}))}},{key:"processAjaxResponse",value:function(e,t,r){var n=e&&" "!==e?e:"empty body";this.logResponse(n,r),t(e)}},{key:"processAjaxError",value:function(e,t,r,n,i,s,a){if(e||!r||r.code){var o=e&&(e.status||e.statusCode),c={code:e&&o||r&&r.code,info:(t&&"string"==typeof t&&" "!==t?JSON.parse(t):t)||r&&r.errno},d=t||r||t.errors;this.logResponse(d,a),-1===e.url.indexOf(u.urls.session)&&l.isExpiredSessionError(c)&&"function"==typeof u.on.sessionExpired?this.handleExpiredSessionResponse(c,null,n,i,s):n(c)}else n(r)}},{key:"handleExpiredSessionResponse",value:function(e,t,r,n,i){var s=this;u.on.sessionExpired((function(){e?r(e):n(t)}),(function(e){e&&(s.setSession(e),s.ajax(i).then(n).catch(r))}))}}])}();e.exports=h},9818:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(4579)),s=n(r(7383)),a=r(5842),o=r(3532),c=(0,i.default)((function e(t){(0,s.default)(this,e),this.proxy=t,this.subscriptions=new u(t),this.events=new l(t),this.base64Encode=function(e){return o.toBase64(e)}})),u=function(){return(0,i.default)((function e(t){(0,s.default)(this,e),this.proxy=t}),[{key:"create",value:function(e){var t={type:"POST",url:o.getUrl(a.urls.subscriptions),data:e};return this.proxy.ajax(t)}},{key:"list",value:function(){var e={type:"GET",url:o.getUrl(a.urls.subscriptions)};return this.proxy.ajax(e)}},{key:"delete",value:function(e){var t={type:"DELETE",dataType:"text",url:o.getUrl(a.urls.subscriptions,e)};return this.proxy.ajax(t)}}])}(),l=function(){return(0,i.default)((function e(t){(0,s.default)(this,e),this.proxy=t}),[{key:"create",value:function(e){var t={type:"POST",url:o.getUrl(a.urls.events),data:{event:e}};return this.proxy.ajax(t)}}])}();e.exports=c},4911:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(7383)),a=n(r(4579));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=r(5842),l=r(3532),d=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.proxy=t}),[{key:"list",value:function(e){var t={type:"GET",url:l.getUrl(u.urls.blobs),data:e};return this.proxy.ajax(t)}},{key:"create",value:function(e){var t={type:"POST",url:l.getUrl(u.urls.blobs),data:{blob:e}};return this.proxy.ajax(t)}},{key:"delete",value:function(e){var t={type:"DELETE",url:l.getUrl(u.urls.blobs,e),dataType:"text"};return this.proxy.ajax(t)}},{key:"createAndUpload",value:function(e){var t,r=this,n=e.file,i=e.public,s=e.name||n.name,a=e.size||n.size,o=e.type||n.type,u=e.abort_id,l={name:s,content_type:o,public:i};return this.create(l).then((function(e){var i=e.blob,s=p((t=i).blob_object_access.params),a={url:"".concat(s.protocol,"://").concat(s.authority).concat(s.path),data:{}};return u&&(a.abort_id=u),Object.keys(s.queryKey).forEach((function(e){a.data[e]=decodeURIComponent(s.queryKey[e])})),a.data.file=n,r.upload(a).then((function(){return t}))})).then((function(e){return r.markUploaded({id:e.id,size:a}).then((function(){return e}))})).then((function(e){return c(c({},e),{},{size:a})})).catch((function(e){if(t)return c(c({},t),{},{size:a})}))}},{key:"upload",value:function(e){var t=c(c({},e),{},{type:"POST",dataType:"text",contentType:!1});return this.proxy.ajax(t)}},{key:"markUploaded",value:function(e){var t={type:"PUT",url:l.getUrl(u.urls.blobs,e.id,"complete"),data:{size:e.size},dataType:"text"};return this.proxy.ajax(t)}},{key:"getInfo",value:function(e){var t={url:l.getUrl(u.urls.blobs,e)};return this.proxy.ajax(t)}},{key:"getFile",value:function(e){var t={url:l.getUrl(u.urls.blobs,e)};return this.proxy.ajax(t)}},{key:"getFileObject",value:function(e,t){var r={type:"GET",url:l.getUrl(u.urls.blobs,e,"object"),data:t};return this.proxy.ajax(r)}},{key:"update",value:function(e){var t={blob:{}};void 0!==e.name&&(t.blob.name=e.name);var r={url:l.getUrl(u.urls.blobs,e.id),data:t};return this.proxy.ajax(r)}},{key:"privateUrl",value:function(e){return"https://"+u.endpoints.api+"/blobs/"+e+"?token="+this.proxy.getSession().token}},{key:"publicUrl",value:function(e){return"https://"+u.endpoints.api+"/blobs/"+e}}])}();function p(e){for(var t=p.options,r=t.parser[t.strictMode?"strict":"loose"].exec(e),n={},i=14;i--;)n[t.key[i]]=r[i]||"";return n[t.q.name]={},n[t.key[12]].replace(t.q.parser,(function(e,r,i){r&&(n[t.q.name][r]=i)})),n}e.exports=d,p.options={strictMode:!1,key:["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"],q:{name:"queryKey",parser:/(?:^|&)([^&=]*)=?([^&]*)/g},parser:{strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/}}},9154:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3738)),s=n(r(7383)),a=n(r(4579)),o=r(5842),c=r(3532),u=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.proxy=t}),[{key:"getV2",value:function(e){var t={type:"GET",url:c.getUrl("".concat(o.urls.users,"/v2")),data:e,useArrayQuery:!0};return this.proxy.ajax(t)}},{key:"get",value:function(e){var t,r,n,i,s=c.cloneObject(e),a=[];s.order&&(s.order=(i=(n=s.order).field in l?"date":n.field in d?"number":"string",[n.sort,i,n.field].join(" "))),s&&s.filter&&(c.isArray(s.filter)?s.filter.forEach((function(e){r=p(e),a.push(r)})):(r=p(s.filter),a.push(r)),s.filter=a),"number"==typeof s?(t=s,s={}):s.login?t="by_login":s.full_name?t="by_full_name":s.facebook_id?t="by_facebook_id":s.twitter_id?t="by_twitter_id":s.phone?t="phone":s.email?t="by_email":s.tags?t="by_tags":s.external&&(t="external/"+s.external,s={});var u={type:"GET",url:c.getUrl(o.urls.users,t),data:s};return this.proxy.ajax(u)}},{key:"signup",value:function(e){var t={type:"POST",url:c.getUrl(o.urls.users),data:{user:e}};return this.proxy.ajax(t)}},{key:"update",value:function(e){var t={type:"PUT",url:c.getUrl(o.urls.users,this.proxy.getCurrentUserId()),data:{user:e}};return this.proxy.ajax(t)}},{key:"delete",value:function(){var e={type:"DELETE",url:c.getUrl(o.urls.users,this.proxy.getCurrentUserId()),dataType:"text"};return this.proxy.ajax(e)}},{key:"resetPassword",value:function(e){var t={type:"GET",url:c.getUrl(o.urls.users+"/password/reset"),data:{email:e},dataType:"text"};return this.proxy.ajax(t)}}])}();e.exports=u;var l=["created_at","updated_at","last_request_at"],d=["id","external_user_id"];function p(e){var t=c.cloneObject(e),r=l.includes(t.field)?"date":(0,i.default)(t.value);return c.isArray(t.value)&&("object"===r&&(r=(0,i.default)(t.value[0])),t.value=t.value.toString()),[r,t.field,t.param,t.value].join(" ")}},2475:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(5842),o=r(3532),c=a.urls.whiteboards,u=a.whiteboard.server,l=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.proxy=t}),[{key:"getURL",value:function(e){var t=e.id,r=e.title,n=e.username;return"".concat(u,"?whiteboardid=").concat(t,"&username=").concat(n,"&title=").concat(r)}},{key:"get",value:function(e){var t={type:"GET",url:o.getUrl(c),data:"string"==typeof e?{chat_dialog_id:e}:e};return this.proxy.ajax(t)}},{key:"create",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={type:"POST",url:o.getUrl(c),data:e};return this.proxy.ajax(t)}},{key:"update",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={type:"PUT",url:o.getUrl(c,e),data:t};return this.proxy.ajax(r)}},{key:"delete",value:function(e){var t={type:"DELETE",url:o.getUrl(c,e),dataType:"text"};return this.proxy.ajax(t)}}])}();e.exports=l},4167:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(5407)),s=n(r(3738)),a=n(r(7383)),o=n(r(4579)),c=r(5842),u=r(3532),l=r(3341),d=r(5626),p=r(7614),h=r(5093),f=r(117),m=r(9349),v=r(363),g=function(){return(0,o.default)((function e(t){var r=this;(0,a.default)(this,e),this.proxy=t,this.xmppClient=v.client({service:c.chatProtocol.websocket,credentials:function(e,t){return e({username:r.xmppClient.options.username,password:r.xmppClient.options.password})}}),this.webrtcSignalingProcessor=null,this.stanzasCallbacks={},this.earlyIncomingMessagesQueue=[],this.isConnected=!1,this._isConnecting=!1,this._isLogout=!1,this._isReconnect=!1,this._checkPingTimer=void 0,this.helpers=new d,this.dialog=null,this.message=null,this.webrtcSignalingProcessor=null,this.xmppClientListeners=[],this.connectPromise=null;var n={xmppClient:this.xmppClient,helpers:this.helpers,stanzasCallbacks:this.stanzasCallbacks};this.contactList=new h(n),this.privacylist=new f(n),this.muc=new m(n),c.chat.streamManagement.enable&&2===c.chatProtocol.active&&(this.streamManagement=new p,this._sentMessageCallback=function(e,t){"function"==typeof r.onSentMessageCallback&&(t?r.onSentMessageCallback(null,t):r.onSentMessageCallback(e))}),c.chat.reconnect.enable&&(this.xmppClient.reconnect.delay=1e3*c.chat.reconnect.timeInterval),this.onChatStatusListener=null,this.onConnectionErrorListener=null,this.onDisconnectedListener=null,this.onReconnectListener=null,this.onMessageListener=null,this.onSentMessageCallback=null,this.onSystemMessageListener=null,this.onMessageErrorListener=null,this.onMessageTypingListener=null,this.onMessageUpdateListener=null,this.onMessageDeleteListener=null,this.onMessageReactionsListener=null,this.onDeliveredStatusListener=null,this.onReadStatusListener=null,this.onLastUserActivityListener=null,this.onSubscribeListener=null,this.onConfirmSubscribeListener=null,this.onRejectSubscribeListener=null,this.onContactListListener=null,this.onJoinOccupant=null,this.onLeaveOccupant=null,this.onKickOccupant=null}),[{key:"connectionStatus",get:function(){return this.xmppClient.status}},{key:"connect",value:function(e){var t=this;return this.connectPromise=new Promise((function(r,n){if(u.DLog("[Chat]","Connect with parameter:",e),t._isConnecting)return u.DLog("[Chat]","Warning! Already in CONNECTING state"),void r();if(t.isConnected)return u.DLog("[Chat]","Warning! Chat is already connected!"),void r();t._isConnecting=!0,t._isLogout=!1,t.xmppClientListeners.forEach((function(e){t.xmppClient.removeListener(e.name,e.callback)}));var i=function(){u.DLog("[Chat]",t._isReconnect?"RECONNECTING":"CONNECTING")};t.xmppClient.on("connect",i),t.xmppClientListeners.push({name:"connect",callback:i});var a=function(){u.DLog("[Chat]","ONLINE"),t.startPingTimer(),t._postConnectActions(),r(),t.connectPromise=null};t.xmppClient.on("online",a),t.xmppClientListeners.push({name:"online",callback:a});var o=function(){u.DLog("[Chat]","OFFLINE")};t.xmppClient.on("offline",o),t.xmppClientListeners.push({name:"offline",callback:o});var d=function(){u.DLog("[Chat]","DISCONNECTED"),"function"==typeof t.onDisconnectedListener&&u.safeCallbackCall(t.onDisconnectedListener),c.chat.reconnect.enable?(t.isConnected=!1,t._isConnecting=!1):t.disconnect(),t.stopPingTimer()};t.xmppClient.on("disconnect",d),t.xmppClientListeners.push({name:"disconnect",callback:d});var p=function(e,r){u.DLog("[Chat]","status - ".concat(e),"object"===(0,s.default)(r)?JSON.stringify(r):""),"function"==typeof t.onChatStatusListener&&u.safeCallbackCall(t.onChatStatusListener,e)};t.xmppClient.on("status",p),t.xmppClientListeners.push({name:"status",callback:p});var h=function(e){if(e.is("message")&&!t.isConnected)return t.earlyIncomingMessagesQueue.push(e),void u.DLog("[Chat]","on 'stanza': enqueue incoming stanza (isConnected=false)");e.is("presence")?t._onPresence(e):e.is("iq")?t._onIQ(e):e.is("message")&&("headline"===e.attrs.type?t._onSystemMessageListener(e):"error"===e.attrs.type?t._onMessageErrorListener(e):t._onMessage(e))};t.xmppClient.on("stanza",h),t.xmppClientListeners.push({name:"stanza",callback:h});var f=function(e){u.DLog("[Chat]","ERROR:",e,{_isReconnect:t._isReconnect,connectPromise:!!t.connectPromise}),t.connectPromise?t._isReconnect||("SASLError"==e.name&&(e=e.condition),n(e),t.connectPromise=null):"function"==typeof t.onConnectionErrorListener&&u.safeCallbackCall(t.onConnectionErrorListener,e)};t.xmppClient.on("error",f),t.xmppClientListeners.push({name:"error",callback:f});var m=function(e){u.callTrafficUsageCallback("xmppDataWrite",{body:e}),u.DLog("[Chat]","SENT:",e)};t.xmppClient.on("output",m),t.xmppClientListeners.push({name:"output",callback:m});var v=function(e){u.callTrafficUsageCallback("xmppDataRead",{body:e}),u.DLog("[Chat]","RECV:",e)};t.xmppClient.on("input",v),t.xmppClientListeners.push({name:"input",callback:v}),t.xmppClient.options.username=l.buildUserJidLocalPart(e.userId),t.xmppClient.options.password=e.password,t.xmppClient.start().catch((function(e){console.error("[Chat] xmppClient.start error",e),t.connectPromise?(n(e),t.connectPromise=null):"function"==typeof t.onConnectionErrorListener&&u.safeCallbackCall(t.onConnectionErrorListener,e)}))})),this.connectPromise}},{key:"getContacts",value:function(){var e=this;return new Promise((function(t,r){e.contactList.get().then((function(r){e.contactList.contacts=r,t(r)})).catch((function(e){r(r)}))}))}},{key:"ping",value:function(){var e=this;return new Promise((function(t,r){var n={id:l.getUniqueId("ping"),to:c.endpoints.chat,type:"get"},i=l.createIqStanza(n);i.c("ping",{xmlns:"urn:xmpp:ping"}),e.stanzasCallbacks[n.id]=function(e){var n=l.getElement(e,"error");n?r(l.buildErrorFromXMPPErrorStanza(n)):t()},e.xmppClient.send(i)}))}},{key:"pingWithTimeout",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5e3;return Promise.race([this.ping(),new Promise((function(t,r){return setTimeout((function(){return r(new Error("Chat ping() timed out"))}),e)}))])}},{key:"startPingTimer",value:function(){var e=this;if(this.stopPingTimer(),c.chat.ping.enable){var t=c.chat.ping.timeInterval<30?30:c.chat.ping.timeInterval;this._checkPingTimer=setInterval((function(){e.ping()}),1e3*t)}}},{key:"stopPingTimer",value:function(){this._checkPingTimer&&(clearInterval(this._checkPingTimer),this._checkPingTimer=null)}},{key:"send",value:function(e,t){var r={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e),type:t.type?t.type:this.helpers.typeChat(e),id:t.id?t.id:u.getBsonObjectId()},n=l.createMessageStanza(r);return t.body&&n.c("body").t(t.body).up(),t.markable&&n.c("markable",{xmlns:"urn:xmpp:chat-markers:0"}).up(),t.extension&&(n.c("extraParams",{xmlns:"jabber:client"}),n=l.filledExtraParams(n,t.extension)),c.chat.streamManagement.enable?(t.id=r.id,this.xmppClient.send(n,t)):this.xmppClient.send(n),r.id}},{key:"sendSystemMessage",value:function(e,t){var r={type:"headline",id:t.id?t.id:u.getBsonObjectId(),to:this.helpers.jidOrUserId(e)},n=l.createMessageStanza(r);return t.body&&n.c("body").t(t.body).up(),t.extension&&(n.c("extraParams",{xmlns:"jabber:client"}).c("moduleIdentifier").t("SystemNotifications").up(),n=l.filledExtraParams(n,t.extension)),this.xmppClient.send(n),r.id}},{key:"sendIsTypingStatus",value:function(e){var t={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e),type:this.helpers.typeChat(e)},r=l.createMessageStanza(t);r.c("composing",{xmlns:"http://jabber.org/protocol/chatstates"}),this.xmppClient.send(r)}},{key:"sendIsStopTypingStatus",value:function(e){var t={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e),type:this.helpers.typeChat(e)},r=l.createMessageStanza(t);r.c("paused",{xmlns:"http://jabber.org/protocol/chatstates"}),this.xmppClient.send(r)}},{key:"sendDeliveredStatus",value:function(e){var t={type:"chat",from:this.helpers.getUserCurrentJid(),id:u.getBsonObjectId(),to:this.helpers.jidOrUserId(e.userId)},r=l.createMessageStanza(t);r.c("received",{xmlns:"urn:xmpp:chat-markers:0",id:e.messageId}).up(),r.c("extraParams",{xmlns:"jabber:client"}).c("dialog_id").t(e.dialogId),this.xmppClient.send(r)}},{key:"sendReadStatus",value:function(e){var t={type:"chat",from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e.userId),id:u.getBsonObjectId()},r=l.createMessageStanza(t);r.c("displayed",{xmlns:"urn:xmpp:chat-markers:0",id:e.messageId}).up(),r.c("extraParams",{xmlns:"jabber:client"}).c("dialog_id").t(e.dialogId),this.xmppClient.send(r)}},{key:"editMessage",value:function(e){var t={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e.to),type:this.helpers.typeChat(e.to),id:u.getBsonObjectId()},r=l.createMessageStanza(t);r.c("body").t(e.body).up(),r.c("replace",{xmlns:"urn:xmpp:message-correct:0",id:e.originMessageId,last:e.last?"true":"false"}).up(),r.c("extraParams",{xmlns:"jabber:client"}).c("dialog_id").t(e.dialogId),e.extension&&(r=l.filledExtraParams(r,e.extension)),this.xmppClient.send(r)}},{key:"deleteMessage",value:function(e){var t={from:this.helpers.getUserCurrentJid(),to:this.helpers.jidOrUserId(e.to),type:this.helpers.typeChat(e.to),id:u.getBsonObjectId()},r=l.createMessageStanza(t);r.c("remove",{xmlns:"urn:xmpp:message-delete:0",id:e.messageId}).up(),r.c("extraParams",{xmlns:"jabber:client"}).c("dialog_id").t(e.dialogId),this.xmppClient.send(r)}},{key:"getLastUserActivity",value:function(e){var t=this;return new Promise((function(r,n){var i={from:t.helpers.getUserCurrentJid(),id:l.getUniqueId("lastActivity"),to:t.helpers.jidOrUserId(e),type:"get"},s=l.createIqStanza(i);s.c("query",{xmlns:"jabber:iq:last"}),t.stanzasCallbacks[i.id]=function(e){var i=l.getElement(e,"error"),s=t._onLastActivityStanza(e),a=s.userId,o=s.seconds;i?n(l.buildErrorFromXMPPErrorStanza(e)):r({userId:a,seconds:o})},t.xmppClient.send(s)}))}},{key:"_onLastActivityStanza",value:function(e){var t=l.getAttr(e,"from"),r=this.helpers.getUserIdFromJID(t),n=l.getElement(e,"query"),i=+l.getAttr(n,"seconds");return u.safeCallbackCall(this.onLastUserActivityListener,r,i),{userId:r,seconds:i}}},{key:"markActive",value:function(){var e={id:this.helpers.getUniqueId("markActive"),type:"set"},t=l.createIqStanza(e);t.c("mobile",{xmlns:"http://tigase.org/protocol/mobile#v2",enable:"false"}),this.xmppClient.send(t)}},{key:"markInactive",value:function(){var e={id:this.helpers.getUniqueId("markActive"),type:"set"},t=l.createIqStanza(e);t.c("mobile",{xmlns:"http://tigase.org/protocol/mobile#v2",enable:"true"}),this.xmppClient.send(t)}},{key:"disconnect",value:function(){if(u.DLog("[Chat]","disconnect"),!this._isLogout)return this.muc.joinedRooms={},this.isConnected=!1,this._isConnecting=!1,this._isLogout=!0,this._isReconnect=!1,this.helpers.setUserCurrentJid(""),c.chat.streamManagement.enable&&this.streamManagement._removeElementHandler(),this.xmppClient.stop();u.DLog("[Chat]","Warning! Chat is already disconnected!")}},{key:"search",value:function(e){var t=Object.assign({},e);t.start_date&&(t.start_date=new Date(t.start_date).toISOString()),t.end_date&&(t.end_date=new Date(t.end_date).toISOString()),u.isArray(t.chat_dialog_ids)&&(t.chat_dialog_ids=t.chat_dialog_ids.join(","));var r={type:"GET",url:u.getUrl("".concat(c.urls.chat,"/search")),data:t};return this.proxy.ajax(r)}},{key:"_onMessage",value:function(e){var t,r,n,i=l.getElementTreePath(e,["sent","forwarded","message"]),s=i||e,a=l.getAttr(s,"from"),o=l.getAttr(s,"type"),c=l.getAttr(s,"id"),d=l.getElement(s,"markable"),p=l.getElement(s,"received"),h=l.getElement(s,"displayed"),f=l.getElement(s,"replace"),m=l.getElement(s,"reactions"),v=l.getElement(s,"remove"),g=l.getElement(s,"composing"),y=l.getElement(s,"paused"),b=l.getElement(s,"invite"),k=l.getElement(s,"delay"),C=l.getElement(s,"extraParams"),S=l.getElementText(s,"body"),w=!!i,x=this.xmppClient.jid&&this.xmppClient.jid._resource||"";if("chat"===o&&-1!==a.indexOf(x))return!0;r=(n="chat"===o?l.getAttr(s,"to"):null)?this.helpers.getUserIdFromJID(n):null;var _="groupchat"===o?this.helpers.getDialogIdFromJID(a):null,T="groupchat"===o?this.helpers.getIdFromResource(a):this.helpers.getUserIdFromJID(a),I=p||h||null;if(b)return!0;if(C&&(t=l.parseExtraParams(C)).dialogId&&(_=t.dialogId),g||y)return"function"!=typeof this.onMessageTypingListener||"chat"!==o&&"groupchat"!==o&&k||u.safeCallbackCall(this.onMessageTypingListener,!!g,T,_),!0;if(f)return"function"==typeof this.onMessageUpdateListener&&u.safeCallbackCall(this.onMessageUpdateListener,l.getAttr(f,"id"),"true"===l.getAttr(f,"last"),S,_,T,t?t.extension:null),!0;if(m){if(w&&"groupchat"===o)return!0;if("function"==typeof this.onMessageReactionsListener){var E=l.getAttr(m,"message_id"),O=+l.getAttr(m,"user_id"),D=l.parseReactions(m),L=D.add,P=D.remove,A=t.dialogId;u.safeCallbackCall(this.onMessageReactionsListener,E,O,A,L,P)}return!0}if(v)return"function"==typeof this.onMessageDeleteListener&&u.safeCallbackCall(this.onMessageDeleteListener,l.getAttr(v,"id"),_,T),!0;if(I)p?"function"==typeof this.onDeliveredStatusListener&&"chat"===o&&u.safeCallbackCall(this.onDeliveredStatusListener,l.getAttr(p,"id"),_,T):"function"==typeof this.onReadStatusListener&&"chat"===o&&u.safeCallbackCall(this.onReadStatusListener,l.getAttr(h,"id"),_,T);else{if(d&&T!=this.helpers.getUserIdFromJID(this.helpers.userCurrentJid(this.xmppClient))){var j={messageId:c,userId:T,dialogId:_};this.sendDeliveredStatus(j)}var R={id:c,dialog_id:_,recipient_id:r,is_forwarded:w,type:o,body:S,extension:t?t.extension:null,delay:k};d&&(R.markable=1),"function"!=typeof this.onMessageListener||"chat"!==o&&"groupchat"!==o||u.safeCallbackCall(this.onMessageListener,T,R)}}},{key:"_onPresence",value:function(e){var t,r,n,s=l.getAttr(e,"from"),a=l.getAttr(e,"id"),o=l.getAttr(e,"type"),c=this.helpers.getUserIdFromJID(this.helpers.userCurrentJid(this.xmppClient)),d=l.getElement(e,"x");if(d&&(t=l.getAttr(d,"xmlns"),(r=l.getElement(d,"status"))&&(n=l.getAttr(r,"code"))),t&&t.startsWith("http://jabber.org/protocol/muc")){if("error"===o)return void(a.endsWith(":join")&&"function"==typeof this.stanzasCallbacks[a]&&this.stanzasCallbacks[a](e));var p=this.helpers.getDialogIdFromJID(s),h=this.helpers.getUserIdFromRoomJid(s);if(r){if("301"==n){if("function"==typeof this.onKickOccupant){var f=l.getElement(l.getElement(d,"item"),"actor"),m=l.getAttr(f,"jid"),v=this.helpers.getUserIdFromJID(m);u.safeCallbackCall(this.onKickOccupant,p,v)}return void delete this.muc.joinedRooms[this.helpers.getRoomJidFromRoomFullJid(s)]}if("unavailable"===o)return void(r&&"110"==n&&"function"==typeof this.stanzasCallbacks["muc:leave"]&&u.safeCallbackCall(this.stanzasCallbacks["muc:leave"],null));if(a.endsWith(":join")&&r&&"110"==n)return void("function"==typeof this.stanzasCallbacks[a]&&this.stanzasCallbacks[a](e))}else if(h!=c)return"unavailable"===o?void("function"==typeof this.onLeaveOccupant&&u.safeCallbackCall(this.onLeaveOccupant,p,parseInt(h))):void("function"==typeof this.onJoinOccupant&&u.safeCallbackCall(this.onJoinOccupant,p,parseInt(h)))}var g=this.helpers.getUserIdFromJID(s),y=this.contactList.contacts[g];if(o)switch(o){case"subscribe":y&&"to"===y.subscription?(y?y.ask=null:(0,i.default)("contact"),y.subscription="both",this.contactList._sendSubscriptionPresence({jid:s,type:"subscribed"})):"function"==typeof this.onSubscribeListener&&u.safeCallbackCall(this.onSubscribeListener,g);break;case"subscribed":y&&"from"===y.subscription?(y?y.ask=null:(0,i.default)("contact"),y.subscription="both"):(y?y.ask=null:(0,i.default)("contact"),y.subscription="to","function"==typeof this.onConfirmSubscribeListener&&u.safeCallbackCall(this.onConfirmSubscribeListener,g));break;case"unsubscribed":y?y.ask=null:(0,i.default)("contact"),y.subscription="none","function"==typeof this.onRejectSubscribeListener&&u.safeCallbackCall(this.onRejectSubscribeListener,g);break;case"unsubscribe":y?y.ask=null:(0,i.default)("contact"),y.subscription="to";break;case"unavailable":"function"==typeof this.onContactListListener&&y&&"none"!==y.subscription&&u.safeCallbackCall(this.onContactListListener,g,o),g===c&&this.xmppClient.send(l.createPresenceStanza())}else"function"==typeof this.onContactListListener&&y&&"none"!==y.subscription&&u.safeCallbackCall(this.onContactListListener,g)}},{key:"_onIQ",value:function(e){var t=l.getAttr(e,"id");if(this.stanzasCallbacks[t])u.safeCallbackCall(this.stanzasCallbacks[t],e),delete this.stanzasCallbacks[t];else{var r=l.getAttr(e,"from"),n=l.getElement(e,"query");if(!r||!n)return;this._onLastActivityStanza(e)}}},{key:"_onSystemMessageListener",value:function(e){var t=l.getElementTreePath(e,["sent","forwarded","message"])||e,r=l.getAttr(t,"from"),n=l.getAttr(t,"id"),i=l.getElement(t,"extraParams"),s=this.helpers.getUserIdFromJID(r),a=l.getElement(t,"delay"),o=l.getElementText(i,"moduleIdentifier"),c=l.getElementText(t,"body"),d=l.parseExtraParams(i);if("SystemNotifications"===o&&"function"==typeof this.onSystemMessageListener){var p={id:n,userId:s,body:c,extension:d.extension};u.safeCallbackCall(this.onSystemMessageListener,p)}else this.webrtcSignalingProcessor&&!a&&"WebRTCVideoChat"===o&&this.webrtcSignalingProcessor._onMessage(s,i)}},{key:"_onMessageErrorListener",value:function(e){var t=l.getAttr(e,"id"),r=l.buildErrorFromXMPPErrorStanza(e);"function"==typeof this.onMessageErrorListener&&u.safeCallbackCall(this.onMessageErrorListener,t,r)}},{key:"_postConnectActions",value:function(){u.DLog("[Chat]",this._isReconnect?"RECONNECTED":"CONNECTED");var e=l.createPresenceStanza();if(c.chat.streamManagement.enable&&2===c.chatProtocol.active&&(this.streamManagement.enable(this.xmppClient),this.streamManagement.sentMessageCallback=this._sentMessageCallback),this.helpers.setUserCurrentJid(this.helpers.userCurrentJid(this.xmppClient)),this.isConnected=!0,this._isConnecting=!1,this._enableCarbons(),this.xmppClient.send(e),this._isReconnect?"function"==typeof this.onReconnectListener&&u.safeCallbackCall(this.onReconnectListener):this._isReconnect=!0,this.earlyIncomingMessagesQueue.length>0){u.DLog("[Chat]","Flush 'earlyIncomingMessagesQueue' (length=".concat(this.earlyIncomingMessagesQueue.length,")"));var t=this.xmppClientListeners.filter((function(e){return"stanza"===e.name}))[0].callback;this.earlyIncomingMessagesQueue.forEach((function(e){t(e)})),this.earlyIncomingMessagesQueue=[]}}},{key:"_enableCarbons",value:function(){var e={type:"set",from:this.helpers.getUserCurrentJid(),id:l.getUniqueId("enableCarbons")},t=l.createIqStanza(e);t.c("enable",{xmlns:"urn:xmpp:carbons:2"}),this.xmppClient.send(t)}},{key:"_setSubscriptionToUserLastActivity",value:function(e,t){var r={id:this.helpers.getUniqueId("statusStreaming"),type:"set"},n=l.createIqStanza(r);n.c("subscribe",{xmlns:"https://connectycube.com/protocol/status_streaming",user_jid:this.helpers.jidOrUserId(e),enable:t}),this.xmppClient.send(n)}},{key:"subscribeToUserLastActivityStatus",value:function(e){this._setSubscriptionToUserLastActivity(e,!0)}},{key:"unsubscribeFromUserLastActivityStatus",value:function(e){this._setSubscriptionToUserLastActivity(e,!1)}}])}();e.exports=g},5626:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(3532),o=r(5842),c=r(3341),u=function(){return(0,s.default)((function e(){(0,i.default)(this,e),this._userCurrentJid=null}),[{key:"getUniqueId",value:function(e){return c.getUniqueId(e)}},{key:"isNumeric",value:function(e){return/^-?\d+$/.test(e)||/^\d+\.\d+$/.test(e)}},{key:"jidOrUserId",value:function(e){return"string"==typeof e?this.isNumeric(e)?this.getUserJid(e):e.includes("@")?e:this.getRoomJidFromDialogId(e):this.getUserJid(e)}},{key:"typeChat",value:function(e){var t;if("string"==typeof e)t=this.isNumeric(e)?"chat":e.includes("@")?e.includes("muc")?"groupchat":"chat":"groupchat";else{if("number"!=typeof e)throw new Error("Unsupported chat type");t="chat"}return t}},{key:"getUserJid",value:function(e,t){return t?e+"-"+t+"@"+o.endpoints.chat:e+"-"+o.creds.appId+"@"+o.endpoints.chat}},{key:"getUserNickWithMucDomain",value:function(e){return o.endpoints.muc+"/"+e}},{key:"getUserIdFromJID",value:function(e){return null!=e&&e.includes("@")?parseInt(e.split("@")[0].split("-")[0]):null}},{key:"getDialogIdFromJID",value:function(e){return null!=e&&e.includes("@")?e.split("@")[0].split("_")[1]:null}},{key:"getRoomJidFromDialogId",value:function(e){return o.creds.appId+"_"+e+"@"+o.endpoints.muc}},{key:"getRoomJid",value:function(e){return e+"/"+this.getUserIdFromJID(this._userCurrentJid)}},{key:"getIdFromResource",value:function(e){var t=e.split("/");return t.length<2?null:(t.splice(0,1),parseInt(t.join("/")))}},{key:"getRoomJidFromRoomFullJid",value:function(e){var t=e.split("/");return t.length<2?null:t[0]}},{key:"getBsonObjectId",value:function(){return a.getBsonObjectId()}},{key:"getUserIdFromRoomJid",value:function(e){var t=e.toString().split("/");return 0===t.length?null:t[t.length-1]}},{key:"userCurrentJid",value:function(e){return e.jid._local+"@"+e.jid._domain+"/"+e.jid._resource}},{key:"getUserCurrentJid",value:function(){return this._userCurrentJid}},{key:"setUserCurrentJid",value:function(e){this._userCurrentJid=e}},{key:"getDialogJid",value:function(e){return e.indexOf("@")>0?e:this.getRoomJidFromDialogId(e)}}])}();e.exports=u},3341:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3738)),s=n(r(7383)),a=n(r(4579)),o=r(5842),c=r(363),u=function(){return(0,a.default)((function e(){(0,s.default)(this,e)}),null,[{key:"buildUserJid",value:function(e){var t;return"userId"in e?(t=e.userId+"-"+o.creds.appId+"@"+o.endpoints.chat,"resource"in e&&(t=t+"/"+e.resource)):"jid"in e&&(t=e.jid),t}},{key:"buildUserJidLocalPart",value:function(e){return e+"-"+o.creds.appId}},{key:"createMessageStanza",value:function(e){return c.xml("message",e)}},{key:"createIqStanza",value:function(e){return c.xml("iq",e)}},{key:"createPresenceStanza",value:function(e){return c.xml("presence",e)}},{key:"createNonza",value:function(e,t){return c.xml(e,t)}},{key:"getAttr",value:function(e,t){return e?("function"==typeof e.getAttribute?r=e.getAttribute(t):e.attrs&&(r=e.attrs[t]),r):null;var r}},{key:"getElement",value:function(e,t){var r;return"function"==typeof e.querySelector?r=e.querySelector(t):"function"==typeof e.getChild&&(r=e.getChild(t)),r}},{key:"isErrorStanza",value:function(e){return!!e.getChild("error")}},{key:"getAllElements",value:function(e,t){var r;return"function"==typeof e.querySelectorAll?r=e.querySelectorAll(t):"function"==typeof e.getChild&&(r=e.getChild(t)),r}},{key:"getElementText",value:function(e,t){var r,n;return"function"==typeof e.querySelector?n=(r=e.querySelector(t))?r.textContent:null:"function"==typeof e.getChildText&&(n=e.getChildText(t)),n}},{key:"getElementTreePath",value:function(e,t){var r=this;return t.reduce((function(e,t){return e?r.getElement(e,t):e}),e)}},{key:"_JStoXML",value:function(e,t,r){var n=this;r=r.c(e),Object.keys(t).forEach((function(e){"object"===(0,i.default)(t[e])?n._JStoXML(e,t[e],r):r=r.c(e).t(t[e]).up()})),r=r.up()}},{key:"_XMLtoJS",value:function(e,t,r){e[t]={};for(var n=r.childNodes||r.children,i=0;i<n.length;i++){var s=n[i];if("string"!=typeof s){var a=s.childNodes||s.children,o=s.tagName||s.name,c=s.textContent||s.children[0];a.length>=1?e[t]=this._XMLtoJS(e[t],o,s):e[t][o]=c}else e[t]=s}return e}},{key:"filledExtraParams",value:function(e,t){var r=this;return Object.keys(t).forEach((function(n){"attachments"===n?t[n].forEach((function(t){e.getChild("extraParams").c("attachment",t).up()})):"object"===(0,i.default)(t[n])?r._JStoXML(n,t[n],e.getChild("extraParams")):e.getChild("extraParams").c(n).t(t[n]).up()})),e.up(),e}},{key:"parseExtraParams",value:function(e){if(!e)return null;for(var t,r,n,i={},s=[],a=0,o=e.children.length;a<o;a++){if("attachment"===e.children[a].name){r={},n=e.children[a].attrs;for(var c=Object.keys(n),u=0;u<c.length;u++)"size"===c[u]?r.size=parseInt(n.size):r[c[u]]=n[c[u]];s.push(r)}else"dialog_id"===e.children[a].name&&(t=e.getChildText("dialog_id"),i.dialog_id=t);if(e.children[a].children.length){var l=e.children[a];i=this._XMLtoJS(i,l.name,l)}}return s.length>0&&(i.attachments=s),i.moduleIdentifier&&delete i.moduleIdentifier,{extension:i,dialogId:t}}},{key:"buildErrorFromXMPPErrorStanza",value:function(e){var t=this.getElement(e,"error");return{code:parseInt(this.getAttr(t,"code")),info:this.getElementText(t,"text")}}},{key:"getUniqueId",value:function(e){var t="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}));return"string"==typeof e||"number"==typeof e?t+":"+e:t+""}},{key:"parseReactions",value:function(e){var t=this,r=e.children;return(r=r.map((function(e){return{add:"true"===t.getAttr(e,"add"),remove:"true"===t.getAttr(e,"remove"),reaction:t.getAttr(e,"type")}}))).reduce((function(e,t){return t.add&&(e.add=t.reaction),t.remove&&(e.remove=t.reaction),e}),{})}}])}();e.exports=u},5093:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(3341),o=r(3532),c=r(5842),u=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.helpers=t.helpers,this.xmppClient=t.xmppClient,this.stanzasCallbacks=t.stanzasCallbacks,this.contacts={},this.xmlns="jabber:iq:roster"}),[{key:"get",value:function(){var e=this;return new Promise((function(t,r){var n=a.getUniqueId("getRoster"),i={},s=a.createIqStanza({type:"get",from:e.helpers.getUserCurrentJid(),id:n});s.c("query",{xmlns:e.xmlns}),e.stanzasCallbacks[n]=function(r){for(var n=r.getChild("query").children,s=0,o=n.length;s<o;s++){var u=e.helpers.getUserIdFromJID(a.getAttr(n[s],"jid")),l=a.getAttr(n[s],"ask"),d=a.getAttr(n[s],"subscription"),p=a.getAttr(n[s],"name"),h=u+"-"+c.creds.appId!==p;i[u]={subscription:d,ask:l||null,name:h?p:null}}t(i)},e.xmppClient.send(s)}))}},{key:"add",value:function(e){var t=this;return new Promise((function(r,n){var i=e.userId||e,s=t.helpers.jidOrUserId(i),o=a.getUniqueId("addContactInRoster"),c=a.createIqStanza({type:"set",from:t.helpers.getUserCurrentJid(),id:o});t.contacts[i]={subscription:"none",ask:"subscribe",name:e.name||null},c.c("query",{xmlns:t.xmlns}).c("item",{jid:s,name:e.name||null}),t.stanzasCallbacks[o]=function(){t._sendSubscriptionPresence({jid:s,type:"subscribe"}),r()},t.xmppClient.send(c)}))}},{key:"confirm",value:function(e){var t=this;return new Promise((function(r,n){var i=e.userId||e,s=t.helpers.jidOrUserId(i);t._sendSubscriptionPresence({jid:s,type:"subscribed"}),c.chat.contactList.subscriptionMode.mutual?t.add(e,(function(){r()})):r()}))}},{key:"reject",value:function(e){var t=this;return new Promise((function(r,n){var i=t.helpers.jidOrUserId(e);t.contacts[e]={subscription:"none",ask:null},t._sendSubscriptionPresence({jid:i,type:"unsubscribed"}),r()}))}},{key:"updateName",value:function(e){var t=this;return new Promise((function(r,n){var i=t.helpers.jidOrUserId(e.userId),s=a.getUniqueId("updateContactInRoster"),c=t.contacts[e.userId];if(o.isObject(c)){c.name=e.name||null;var u=a.createIqStanza({type:"set",from:t.helpers.getUserCurrentJid(),id:s});u.c("query",{xmlns:t.xmlns}).c("item",{jid:i,name:e.name||null}),t.stanzasCallbacks[s]=function(e){"result"===e.attrs.type?r():n(e)},t.xmppClient.send(u)}else n("No contact exists with provided user id")}))}},{key:"remove",value:function(e){var t=this;return new Promise((function(r,n){var i=t.helpers.jidOrUserId(e),s=a.getUniqueId("removeConactInRoster"),o=a.createIqStanza({type:"set",from:t.helpers.getUserCurrentJid(),id:s});o.c("query",{xmlns:t.xmlns}).c("item",{jid:i,subscription:"remove"}),t.stanzasCallbacks[s]=function(){delete t.contacts[e],r()},t.xmppClient.send(o)}))}},{key:"_sendSubscriptionPresence",value:function(e){var t={to:e.jid,type:e.type},r=a.createPresenceStanza(t);this.xmppClient.send(r)}}])}();e.exports=u},6473:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(5842),o=r(3532),c=a.urls.chat+"/Dialog",u=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.proxy=t}),[{key:"list",value:function(e){var t={type:"GET",url:o.getUrl(c),data:e};return this.proxy.ajax(t)}},{key:"create",value:function(e){var t=o.cloneObject(e);t&&t.occupants_ids&&o.isArray(t.occupants_ids)&&(t.occupants_ids=t.occupants_ids.join(", "));var r={type:"POST",url:o.getUrl(c),data:t};return this.proxy.ajax(r)}},{key:"update",value:function(e,t){var r={type:"PUT",url:o.getUrl(c,e),data:t};return this.proxy.ajax(r)}},{key:"delete",value:function(e,t){var r={type:"DELETE",url:o.getUrl(c,e)};return("string"==typeof e||o.isArray(e)&&1===e.length)&&(r.dataType="text"),t&&(r.data=t),this.proxy.ajax(r)}},{key:"addAdmins",value:function(e,t){var r={push_all:{admins_ids:t}},n={type:"PUT",url:o.getUrl(c,e,"admins"),data:r};return this.proxy.ajax(n)}},{key:"removeAdmins",value:function(e,t){var r={pull_all:{admins_ids:t}},n={type:"PUT",url:o.getUrl(c,e,"admins"),data:r};return this.proxy.ajax(n)}},{key:"subscribe",value:function(e){var t={type:"POST",url:o.getUrl(c,e,"subscribe")};return this.proxy.ajax(t)}},{key:"unsubscribe",value:function(e){var t={type:"DELETE",url:o.getUrl(c,e,"subscribe"),dataType:"text"};return this.proxy.ajax(t)}},{key:"subscribeToPublic",value:function(e){return this.subscribe(e)}},{key:"unsubscribeFromPublic",value:function(e){return this.unsubscribe(e)}},{key:"updateNotificationsSettings",value:function(e,t){var r={enabled:t?1:0},n={type:"PUT",url:o.getUrl(c,e,"notifications"),data:r};return this.proxy.ajax(n)}},{key:"getNotificationsSettings",value:function(e){var t={type:"GET",url:o.getUrl(c,e,"notifications")};return this.proxy.ajax(t)}},{key:"getPublicOccupants",value:function(e,t){var r={type:"GET",url:o.getUrl(c,e,"occupants"),data:t};return this.proxy.ajax(r)}},{key:"clearHistory",value:function(e){var t={type:"DELETE",url:o.getUrl(c,"clearHistory",e),dataType:"text"};return this.proxy.ajax(t)}}])}();e.exports=u},6246:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(5842),o=r(3532),c=a.urls.chat+"/Message",u=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.proxy=t}),[{key:"list",value:function(e){var t={url:o.getUrl(c),data:e};return this.proxy.ajax(t)}},{key:"create",value:function(e){var t={url:o.getUrl(c),type:"POST",data:e};return this.proxy.ajax(t)}},{key:"update",value:function(e,t){var r={type:"PUT",dataType:"text",url:o.getUrl(c,e),data:t};return this.proxy.ajax(r)}},{key:"delete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r={url:o.getUrl(c,e),type:"DELETE",dataType:"text"};return t&&(r.data=t),this.proxy.ajax(r)}},{key:"createSystem",value:function(e){var t={url:o.getUrl(c+"/system"),type:"POST",data:e};return this.proxy.ajax(t)}},{key:"unreadCount",value:function(e){var t=o.cloneObject(e);t&&t.chat_dialog_ids&&o.isArray(t.chat_dialog_ids)&&(t.chat_dialog_ids=t.chat_dialog_ids.join(", "));var r={url:o.getUrl(c+"/unread"),data:t};return this.proxy.ajax(r)}},{key:"listReactions",value:function(e){var t={type:"GET",dataType:"json",url:o.getUrl(c,e,"reactions"),data:{}};return this.proxy.ajax(t)}},{key:"addReaction",value:function(e,t){return this.updateReaction(e,t)}},{key:"removeReaction",value:function(e,t){return this.updateReaction(e,null,t)}},{key:"updateReaction",value:function(e,t,r){var n={};t&&(n.add=t),r&&(n.remove=r);var i={type:"PUT",dataType:"text",url:o.getUrl(c,e,"reactions"),data:n};return this.proxy.ajax(i)}}])}();e.exports=u},9349:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(3341),o=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.helpers=t.helpers,this.xmppClient=t.xmppClient,this.stanzasCallbacks=t.stanzasCallbacks,this.joinedRooms={},this.xmlns="http://jabber.org/protocol/muc"}),[{key:"join",value:function(e){var t=this;return new Promise((function(r,n){var i=a.getUniqueId("join"),s=t.helpers.getDialogJid(e),o={id:i,from:t.helpers.getUserCurrentJid(),to:t.helpers.getRoomJid(s)},c=a.createPresenceStanza(o);c.c("x",{xmlns:t.xmlns}).c("history",{maxstanzas:0}),t.stanzasCallbacks[i]=function(e){var o=a.getAttr(e,"from"),c=(t.helpers.getDialogIdFromJID(o),a.getElement(e,"x")),u=a.getAttr(c,"xmlns"),l=a.getElement(c,"status"),d=a.getAttr(l,"code");if(l&&"110"==d)t.joinedRooms[s]=!0,r();else{var p=a.getAttr(e,"type");if(p&&"error"===p&&u===t.xmlns&&i.endsWith(":join")){var h=a.getElement(e,"error"),f=a.getAttr(h,"code"),m=a.getElementText(h,"text");n({code:f||500,message:m||"Unknown issue"})}}},t.xmppClient.send(c)}))}},{key:"leave",value:function(e){var t=this;return new Promise((function(r,n){var i=t.helpers.getDialogJid(e),s={type:"unavailable",from:t.helpers.getUserCurrentJid(),to:t.helpers.getRoomJid(i)},o=a.createPresenceStanza(s);delete t.joinedRooms[i],t.stanzasCallbacks["muc:leave"]=function(e){r()},t.xmppClient.send(o)}))}},{key:"listOnlineUsers",value:function(e){var t=this;return new Promise((function(r,n){var i={type:"get",to:t.helpers.getDialogJid(e),from:t.helpers.getUserCurrentJid(),id:a.getUniqueId("muc_disco_items")},s=a.createIqStanza(i);s.c("query",{xmlns:"http://jabber.org/protocol/disco#items"}),t.stanzasCallbacks[i.id]=function(e){var n=e.attrs.id;if(t.stanzasCallbacks[n]){for(var i=e.getChild("query").getChildElements("item"),s=[],a=0,o=i.length;a<o;a++){var c=t.helpers.getUserIdFromRoomJid(i[a].attrs.jid);s.push(parseInt(c))}r(s)}},t.xmppClient.send(s)}))}}])}();e.exports=o},117:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(3341),o=r(3532),c=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.helpers=t.helpers,this.xmppClient=t.xmppClient,this.stanzasCallbacks=t.stanzasCallbacks,this.xmlns="jabber:iq:privacy"}),[{key:"create",value:function(e){var t=this;return new Promise((function(r,n){for(var i,s,o,c,u,l,d={},p=e.items.length-1;p>=0;p--){var h=e.items[p];d[h.user_id]={action:h.action,mutualBlock:!0===h.mutualBlock}}l=Object.keys(d);var f={type:"set",from:t.helpers.getUserCurrentJid(),id:a.getUniqueId("edit")},m=a.createIqStanza(f);function v(e,t){return e.getChild("query").getChild("list").c("item",{type:"jid",value:t.jidOrMuc,action:t.userAction,order:t.order}).c("message",{}).up().c("presence-in",{}).up().c("presence-out",{}).up().c("iq",{}).up().up(),e}function g(e,t){return e.getChild("query").getChild("list").c("item",{type:"jid",value:t.jidOrMuc,action:t.userAction,order:t.order}).up(),e}m.c("query",{xmlns:t.xmlns}).c("list",{name:e.name});for(var y=0,b=0,k=l.length;y<k;y++,b+=2)u=d[i=l[y]].mutualBlock,c=d[i].action,s=t.helpers.jidOrUserId(parseInt(i,10)),o=t.helpers.getUserNickWithMucDomain(i),u&&"deny"===c?(m=g(m,{order:b+1,jidOrMuc:s,userAction:c}),m=g(m,{order:b+2,jidOrMuc:o,userAction:c}).up().up()):(m=v(m,{order:b+1,jidOrMuc:s,userAction:c}),m=v(m,{order:b+2,jidOrMuc:o,userAction:c}));t.stanzasCallbacks[f.id]=function(e){a.isErrorStanza(e)?n(a.buildErrorFromXMPPErrorStanza(e)):r()},t.xmppClient.send(m)}))}},{key:"getList",value:function(e){var t=this;return new Promise((function(r,n){var i,s,o,c=[],u={},l={type:"get",from:t.helpers.getUserCurrentJid(),id:a.getUniqueId("getlist")},d=a.createIqStanza(l);d.c("query",{xmlns:t.xmlns}).c("list",{name:e}),t.stanzasCallbacks[l.id]=function(e){var n=e.getChild("query");u=n?n.getChild("list"):null;for(var a=0,d=(i=u?u.getChildElements("item"):null).length;a<d;a+=2)s=i[a].attrs.value,o=t.helpers.getUserIdFromJID(s),c.push({user_id:o,action:i[a].attrs.action});u={name:u.attrs.name,items:c},r(u),delete t.stanzasCallbacks[l.id]},t.xmppClient.send(d)}))}},{key:"update",value:function(e){var t=this;return new Promise((function(r,n){t.getList(e.name).then((function(i){var s={items:o.mergeArrays(i.items,e.items),name:e.name};t.create(s).then((function(){r()})).catch((function(e){n(e)}))})).catch((function(e){n(e)}))}))}},{key:"getNames",value:function(){var e=this;return new Promise((function(t,r){var n={type:"get",from:e.helpers.getUserCurrentJid(),id:a.getUniqueId("getNames")},i=a.createIqStanza(n);i.c("query",{xmlns:e.xmlns}),e.stanzasCallbacks[i.attrs.id]=function(e){if(a.isErrorStanza(e))r(a.buildErrorFromXMPPErrorStanza(e));else{for(var n=e.getChild("query"),i=n.getChild("default"),s=n.getChild("active"),o=n.getChildElements("list"),c=i?i.attrs.name:null,u=s?s.attrs.name:null,l=[],d=0,p=o.length;d<p;d++)l.push(o[d].attrs.name);t({default:c,active:u,names:l})}},e.xmppClient.send(i)}))}},{key:"delete",value:function(e){var t=this;return new Promise((function(r,n){var i={from:t.xmppClient.jid||t.xmppClient.jid.user,type:"set",id:a.getUniqueId("remove")},s=a.createIqStanza(i);s.c("query",{xmlns:t.xmlns}).c("list",{name:e||""}),t.stanzasCallbacks[s.attrs.id]=function(e){a.isErrorStanza(e)?n(a.buildErrorFromXMPPErrorStanza(e)):r()},t.xmppClient.send(s)}))}},{key:"setAsDefault",value:function(e){var t=this;return new Promise((function(r,n){var i={from:t.xmppClient.jid||t.xmppClient.jid.user,type:"set",id:a.getUniqueId("default")},s=a.createIqStanza(i);s.c("query",{xmlns:t.xmlns}).c("default",e&&e.length>0?{name:e}:{}),t.stanzasCallbacks[s.attrs.id]=function(e){a.isErrorStanza(e)?n(a.buildErrorFromXMPPErrorStanza(e)):r()},t.xmppClient.send(s)}))}}])}();e.exports=c},7614:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(3532),o=r(3341),c=function(){return(0,s.default)((function e(){var t=this;(0,i.default)(this,e),this._NS="urn:xmpp:sm:3",this._isStreamManagementEnabled=!1,this._clientProcessedStanzasCounter=0,this._clientSentStanzasCounter=0,this.sentMessageCallback=null,this._lastAck=0,this._xmppClient=null,this._originalSend=null,this._unackedQueue=[],this._incomingStanzaHandler=function(e){var r=e.name||e.tagName||e.nodeTree.tagName;if("enabled"!==r)if(o.getAttr(e,"xmlns")!==t._NS&&t._increaseReceivedStanzasCounter(),"r"!==r){if("a"===r){var n=parseInt(o.getAttr(e,"h"));t._checkCounterOnIncomeStanza(n)}}else{var i={xmlns:t._NS,h:t._clientProcessedStanzasCounter},s=o.createNonza("a",i);t._originalSend.call(t._xmppClient,s)}else t._isStreamManagementEnabled=!0}}),[{key:"enable",value:function(e){var t={xmlns:this._NS};this._isStreamManagementEnabled||(this._xmppClient=e,this._originalSend=this._xmppClient.send,this._xmppClient.send=this.send.bind(this)),this._clientProcessedStanzasCounter=0,this._clientSentStanzasCounter=0,this._lastAck=0,this._removeElementHandler(),this._addElementHandler();var r=o.createNonza("enable",t);this._xmppClient.send(r)}},{key:"_removeElementHandler",value:function(){this._xmppClient.removeListener("element",this._incomingStanzaHandler)}},{key:"_addElementHandler",value:function(){this._xmppClient.on("element",this._incomingStanzaHandler)}},{key:"send",value:function(e,t){var r=e.name||e.tagName||e.nodeTree.tagName,n=o.getAttr(e,"type"),i=o.getElementText(e,"body")||"",s=o.getAllElements(e,"attachment")||"";this._originalSend.call(this._xmppClient,e),"message"!==r||"chat"!==n&&"groupchat"!==n||!i&&!s.length||this._sendStanzasRequest({message:t,expect:this._clientSentStanzasCounter}),++this._clientSentStanzasCounter}},{key:"_sendStanzasRequest",value:function(e){if(this._isStreamManagementEnabled){this._unackedQueue.push(e);var t=o.createNonza("r",{xmlns:this._NS});this._originalSend.call(this._xmppClient,t)}}},{key:"getClientSentStanzasCounter",value:function(){return this._clientSentStanzasCounter}},{key:"_checkCounterOnIncomeStanza",value:function(e){var t=e-this._lastAck;a.DLog("[Chat][SM][_checkCounterOnIncomeStanza]",t,e,this._lastAck);for(var r=0;r<t&&this._unackedQueue.length>0;r++)this.sentMessageCallback(null,this._unackedQueue.shift().message);this._lastAck=e}},{key:"_increaseReceivedStanzasCounter",value:function(){++this._clientProcessedStanzasCounter}}])}();e.exports=c},363:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(5715)),a=n(r(1847)),o=["resource","credentials","username","password"],c=r(5734),u=c.xml,l=c.jid,d=c.Client,p=r(6826),h=r(3312),f=r(5013),m=r(3323),v=r(3812),g=r(353),y=r(7127),b=r(7802),k=r(145),C=r(9717),S=r(7718),w=r(4767);e.exports.xml=u,e.exports.jid=l,e.exports.client=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.resource,r=e.credentials,n=e.username,c=e.password,u=(0,a.default)(e,o),l=u.domain,x=u.service;!l&&x&&(u.domain=function(e){return(e.split("://")[1]||e).split(":")[0].split("/")[0]}(x));var _=new d(u),T=p({entity:_}),I=h({entity:_}),E=f({entity:_}),O=m({middleware:E}),D=v({middleware:E,entity:_}),L=g({middleware:E,entity:_}),P=y({entity:_}),A=b({streamFeatures:O},r||{username:n,password:c}),j=k({iqCaller:D,streamFeatures:O},t),R=C({iqCaller:D,streamFeatures:O}),M=Object.entries({plain:w,anonymous:S}).map((function(e){var t=(0,s.default)(e,2),r=t[0],n=t[1];return(0,i.default)({},r,n(A))}));return Object.assign(_,{entity:_,reconnect:T,websocket:I,middleware:E,streamFeatures:O,iqCaller:D,iqCallee:L,resolve:P,sasl:A,resourceBinding:j,sessionEstablishment:R,mechanisms:M})}},7011:(e,t,r)=>{"use strict";var n=r(5842),i=r(8398),s=r(610).SessionConnectionState,a=r(4673).RTCPeerConnection,o=r(4673).RTCSessionDescription,c=r(4673).RTCIceCandidate,u=r(4673).MediaStream,l=r(610).PeerConnectionState;a.prototype._init=function(e,t,r,n){i.trace("RTCPeerConnection init. userID: "+t+", sessionID: "+r+", type: "+n),this.delegate=e,this.sessionID=r,this.userID=t,this.type=n,this.remoteSDP=null,this.state=l.NEW,this.remoteStream=new u,this.ontrack=this.onAddRemoteMediaCallback.bind(this),this.onicecandidate=this.onIceCandidateCallback.bind(this),this.onsignalingstatechange=this.onSignalingStateCallback.bind(this),this.oniceconnectionstatechange=this.onIceConnectionStateCallback.bind(this),this.onStatusClosedChecker=void 0,this.dialingTimer=null,this.answerTimeInterval=0,this.statsReportTimer=null,this.iceCandidates=[],this.released=!1},a.prototype.release=function(){this._clearDialingTimer(),this._clearStatsReportTimer(),this.close(),i.getVersionSafari()>=11&&this.onIceConnectionStateCallback(),this.released=!0},a.prototype.updateRemoteSDP=function(e){if(!e)throw new Error("sdp string can't be empty.");this.remoteSDP=e},a.prototype.getRemoteSDP=function(){return this.remoteSDP},a.prototype.setRemoteSessionDescription=function(e,t){var r=new o({sdp:t,type:e});return this.setRemoteDescription(r)},a.prototype.getAndSetLocalSessionDescription=function(e){var t=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((function(n,i){if(t.state=l.CONNECTING,"offer"===t.type)t.createOffer(r).then((function(r){t.setLocalDescription(r).then((function(i){t.setRTCRtpSenderMaxBandwidth(e),n(r)})).catch(i)})).catch(i);else{if(r.iceRestart)throw new Error("iceRestart is possible only from offer side");t.createAnswer(r).then((function(r){t.setLocalDescription(r).then((function(i){t.setRTCRtpSenderMaxBandwidth(e),n(r)})).catch(i)})).catch(i)}}))},a.prototype.setRTCRtpSenderMaxBandwidth=function(e){var t=this;(this.getSenders()||[]).forEach((function(r){if("video"===r.track.kind){var n,s=r.getParameters();s.encodings||(s.encodings=[]),e?s.encodings[0].maxBitrate=1e3*e:null===(n=s.encodings[0])||void 0===n||delete n.maxBitrate,r.setParameters(s).then((function(){i.trace("Set maxBandwidth success ["+t.userID+"]: "+e+" kbps")})).catch((function(e){i.trace("Set maxBandwidth error ["+t.userID+"]: "+e)}))}}))},a.prototype.addCandidates=function(e){for(var t=0,r=e.length;t<r;t++){var n={sdpMLineIndex:e[t].sdpMLineIndex,sdpMid:e[t].sdpMid,candidate:e[t].candidate};n.candidate&&this.addIceCandidate(new c(n),(function(){}),(function(e){i.traceError("Error on 'addIceCandidate': "+e)}))}},a.prototype.toString=function(){return"sessionID: "+this.sessionID+", userID:  "+this.userID+", type: "+this.type+", state: "+this.state},a.prototype.onSignalingStateCallback=function(){i.trace("onSignalingStateCallback: "+this.signalingState),"stable"===this.signalingState&&this.iceCandidates.length>0&&(this.delegate._processIceCandidates(this,this.iceCandidates),this.iceCandidates.length=0)},a.prototype.onIceCandidateCallback=function(e){var t=e.candidate;if(t){var r={sdpMLineIndex:t.sdpMLineIndex,sdpMid:t.sdpMid,candidate:t.candidate};"stable"===this.signalingState?this.delegate._processIceCandidates(this,[r]):this.iceCandidates.push(r)}},a.prototype.onAddRemoteMediaCallback=function(e){"function"==typeof this.delegate._onRemoteStreamListener&&(this.remoteStream.addTrack(e.track),(1==this.delegate.callType&&this.remoteStream.getVideoTracks().length||2==this.delegate.callType&&this.remoteStream.getAudioTracks().length)&&this.delegate._onRemoteStreamListener(this.userID,this.remoteStream),this._getStatsWrap())},a.prototype.onIceConnectionStateCallback=function(){var e=this;if(i.trace("onIceConnectionStateCallback: "+this.iceConnectionState),"function"==typeof this.delegate._onSessionConnectionStateChangedListener){var t=null;switch(i.getVersionSafari()>=11&&clearTimeout(this.onStatusClosedChecker),this.iceConnectionState){case"checking":this.state=l.CHECKING,t=s.CONNECTING;break;case"connected":this._clearWaitingReconnectTimer(),this.state=l.CONNECTED,t=s.CONNECTED;break;case"completed":this._clearWaitingReconnectTimer(),this.state=l.COMPLETED,t=s.COMPLETED;break;case"failed":this.state=l.FAILED,t=s.FAILED;break;case"disconnected":this._startWaitingReconnectTimer(),this.state=l.DISCONNECTED,t=s.DISCONNECTED,i.getVersionSafari()>=11&&(this.onStatusClosedChecker=setTimeout((function(){e.onIceConnectionStateCallback()}),500));break;case"closed":this._clearWaitingReconnectTimer(),this.state=l.CLOSED,t=s.CLOSED}t&&this.delegate._onSessionConnectionStateChangedListener(this.userID,t)}},a.prototype._clearStatsReportTimer=function(){this.statsReportTimer&&(clearInterval(this.statsReportTimer),this.statsReportTimer=null)},a.prototype._getStatsWrap=function(){var e,t,r=this;if(n.videochat&&n.videochat.statsReportTimeInterval){if(isNaN(+n.videochat.statsReportTimeInterval))return void i.traceError("statsReportTimeInterval ("+n.videochat.statsReportTimeInterval+") must be integer.");e=1e3*n.videochat.statsReportTimeInterval,i.trace("Stats tracker has been started."),this.statsReportTimer=setInterval((function(){!function(e,n){var s={local:{audio:{},video:{},candidate:{}},remote:{audio:{},video:{},candidate:{}}};if(i.getVersionFirefox()){var a=e.getLocalStreams().length?e.getLocalStreams()[0]:e.delegate.localStream,o=a.getVideoTracks().length?a.getVideoTracks()[0].getSettings():null;s.local.video.frameHeight=o&&o.height,s.local.video.frameWidth=o&&o.width}e.getStats(null).then((function(e){e.forEach((function(e){var t;e.bytesReceived&&"inbound-rtp"===e.type?((t=s.remote[e.mediaType]).bitrate=c(e,n,!1),t.bytesReceived=e.bytesReceived,t.packetsReceived=e.packetsReceived,t.timestamp=e.timestamp,"video"===e.mediaType&&e.framerateMean&&(t.framesPerSecond=Math.round(10*e.framerateMean)/10)):e.bytesSent&&"outbound-rtp"===e.type?((t=s.local[e.mediaType]).bitrate=c(e,n,!0),t.bytesSent=e.bytesSent,t.packetsSent=e.packetsSent,t.timestamp=e.timestamp,"video"===e.mediaType&&e.framerateMean&&(t.framesPerSecond=Math.round(10*e.framerateMean)/10)):"local-candidate"===e.type?(t=s.local.candidate,"host"===e.candidateType&&"udp"===e.mozLocalTransport&&"udp"===e.transport?(t.protocol=e.transport,t.ip=e.ipAddress,t.port=e.portNumber):i.getVersionFirefox()||(t.protocol=e.protocol,t.ip=e.ip,t.port=e.port)):"remote-candidate"===e.type?((t=s.remote.candidate).protocol=e.protocol||e.transport,t.ip=e.ip||e.ipAddress,t.port=e.port||e.portNumber):"track"!==e.type||"video"!==e.kind||i.getVersionFirefox()||(e.remoteSource?((t=s.remote.video).frameHeight=e.frameHeight,t.frameWidth=e.frameWidth,t.framesPerSecond=u(e,n,!1)):((t=s.local.video).frameHeight=e.frameHeight,t.frameWidth=e.frameWidth,t.framesPerSecond=u(e,n,!0)))})),function(e,n){t=n,r.delegate._onCallStatsReport(r.userID,e,null)}(s,e)}),(function(e){i.traceError("_getStats error. "+e.name+": "+e.message),r.delegate._onCallStatsReport(r.userID,null,e)}));var c=function(e,t,r){var n,i=t&&t.get(e.id),s=i?(e.timestamp-i.timestamp)/1e3:5;return n=i?r?8*(e.bytesSent-i.bytesSent)/(1024*s):8*(e.bytesReceived-i.bytesReceived)/(1024*s):0,Math.round(n)},u=function(e,t,r){var n,i=t&&t.get(e.id),s=i?(e.timestamp-i.timestamp)/1e3:5;return n=i?r?(e.framesSent-i.framesSent)/s:(e.framesReceived-i.framesReceived)/s:0,Math.round(10*n)/10}}(r,t)}),e)}},a.prototype._clearWaitingReconnectTimer=function(){this.waitingReconnectTimeoutCallback&&(i.trace("_clearWaitingReconnectTimer"),clearTimeout(this.waitingReconnectTimeoutCallback),this.waitingReconnectTimeoutCallback=null)},a.prototype._startWaitingReconnectTimer=function(){var e=this,t=1e3*n.videochat.disconnectTimeInterval;i.trace("_startWaitingReconnectTimer, timeout: "+t),this.waitingReconnectTimeoutCallback=setTimeout((function(){i.trace("waitingReconnectTimeoutCallback"),clearTimeout(e.waitingReconnectTimeoutCallback),e.release(),e.delegate._closeSessionIfAllConnectionsClosed()}),t)},a.prototype._clearDialingTimer=function(){this.dialingTimer&&(i.trace("_clearDialingTimer"),clearInterval(this.dialingTimer),this.dialingTimer=null,this.answerTimeInterval=0)},a.prototype._startDialingTimer=function(e,t){var r=this,s=1e3*n.videochat.dialingTimeInterval;i.trace("_startDialingTimer, dialingTimeInterval: "+s);var a=function(e,t,s){s||(r.answerTimeInterval+=1e3*n.videochat.dialingTimeInterval),i.trace("_dialingCallback, answerTimeInterval: "+r.answerTimeInterval),r.answerTimeInterval>=1e3*n.videochat.answerTimeInterval?(r._clearDialingTimer(),t&&r.delegate._processOnNotAnswer(r)):r.delegate._processCall(r,e)};this.dialingTimer=setInterval(a,s,e,t,!1),a(e,t,!0)},e.exports=a},6008:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(7383)),a=n(r(4579));function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function c(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){(0,i.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var u=r(8239),l=r(7947),d=r(8838),p=r(8398),h=r(610),f=r(610).SessionState,m=r(3532),v=r(4673).mediaDevices,g=r(5842),y=function(){return(0,a.default)((function e(t,r){(0,s.default)(this,e),this.connection=t,this.proxy=r,this.signalingProcessor=new l(this),this.signalingProvider=new d(t),this.SessionConnectionState=h.SessionConnectionState,this.PeerConnectionState=h.PeerConnectionState,this.CallType=h.CallType,this.sessions={},v&&(v.ondevicechange=this._onDevicesChangeListener.bind(this)),this.onCallListener=null,this.onAcceptCallListener=null,this.onRejectCallListener=null,this.onStopCallListener=null,this.onUserNotAnswerListener=null,this.onInvalidEventsListener=null,this.onRemoteStreamListener=null,this.onSessionConnectionStateChangedListener=null,this.onSessionCloseListener=null,this.onCallStatsReport=null,this.onDevicesChangeListener=null}),[{key:"getMediaDevices",value:function(e){var t=[];return new Promise((function(r,n){v&&v.enumerateDevices?v.enumerateDevices().then((function(n){e?(n.forEach((function(r,n){r.kind===e&&t.push(r)})),r(t)):r(n)})):n("No 'enumerateDevices' API supported")}))}},{key:"createNewSession",value:function(e,t){var r=p.getUserIdFromJID(p.userCurrentJid(this.connection));if(!e)throw new Error("Can't create a session without opponentsIDs.");return this._createAndStoreSession(null,r,e,t)}},{key:"_createAndStoreSession",value:function(e,t,r,n,i){var s=new u({sessionID:e,initiatorID:t,opIDs:r,callType:n,signalingProvider:this.signalingProvider,currentUserID:p.getUserIdFromJID(p.userCurrentJid(this.connection)),maxBandwidth:i});return s.onUserNotAnswerListener=this.onUserNotAnswerListener,s.onRemoteStreamListener=this.onRemoteStreamListener,s.onSessionConnectionStateChangedListener=this.onSessionConnectionStateChangedListener,s.onSessionCloseListener=this.onSessionCloseListener,s.onCallStatsReport=this.onCallStatsReport,this.sessions[s.ID]=s,s}},{key:"clearSession",value:function(e){delete this.sessions[e]}},{key:"callRejectRequest",value:function(e){var t={type:"POST",url:m.getUrl(g.urls.calls,"reject"),data:c({},e)};return this.proxy.ajax(t)}},{key:"_onCallListener",value:function(e,t,r){var n=r.userInfo||{},i=+n.maxBandwidth||0,s=this.sessions[t];p.trace("onCall. UserID:"+e+". SessionID: "+t+". extension: ",n),s?s._processOnCall(e,r):((s=this._createAndStoreSession(t,r.callerID,r.opponentsIDs,r.callType,i))._processOnCall(e,r),m.safeCallbackCall(this.onCallListener,s,n))}},{key:"_onAcceptListener",value:function(e,t,r){var n=this.sessions[t],i=r.userInfo||{};p.trace("onAccept. UserID:"+e+". SessionID: "+t),!n||n.state!==f.ACTIVE&&n.state!==f.NEW?p.traceWarning("Ignore 'onAccept', there is no information about session "+t):(m.safeCallbackCall(this.onAcceptCallListener,n,e,i),n._processOnAccept(e,r))}},{key:"_onRejectListener",value:function(e,t,r){var n=this.sessions[t];if(p.trace("onReject. UserID:"+e+". SessionID: "+t),n){var i=r.userInfo||{};m.safeCallbackCall(this.onRejectCallListener,n,e,i),n._processOnReject(e,r)}else p.traceWarning("Ignore 'onReject', there is no information about session "+t)}},{key:"_onStopListener",value:function(e,t,r){p.trace("onStop. UserID:"+e+". SessionID: "+t);var n=this.sessions[t],i=r.userInfo||{};!n||n.state!==f.ACTIVE&&n.state!==f.NEW?(m.safeCallbackCall(this.onInvalidEventsListener,"onStop",n,e,i),p.traceWarning("Ignore 'onStop', there is no information about session "+t+" by some reason.")):(n._processOnStop(e,r),m.safeCallbackCall(this.onStopCallListener,n,e,i))}},{key:"_onIceCandidatesListener",value:function(e,t,r){var n=this.sessions[t];p.trace("onIceCandidates. UserID:"+e+". SessionID: "+t+". ICE candidates count: "+r.iceCandidates.length),n?n.state===f.ACTIVE?n._processOnIceCandidates(e,r):p.traceWarning("Ignore 'OnIceCandidates', the session ( "+t+" ) has invalid state."):p.traceWarning("Ignore 'OnIceCandidates', there is no information about session "+t)}},{key:"_onIceRestartListener",value:function(e,t,r){var n=this.sessions[t];p.trace("onIceRestart. UserID:"+e+". SessionID: "+t),n?n.state===f.ACTIVE?n._processOnIceRestart(e,r):p.traceWarning("Ignore 'OnIceRestart', the session ( "+t+" ) has invalid state."):p.traceWarning("Ignore 'OnIceRestart', there is no information about session "+t)}},{key:"_onIceRestartAcceptListener",value:function(e,t,r){var n=this.sessions[t];p.trace("onIceRestartAccept. UserID:"+e+". SessionID: "+t),n?n.state===f.ACTIVE?n._processOnIceRestartAccept(e,r):p.traceWarning("Ignore 'onIceRestartAccept', the session ( "+t+" ) has invalid state."):p.traceWarning("Ignore 'onIceRestartAccept', there is no information about session "+t)}},{key:"_onDevicesChangeListener",value:function(){m.safeCallbackCall(this.onDevicesChangeListener)}}])}();e.exports=y},610:e=>{"use strict";e.exports={SignalingConstants:{MODULE_ID:"WebRTCVideoChat",SignalingType:{CALL:"call",ACCEPT:"accept",REJECT:"reject",STOP:"hangUp",RESTART:"iceRestart",RESTART_ACCEPT:"iceRestartAccept",CANDIDATE:"iceCandidates"}},SessionConnectionState:{UNDEFINED:0,CONNECTING:1,CONNECTED:2,FAILED:3,DISCONNECTED:4,CLOSED:5,COMPLETED:6},SessionState:{NEW:1,ACTIVE:2,HUNGUP:3,REJECTED:4,CLOSED:5},PeerConnectionState:{NEW:1,CONNECTING:2,CHECKING:3,CONNECTED:4,DISCONNECTED:5,FAILED:6,CLOSED:7,COMPLETED:8},CallType:{VIDEO:1,AUDIO:2}}},8398:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(5842),o=function(){return(0,s.default)((function e(){(0,i.default)(this,e)}),null,[{key:"getUserJid",value:function(e,t){return e+"-"+t+"@"+a.endpoints.chat}},{key:"getUserIdFromJID",value:function(e){return e.indexOf("@")<0?null:parseInt(e.split("@")[0].split("-")[0])}},{key:"userCurrentJid",value:function(e){return e.jid._local+"@"+e.jid._domain+"/"+e.jid._resource}},{key:"trace",value:function(e){a.debug&&console.log("[VideoChat]:",e)}},{key:"traceWarning",value:function(e){a.debug&&console.warn("[VideoChat]:",e)}},{key:"traceError",value:function(e){a.debug&&console.error("[VideoChat]:",e)}},{key:"getVersionFirefox",value:function(){var e,t=!!navigator&&navigator.userAgent;if(t){var r=t.match(/(?:firefox)[ \/](\d+)/i)||[];e=r[1]?+r[1]:null}return e}},{key:"getVersionSafari",value:function(){var e,t=!!navigator&&navigator.userAgent;if(t)if((t.match(/(?:safari)[ \/](\d+)/i)||[]).length){var r=t.match(/(?:version)[ \/](\d+)/i)||[];e=r&&r[1]?+r[1]:null}else e=null;return e}}])}();e.exports=o},8239:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3738)),s=n(r(3693)),a=n(r(7383)),o=n(r(4579));function c(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function u(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?c(Object(r),!0).forEach((function(t){(0,s.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):c(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var l=r(5842),d=r(7011),p=r(3532),h=r(8398),f=r(610).SignalingConstants,m=r(610).SessionState,v=r(610).PeerConnectionState,g=r(4673).mediaDevices,y=function(){return(0,o.default)((function e(t){var r;(0,a.default)(this,e),this.ID=t.sessionID?t.sessionID:(r=(new Date).getTime(),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var t=(r+16*Math.random())%16|0;return r=Math.floor(r/16),("x"==e?t:3&t|8).toString(16)}))),this.state=m.NEW,this.initiatorID=parseInt(t.initiatorID),this.opponentsIDs=t.opIDs,this.callType=parseInt(t.callType),this.peerConnections={},this.localStream=null,this.mediaParams=null,this.signalingProvider=t.signalingProvider,this.currentUserID=t.currentUserID,this.maxBandwidth=t.maxBandwidth,this.answerTimer=null,this.startCallTime=0,this.acceptCallTime=0,this.onUserNotAnswerListener=null,this.onRemoteStreamListener=null,this.onSessionCloseListener=null,this.onCallStatsReport=null,this.onSessionConnectionStateChangedListener=null}),[{key:"getDisplayMedia",value:function(e){var t=this;if(!g.getDisplayMedia)throw new Error("Your environment does not support 'getDisplayMedia' API");var r=e&&e.elementId,n=e&&e.options,i=u({},e);return this.mediaParams=i,delete i.elementId,delete i.options,g.getDisplayMedia(i).then((function(e){return t._upsertStream(e,r,n)})).catch((function(e){throw new Error(e)}))}},{key:"getUserMedia",value:function(e){var t=this,r=e&&e.elementId,n=e&&e.options,i=u({},e);return this.mediaParams=i,delete i.elementId,delete i.options,g.getUserMedia(i).then((function(e){return t._upsertStream(e,r,n)})).catch((function(e){throw new Error(e)}))}},{key:"_upsertStream",value:function(e,t,r){var n=this,i=!!this.localStream;return i?(this.localStream.getTracks().forEach((function(t){"audio"===t.kind&&0===e.getAudioTracks().length||(t.stop(),n.localStream.removeTrack(t))})),this._replaceTracks(e)):this.localStream=e,t&&(i&&this.detachMediaStream(t,r),this.attachMediaStream(t,this.localStream,r)),this.localStream}},{key:"_replaceTracks",value:function(e){var t=this,r=this.peerConnections;for(var n in e.getTracks().forEach((function(e){"audio"===e.kind?e.enabled=t.localStream.getAudioTracks().every((function(e){return e.enabled})):e.enabled=t.localStream.getVideoTracks().every((function(e){return e.enabled}))})),r)r[n].getSenders().map((function(r){var n=e.getTracks().find((function(e){return e.kind===r.track.kind}));n&&(r.replaceTrack(n),t.localStream.addTrack(n))}))}},{key:"setMaxBandwidth",value:function(e){var t=this.peerConnections||[];if(t.length<1)h.trace("No 'RTCPeerConnection' to set 'maxBandwidth'");else for(var r in t)t[r].setRTCRtpSenderMaxBandwidth(e)}},{key:"connectionStateForUser",value:function(e){var t=this.peerConnections[e];return t?t.state:null}},{key:"attachMediaStream",value:function(e,t,r){var n=document.getElementById(e);if(!n)throw new Error("Unable to attach media stream, element "+e+" is undefined");"object"===(0,i.default)(n.srcObject)?n.srcObject=t:n.src=window.URL.createObjectURL(t),r&&r.muted&&(n.muted=!0),r&&r.mirror&&(n.style.webkitTransform="scaleX(-1)",n.style.transform="scaleX(-1)"),n.onloadedmetadata=function(e){n.play()}}},{key:"detachMediaStream",value:function(e,t){var r=document.getElementById(e);if(!r)throw new Error("Unable to attach media stream, element "+e+" is undefined");r.pause(),"object"===(0,i.default)(r.srcObject)?r.srcObject=null:r.src="",t&&!t.mirror&&(r.style.webkitTransform="",r.style.transform="")}},{key:"switchMediaTracks",value:function(e){var t=this;return p.DLog("switchMediaTracks(deviceIds)",{deviceIds:e}),e&&e.audio&&("boolean"==typeof this.mediaParams.audio&&(this.mediaParams.audio={}),this.mediaParams.audio.deviceId=e.audio),e&&e.video&&("boolean"==typeof this.mediaParams.video&&(this.mediaParams.video={}),this.mediaParams.video.deviceId=e.video),this.localStream.getTracks().forEach((function(e){e.stop()})),g.getUserMedia({audio:this.mediaParams.audio||!1,video:this.mediaParams.video||!1}).then((function(e){return t._replaceTracks(e)})).catch((function(e){throw new Error(e)}))}},{key:"call",value:function(e){var t=this,r=b(e);h.trace("Call, extension: "+JSON.stringify(r)),this.state=m.ACTIVE,this.maxBandwidth=+r.userInfo.maxBandwidth||0,this.opponentsIDs.forEach((function(e,n,i){t._callInternal(e,r,!0)}))}},{key:"_callInternal",value:function(e,t,r){var n=this,i=this._createPeer(e,"offer");this.localStream.getTracks().forEach((function(e){i.addTrack(e,n.localStream)})),this.peerConnections[e]=i,i.getAndSetLocalSessionDescription(this.maxBandwidth).then((function(){h.trace("getAndSetLocalSessionDescription success"),i._startDialingTimer(t,r)})).catch((function(e){h.trace("getAndSetLocalSessionDescription error: "+e)}))}},{key:"accept",value:function(e){var t=this,r=b(e);if(h.trace("Accept, extension: "+JSON.stringify(r.userInfo)),this.state!==m.ACTIVE){if(this.state===m.CLOSED)return h.traceError("Can't accept, the session is already closed, return."),void this.stop({});this.state=m.ACTIVE,this.acceptCallTime=new Date,this._clearAnswerTimer(),this._acceptInternal(this.initiatorID,r);var n=this._uniqueOpponentsIDsWithoutInitiator();if(n.length>0){var i=(this.acceptCallTime-this.startCallTime)/1e3;this._startWaitingOfferOrAnswerTimer(i),n.forEach((function(e){t.currentUserID>e&&t._callInternal(e,{},!0)}))}}else h.traceError("Can't accept, the session is already active, return.")}},{key:"_acceptInternal",value:function(e,t){var r=this,n=this.peerConnections[e];n?(this.localStream.getTracks().forEach((function(e){n.addTrack(e,r.localStream)})),n.setRemoteSessionDescription("offer",n.getRemoteSDP()).then((function(){h.trace("'setRemoteSessionDescription' success"),n.getAndSetLocalSessionDescription(r.maxBandwidth).then((function(){h.trace("'getAndSetLocalSessionDescription' success"),t.sessionID=r.ID,t.callType=r.callType,t.callerID=r.initiatorID,t.opponentsIDs=r.opponentsIDs,t.sdp=n.localDescription.sdp,r.signalingProvider.sendMessage(e,t,f.SignalingType.ACCEPT)})).catch((function(e){h.trace("'getAndSetLocalSessionDescription' error: "+e)}))})).catch((function(e){h.traceError("'setRemoteSessionDescription' error: "+e)}))):h.traceError("Can't accept the call, there is no information about peer connection by some reason.")}},{key:"reject",value:function(e){var t=this,r=b(e);h.trace("Reject, extension: "+JSON.stringify(r.userInfo)),this.state=m.REJECTED,this._clearAnswerTimer(),r.sessionID=this.ID,r.callType=this.callType,r.callerID=this.initiatorID,r.opponentsIDs=this.opponentsIDs,Object.keys(this.peerConnections).forEach((function(e){var n=t.peerConnections[e];t.signalingProvider.sendMessage(n.userID,r,f.SignalingType.REJECT)})),this._close()}},{key:"stop",value:function(e){var t=this,r=b(e);h.trace("Stop, extension: "+JSON.stringify(r.userInfo)),this.state=m.HUNGUP,this.answerTimer&&this._clearAnswerTimer(),r.sessionID=this.ID,r.callType=this.callType,r.callerID=this.initiatorID,r.opponentsIDs=this.opponentsIDs,Object.keys(this.peerConnections).forEach((function(e){var n=t.peerConnections[e];t.signalingProvider.sendMessage(n.userID,r,f.SignalingType.STOP)})),this._close()}},{key:"canInitiateIceRestart",value:function(e){return"offer"===this.peerConnections[e].type}},{key:"iceRestart",value:function(e){var t=this;this.peerConnections[e].getAndSetLocalSessionDescription(this.maxBandwidth,{iceRestart:!0}).then((function(r){h.trace("[iceRestart][getAndSetLocalSessionDescription] Ok");var n={sessionID:t.ID,sdp:r.sdp};t.signalingProvider.sendMessage(e,n,f.SignalingType.RESTART)})).catch((function(e){h.trace("[iceRestart][getAndSetLocalSessionDescription] Error: "+e)}))}},{key:"mute",value:function(e){this._muteStream(0,e)}},{key:"unmute",value:function(e){this._muteStream(1,e)}},{key:"_processOnCall",value:function(e,t){var r=this;this._uniqueOpponentsIDs().forEach((function(n){var i,s=r.peerConnections[n];s?n==e&&(s.updateRemoteSDP(t.sdp),e!=r.initiatorID&&r.state===m.ACTIVE&&r._acceptInternal(e,{})):(i=n!=e&&r.currentUserID>n?r._createPeer(n,"offer"):r._createPeer(n,"answer"),r.peerConnections[n]=i,n==e&&(i.updateRemoteSDP(t.sdp),r._startAnswerTimer()))}))}},{key:"_processOnAccept",value:function(e,t){var r=this.peerConnections[e];r?(r._clearDialingTimer(),r.setRemoteSessionDescription("answer",t.sdp).then((function(){h.trace("'setRemoteSessionDescription' success")})).catch((function(e){h.traceError("'setRemoteSessionDescription' error: "+e)}))):h.traceWarning("Ignore 'OnAccept', there is no information about peer connection by some reason.")}},{key:"_processOnReject",value:function(e,t){var r=this.peerConnections[e];this._clearWaitingOfferOrAnswerTimer(),r?r.release():h.traceWarning("Ignore 'OnReject', there is no information about peer connection by some reason."),this._closeSessionIfAllConnectionsClosed()}},{key:"_processOnStop",value:function(e,t){var r=this;if(this._clearAnswerTimer(),e===this.initiatorID){var n=Object.keys(this.peerConnections);n.length>0?n.forEach((function(e){r.peerConnections[e].release()})):h.traceWarning("Ignore 'OnStop', there is no information about peer connections by some reason.")}else{var i=this.peerConnections[e];i?i.release():h.traceWarning("Ignore 'OnStop', there is no information about peer connection by some reason.")}this._closeSessionIfAllConnectionsClosed()}},{key:"_processOnIceCandidates",value:function(e,t){var r=this.peerConnections[e];r?r.addCandidates(t.iceCandidates):h.traceWarning("Ignore 'OnIceCandidates', there is no information about peer connection by some reason.")}},{key:"_processOnIceRestart",value:function(e,t){var r=this,n=this.peerConnections[e];n?n.setRemoteSessionDescription("offer",t.sdp).then((function(){h.trace("[_processOnIceRestart]'setRemoteSessionDescription' success"),n.getAndSetLocalSessionDescription(r.maxBandwidth).then((function(t){h.trace("[_processOnIceRestart]'getAndSetLocalSessionDescription' success");var n={sessionID:r.ID,sdp:t.sdp};r.signalingProvider.sendMessage(e,n,f.SignalingType.RESTART_ACCEPT)})).catch((function(e){h.trace("[_processOnIceRestart] 'getAndSetLocalSessionDescription' error: "+e)}))})).catch((function(e){h.traceError("[_processOnIceRestart] 'setRemoteSessionDescription' error: "+e)})):h.traceWarning("[_processOnIceRestart] Ignore 'OnIceRestart', there is no information about peer connection by some reason.")}},{key:"_processOnIceRestartAccept",value:function(e,t){var r=this.peerConnections[e];r?r.setRemoteSessionDescription("answer",t.sdp).then((function(){h.trace("[_processOnIceRestartAccept] 'setRemoteSessionDescription' success")})).catch((function(e){h.traceError("[_processOnIceRestartAccept] 'setRemoteSessionDescription' error: "+e)})):h.traceWarning("[_processOnIceRestartAccept] Ignore 'OnIceRestartAccept', there is no information about peer connection by some reason.")}},{key:"_processCall",value:function(e,t){var r=t||{};r.sessionID=this.ID,r.callType=this.callType,r.callerID=this.initiatorID,r.opponentsIDs=this.opponentsIDs,r.sdp=e.localDescription.sdp,r.userInfo=t.userInfo||{},this.signalingProvider.sendMessage(e.userID,r,f.SignalingType.CALL)}},{key:"_processIceCandidates",value:function(e,t){var r={};r.sessionID=this.ID,r.callType=this.callType,r.callerID=this.initiatorID,r.opponentsIDs=this.opponentsIDs,this.signalingProvider.sendCandidate(e.userID,t,r)}},{key:"_processOnNotAnswer",value:function(e){h.trace("Answer timeout callback for session "+this.ID+" for user "+e.userID),this._clearWaitingOfferOrAnswerTimer(),e.release(),p.safeCallbackCall(this.onUserNotAnswerListener,this,e.userID),this._closeSessionIfAllConnectionsClosed()}},{key:"_onRemoteStreamListener",value:function(e,t){p.safeCallbackCall(this.onRemoteStreamListener,this,e,t)}},{key:"_onCallStatsReport",value:function(e,t,r){p.safeCallbackCall(this.onCallStatsReport,this,e,t,r)}},{key:"_onSessionConnectionStateChangedListener",value:function(e,t){p.safeCallbackCall(this.onSessionConnectionStateChangedListener,this,e,t)}},{key:"_createPeer",value:function(e,t){this.startCallTime=new Date;var r,n,i={iceServers:(r=l.videochat.iceServers,n=p.cloneObject(r),Object.keys(n).forEach((function(e,t,r){n[t].hasOwnProperty("url")?n[t].urls=n[t].url:n[t].url=n[t].urls})),n)};l.videochat.alwaysRelayCalls&&(i.iceTransportPolicy="relay"),h.trace("_createPeer, iceServers: "+JSON.stringify(i));var s=new d(i);return s._init(this,e,this.ID,t),s}},{key:"_close",value:function(){var e=this;Object.keys(this.peerConnections).forEach((function(t){var r=e.peerConnections[t];try{r.release()}catch(e){p.DLog("Peer close error:",e)}})),this._closeLocalMediaStream(),this.state=m.CLOSED,p.safeCallbackCall(this.onSessionCloseListener,this)}},{key:"_closeSessionIfAllConnectionsClosed",value:function(){var e=this,t=!0;Object.keys(this.peerConnections).forEach((function(r){var n,i=e.peerConnections[r];try{n="closed"===i.iceConnectionState||"closed"===i.signalingState||i.released?"closed":null}catch(e){h.traceError(e),n="closed"}"closed"!==n&&(t=!1)})),h.trace("All peer connections closed: "+t),t&&(this._closeLocalMediaStream(),p.safeCallbackCall(this.onSessionCloseListener,this),this.state=m.CLOSED)}},{key:"_closeLocalMediaStream",value:function(){this.localStream&&(this.localStream.getAudioTracks().forEach((function(e){e.stop()})),this.localStream.getVideoTracks().forEach((function(e){e.stop()})),this.localStream=null)}},{key:"_muteStream",value:function(e,t){"audio"===t&&this.localStream.getAudioTracks().length>0?this.localStream.getAudioTracks().forEach((function(t){t.enabled=!!e})):"video"===t&&this.localStream.getVideoTracks().length>0&&this.localStream.getVideoTracks().forEach((function(t){t.enabled=!!e}))}},{key:"_clearAnswerTimer",value:function(){this.answerTimer&&(h.trace("_clearAnswerTimer"),clearTimeout(this.answerTimer),this.answerTimer=null)}},{key:"_startAnswerTimer",value:function(){var e=this;h.trace("_startAnswerTimer");var t=1e3*l.videochat.answerTimeInterval;this.answerTimer=setTimeout((function(){h.trace("_answerTimeoutCallback"),"function"==typeof e.onSessionCloseListener&&e._close(),e.answerTimer=null}),t)}},{key:"_clearWaitingOfferOrAnswerTimer",value:function(){this.waitingOfferOrAnswerTimer&&(h.trace("_clearWaitingOfferOrAnswerTimer"),clearTimeout(this.waitingOfferOrAnswerTimer),this.waitingOfferOrAnswerTimer=null)}},{key:"_startWaitingOfferOrAnswerTimer",value:function(e){var t=this,r=l.videochat.answerTimeInterval-e<0?1:l.videochat.answerTimeInterval-e;h.trace("_startWaitingOfferOrAnswerTimer, timeout: "+r),this.waitingOfferOrAnswerTimer=setTimeout((function(){h.trace("waitingOfferOrAnswerTimeoutCallback"),Object.keys(t.peerConnections).forEach((function(e){var r=t.peerConnections[e];r.state!==v.CONNECTING&&r.state!==v.NEW||t._processOnNotAnswer(r)})),t.waitingOfferOrAnswerTimer=null}),1e3*r)}},{key:"_uniqueOpponentsIDs",value:function(){var e=this,t=[];return this.initiatorID!==this.currentUserID&&t.push(this.initiatorID),this.opponentsIDs.forEach((function(r){r!=e.currentUserID&&t.push(parseInt(r))})),t}},{key:"_uniqueOpponentsIDsWithoutInitiator",value:function(){var e=this,t=[];return this.opponentsIDs.forEach((function(r){r!=e.currentUserID&&t.push(parseInt(r))})),t}},{key:"toString",value:function(){return"ID: "+this.ID+", initiatorID:  "+this.initiatorID+", opponentsIDs: "+this.opponentsIDs+", state: "+this.state+", callType: "+this.callType}}])}();function b(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t={userInfo:e};try{p.isObject(e)?t.userInfo=p.cloneObject(e,!0):h.traceWarning("Ignore 'extension', must be an object.")}catch(e){h.traceWarning(e.message)}return t}e.exports=y},7947:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(7383)),s=n(r(4579)),a=r(610).SignalingConstants,o=r(3341),c=function(){return(0,s.default)((function e(t){(0,i.default)(this,e),this.delegate=t}),[{key:"_onMessage",value:function(e,t){var r=this._getExtension(t),n=r.sessionID,i=r.signalType;switch(delete r.moduleIdentifier,delete r.sessionID,delete r.signalType,i){case a.SignalingType.CALL:this.delegate._onCallListener(e,n,r);break;case a.SignalingType.ACCEPT:this.delegate._onAcceptListener(e,n,r);break;case a.SignalingType.REJECT:this.delegate._onRejectListener(e,n,r);break;case a.SignalingType.STOP:this.delegate._onStopListener(e,n,r);break;case a.SignalingType.CANDIDATE:this.delegate._onIceCandidatesListener(e,n,r);break;case a.SignalingType.RESTART:this.delegate._onIceRestartListener(e,n,r);break;case a.SignalingType.RESTART_ACCEPT:this.delegate._onIceRestartAcceptListener(e,n,r)}}},{key:"_getExtension",value:function(e){if(!e)return null;for(var t,r,n,i={},s=[],a=[],c=e.childNodes||e.children,u=0,l=c.length;u<l;u++){var d=c[u].childNodes||c[u].children,p=c[u].tagName||c[u].name;if("iceCandidates"===p)for(var h=0,f=d.length;h<f;h++){t={};for(var m=0,v=(n=d[h].childNodes||d[h].children).length;m<v;m++){var g=n[m].tagName||n[m].name,y=n[m].textContent||n[m].children[0];t[g]="sdpMLineIndex"===g?parseInt(y):y}s.push(t)}else if("opponentsIDs"===p)for(var b=0,k=d.length;b<k;b++)r=d[b].textContent||d[b].children[0],a.push(parseInt(r));else if(d.length>1)if((c[u].textContent||c[u].children[0]).length>4096){for(var C="",S=0;S<d.length;++S)C+=d.textContent||d.children[0];i[p]=C}else i=o._XMLtoJS(i,p,c[u]);else"userInfo"===p?i=o._XMLtoJS(i,p,c[u]):i[p]=c[u].textContent||c[u].children[0]}return s.length>0&&(i.iceCandidates=s),a.length>0&&(i.opponentsIDs=a),i}}])}();e.exports=c},8838:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3738)),s=n(r(7383)),a=n(r(4579)),o=r(8398),c=r(610).SignalingConstants,u=r(3532),l=r(5842),d=r(3341),p=function(){return(0,a.default)((function e(t){(0,s.default)(this,e),this.signalingConnection=t}),[{key:"sendCandidate",value:function(e,t,r){var n=r||{};n.iceCandidates=t,this.sendMessage(e,n,c.SignalingType.CANDIDATE)}},{key:"sendMessage",value:function(e,t,r){var n=t||{};n.moduleIdentifier=c.MODULE_ID,n.signalType=r,n.platform="web",n.userInfo&&(Object.keys(n.userInfo).length?0===n.userInfo.maxBandwidth&&delete n.userInfo.maxBandwidth:delete n.userInfo);var s={to:o.getUserJid(e,l.creds.appId),type:"headline",id:u.getBsonObjectId()},a=d.createMessageStanza(s).c("extraParams",{xmlns:"jabber:client"});Object.keys(n).forEach((function(e){"iceCandidates"===e?(a=a.c("iceCandidates"),n[e].forEach((function(e){a=a.c("iceCandidate"),Object.keys(e).forEach((function(t){a=a.c(t).t(e[t]).up()})),a=a.up()})),a=a.up()):"opponentsIDs"===e?(a=a.c("opponentsIDs"),n[e].forEach((function(e){a=a.c("opponentID").t(e).up()})),a=a.up()):"object"===(0,i.default)(n[e])?d._JStoXML(e,n[e],a):a=a.c(e).t(n[e]).up()})),a=a.up(),this.signalingConnection.send(a)}}])}();e.exports=p},3974:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(3693)),s=n(r(7383)),a=n(r(4579)),o=r(2881).EventEmitter,c=r(4673).MediaStream,u=r(4651),l=r(3532),d=r(5842),p=r(4230),h=p.JANUS_EVENTS,f=p.JANUS_MEDIA_TRACKS_REASONS,m=function(){return(0,a.default)((function e(t){if((0,s.default)(this,e),!l.getEnv().reactnative&&!adapter)throw"Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter";if(this.token=t.token,delete t.token,this.configs=t,!this.configs.server)throw"'server' parameter is mandatory.";this.configs.server.includes("http")&&(this.configs.server=this.configs.server+"/janus"),this.configs.debug||(this.configs.debug="all"),this.engine=null,this.videoRoomPlugin=null,this.isOnlyAudio=!1,this.currentRoomId=null,this.remoteFeeds={},this.remoteJseps={},this.remoteFeedsAttachingInProgress={},this.bitrateTimers={},this.emitter=new o}),[{key:"createSession",value:function(e){var t=this;u.init({debug:this.configs.debug,callback:function(){u.isWebrtcSupported()?t.engine=new u({server:t.configs.server,iceServers:d.videochat.iceServers,token:t.token,success:function(){l.safeCallbackCall(e.success)},error:function(t){l.safeCallbackCall(e.error,t)},destroyed:function(){l.safeCallbackCall(e.destroyed)},timeoutSessionCallback:function(){l.safeCallbackCall(e.timeoutSessionCallback)}}):l.safeCallbackCall(e.error,"Your browser does not support WebRTC, so you can't use this functionality.")}})}},{key:"getSessionId",value:function(){return this.engine?this.engine.getSessionId():null}},{key:"destroySession",value:function(e){this.engine.destroy({}),l.safeCallbackCall(e.success)}},{key:"attachVideoConferencingPlugin",value:function(e,t,r,n){var i=this,s=null,a=n.localStream;delete n.localStream;var o=n.displayName;delete n.displayName,this.engine.attach({plugin:"janus.plugin.videoroom",success:function(r){if(e){(s=r).userId=t,i.remoteFeedsAttachingInProgress[t]=s;var a={request:"join",room:i.currentRoomId,ptype:"listener",feed:t,display:o};s.send({message:a})}else i.videoRoomPlugin=r;l.safeCallbackCall(n.success)},error:function(e){l.safeCallbackCall(n.error,e)},consentDialog:function(e){l.safeCallbackCall(n.consentDialog,e)},mediaState:function(e,t){l.safeCallbackCall(n.mediaState,e,t)},webrtcState:function(e){l.safeCallbackCall(n.webrtcState,e)},slowLink:function(e,t){l.safeCallbackCall(n.slowLink,e,t)},iceState:function(e){l.safeCallbackCall(n.iceState,e)},onmessage:function(t,s){var o=t.videoroom;if(e){if(o)if("attached"===o){var c=t.id;i.remoteFeeds[c]=i.remoteFeedsAttachingInProgress[c],i.remoteFeedsAttachingInProgress[c]=null}else t.error&&l.safeCallbackCall(n.error,t.error);if(s){var u=t.id;i.remoteJseps[u]=s,i.createAnswer({remoteFeed:i.remoteFeeds[u],jsep:s},a,{success:function(){},error:function(e){l.safeCallbackCall(n.error,e)}})}}else{if(o)if("joined"===o){var d={media:r?{audio:!1,video:!1}:{audio:!0,video:!0},stream:r?null:a};i.createOffer(d,{success:function(){if(t.publishers){var e=t.publishers;for(var r in e){var n=e[r].id,s=e[r].display;i.emitter.emit(h.PARTICIPANT_JOINED,n,s,!0)}}},error:function(e){l.safeCallbackCall(n.error,e)}})}else if("event"===o)if(t.publishers){var p=t.publishers;for(var f in p){var m=p[f].id,v=p[f].display;i.emitter.emit(h.PARTICIPANT_JOINED,m,v,!1)}}else if(t.leaving){var g=t.leaving;i.detachRemoteFeed(g)&&i.emitter.emit(h.PARTICIPANT_LEFT,g,null)}else if(t.unpublished){var y=t.unpublished;"ok"!=y&&i.detachRemoteFeed(y)&&i.emitter.emit(h.PARTICIPANT_LEFT,y,null)}else t.error&&(l.DLog("[janus error message]",t.error),i.emitter.emit(h.ERROR,t),l.safeCallbackCall(n.error,t.error));s&&i.videoRoomPlugin.handleRemoteJsep({jsep:s})}},onlocaltrack:function(e,t){l.DLog("[onlocaltrack]",e,t),i.onLocalTrack(e,t)},onremotetrack:function(e,t,r,n){l.DLog("[onremotetrack]",e,t,r,n),i.onRemoteTrack(s,e,t,r,n)},ondataopen:function(e){l.DLog("[ondataopen]",e),i.emitter.emit(h.DATA_CHANNEL_OPEN,e)},ondata:function(e,t){l.DLog("[ondata]",t,e),i.emitter.emit(h.DATA_CHANNEL_MESSAGE,t,e)},oncleanup:function(){l.safeCallbackCall(n.oncleanup)},detached:function(){}})}},{key:"onLocalTrack",value:function(e,t){}},{key:"onRemoteTrack",value:function(e,t,r,n,s){var a=s&&s.reason;if(a===f.CREATED){var o=!e.stream||!e.tracks;o?(e.tracks=(0,i.default)({},r,t),e.stream=new c([t])):(e.tracks[r]=t,e.stream.addTrack(t)),o&&this.emitter.emit(h.REMOTE_STREAM,e.userId,e.stream)}else if(a===f.ENDED){delete e.tracks[r];var u=e.stream.getTracks().find((function(e){return e.kind===t.kind}));e.stream.removeTrack(u)}this.emitter.emit(h.REMOTE_TRACKS_UPDATED,e.userId,t,a)}},{key:"getPluginId",value:function(){return this.videoRoomPlugin?this.videoRoomPlugin.getId():null}},{key:"detachVideoConferencingPlugin",value:function(e){var t=this,r=function(){t.videoRoomPlugin=null,Object.keys(t.remoteFeeds).forEach((function(e){t.detachRemoteFeed(e)})),t.remoteFeeds={},t.remoteJseps={}};this.videoRoomPlugin.detach({success:function(){r(),l.safeCallbackCall(e.success)},error:function(t){r(),l.safeCallbackCall(e.error,t)}})}},{key:"join",value:function(e,t,r,n){var i=this,s=n.displayName;delete n.displayName,this.isOnlyAudio=!!r,l.DLog("isOnlyAudio: "+this.isOnlyAudio);var a={request:"join",room:e,ptype:"publisher",id:t,display:s};this.videoRoomPlugin.send({message:a,success:function(r){i.currentRoomId=e,i.currentUserId=t,l.safeCallbackCall(n.success)},error:function(e){l.safeCallbackCall(n.error,e)}})}},{key:"leave",value:function(e){if(l.DLog("leave"),this.engine.isConnected()){var t={request:"leave",room:this.currentRoomId,id:this.currentUserId};this.videoRoomPlugin&&this.videoRoomPlugin.send({message:t}),this.currentRoomId=null,this.currentUserId=null,l.safeCallbackCall(e.success)}else l.safeCallbackCall(e.success)}},{key:"listOnlineParticipants",value:function(e,t){var r={request:"listparticipants",room:e};this.videoRoomPlugin.send({message:r,success:function(e){var r=e?e.participants:[];l.safeCallbackCall(t.success,r)},error:function(e){l.safeCallbackCall(t.error,e)}})}},{key:"toggleAudioMute",value:function(){return this.videoRoomPlugin.isAudioMuted()?this.videoRoomPlugin.unmuteAudio():this.videoRoomPlugin.muteAudio(),this.videoRoomPlugin.isAudioMuted()}},{key:"isAudioMuted",value:function(){return this.videoRoomPlugin.isAudioMuted()}},{key:"toggleRemoteAudioMute",value:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var r=t.stream.getAudioTracks();if(r&&r.length>0){for(var n=0;n<r.length;++n)r[n].enabled=!r[n].enabled;return!r[0].enabled}return!1}},{key:"isRemoteAudioMuted",value:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var r=t.stream.getAudioTracks();return!!(r&&r.length>0)&&!r[0].enabled}},{key:"toggleVideoMute",value:function(){return this.videoRoomPlugin.isVideoMuted()?this.videoRoomPlugin.unmuteVideo():this.videoRoomPlugin.muteVideo(),this.videoRoomPlugin.isVideoMuted()}},{key:"isVideoMuted",value:function(){return this.videoRoomPlugin.isVideoMuted()}},{key:"toggleRemoteVideoMute",value:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var r=t.stream.getVideoTracks();if(r&&r.length>0){for(var n=0;n<r.length;++n)r[n].enabled=!r[n].enabled;return!r[0].enabled}return!1}},{key:"isRemoteVideoMuted",value:function(e){var t=this.remoteFeeds[e];if(!t)return!1;var r=t.stream.getVideoTracks();return!!(r&&r.length>0)&&!r[0].enabled}},{key:"switchVideoinput",value:function(e,t){console.warn('[ConnectyCube.videochatconference] The method "switchVideoinput(mediaDeviceId, callbacks)" was deprecated. Use "videoConferenceSession.switchMediaTracks(mediaDeviceId): Promise<any>" instead.')}},{key:"switchAudioinput",value:function(e,t){console.warn('[ConnectyCube.videochatconference] The method "switchAudioinput(mediaDeviceId, callbacks)" was deprecated. Use "videoConferenceSession.switchMediaTracks(mediaDeviceId): Promise<any>" instead.')}},{key:"sendKeyframeRequest",value:function(e,t){var r={request:"configure",room:e,keyframe:!0};this.videoRoomPlugin.send({message:r,success:function(e){l.safeCallbackCall(t.success)},error:function(e){l.safeCallbackCall(t.error,e)}})}},{key:"getTracksFromStream",value:function(e){var t=[],r=e.getAudioTracks();if(r.length){var n=r[0];t.push({type:"audio",capture:n,recv:!1})}var i=e.getVideoTracks();if(i.length){var s=i[0];t.push({type:"video",capture:s,recv:!1})}return t}},{key:"createOffer",value:function(e,t){var r=this;l.DLog("[JanusWrapper][createOffer]",e);var n=e.stream,i=e.media,s=e.replace,a={tracks:[{type:"data"}]};if(n){var o=this.getTracksFromStream(n);a.tracks=a.tracks.concat(o)}else if(i){var c=[];i.audio&&c.push({type:"audio",capture:i.audio,recv:!1,replace:!!s}),i.video&&c.push({type:"video",capture:i.video,recv:!1,replace:!!s}),a.tracks=a.tracks.concat(c)}else a.tracks=a.tracks.concat([{type:"audio",capture:!0,recv:!1,replace:!!s},{type:"video",capture:!0,recv:!1,replace:!!s}]);l.DLog("[JanusWrapper][createOffer][params]",a),a.customizeSdp=function(e){},a.success=function(e){var n={request:"configure",audio:!!i.audio,video:!!i.video};l.DLog("[JanusWrapper][createOffer][success]",n),r.videoRoomPlugin.send({message:n,jsep:e}),l.safeCallbackCall(t.success)},a.error=function(e){l.DLog("[JanusWrapper][createOffer][error]",e),i.audio?r.createOffer({media:{video:!1,audio:!1}},t):l.safeCallbackCall(t.error,e)},this.videoRoomPlugin.createOffer(a)}},{key:"getTracksMidsFromStream",value:function(e){var t=[],r=e.getAudioTracks();if(r.length){var n=r[0];t.push({type:"audio",mid:n.id,recv:!0})}var i=e.getVideoTracks();if(i.length){var s=i[0];t.push({type:"video",mid:s.id,recv:!0})}return t}},{key:"createAnswer",value:function(e,t,r){var n=this,i=e.remoteFeed,s=e.jsep;l.DLog("[JanusWrapper][createAnswer]",s,t);var a=[{type:"data"}];if(t){var o=this.getTracksMidsFromStream(t);a=a.concat(o)}l.DLog("[JanusWrapper][createAnswer][tracks]",a),i.createAnswer({jsep:s,tracks:a,success:function(e){var t={request:"start",room:n.currentRoomId};l.DLog("[JanusWrapper][createAnswer][success]",t),i.send({message:t,jsep:e}),l.safeCallbackCall(r.success)},error:function(e){l.DLog("[JanusWrapper][createAnswer][error]",e),l.safeCallbackCall(r.error,e)}})}},{key:"detachRemoteFeed",value:function(e){var t=this.remoteFeeds[e];return!!t&&(t.detach(),this.remoteFeeds[e]=null,this.remoteJseps[e]=null,!0)}},{key:"getUserBitrate",value:function(e){return this.remoteFeeds[e].getBitrate()}},{key:"getVolume",value:function(e){return this.videoRoomPlugin.getLocalVolume(null,e)}},{key:"getUserVolume",value:function(e,t){return this.remoteFeeds[e].getRemoteVolume(null,t)}},{key:"showBitrate",value:function(e,t){var r=this.remoteFeeds[e];l.getEnv().reactnative||"chrome"!==adapter.browserDetails.browser&&"firefox"!==adapter.browserDetails.browser||(this.bitrateTimers[e]=setInterval((function(){var e=r.getBitrate();t.text(e)}),1e3))}},{key:"hideBitrate",value:function(e,t){this.bitrateTimers[e]&&clearInterval(this.bitrateTimers[e]),this.bitrateTimers[e]=null,t.text=null}},{key:"on",value:function(e,t){return this.emitter.addListener(e,t)}},{key:"removeAllListeners",value:function(e){e?this.emitter.removeAllListeners(e):this.emitter.removeAllListeners()}}])}();e.exports={Client:m}},8860:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(4756)),s=n(r(9293)),a=n(r(7383)),o=n(r(4579)),c=r(5842),u=r(355),l=r(4230),d=l.DEVICE_INPUT_TYPES,p=l.CALL_TYPES,h=r(4673).mediaDevices,f=function(){return(0,o.default)((function e(t){(0,a.default)(this,e),this.proxy=t,this.DEVICE_INPUT_TYPES=d,this.CALL_TYPES=p,this.sessionsStore={},this.onParticipantJoinedListener=null,this.onParticipantLeftListener=null,this.onSlowLinkListener=null,this.onRemoteStreamListener=null,this.onRemoteTracksUpdatedListener=null,this.onRemoteConnectionStateChangedListener=null,this.onDataChannelOpenedListener=null,this.onDataChannelMessageListener=null,this.onSessionConnectionStateChangedListener=null,this.onErrorListener=null}),[{key:"createNewSession",value:function(){var e=new u(Object.assign(c.conference,{token:this.getCurrentSessionToken()}));return e.onParticipantJoinedListener=this.onParticipantJoinedListener,e.onParticipantLeftListener=this.onParticipantLeftListener,e.onSlowLinkListener=this.onSlowLinkListener,e.onRemoteStreamListener=this.onRemoteStreamListener,e.onRemoteTracksUpdatedListener=this.onRemoteTracksUpdatedListener,e.onRemoteConnectionStateChangedListener=this.onRemoteConnectionStateChangedListener,e.onDataChannelOpenedListener=this.onDataChannelOpenedListener,e.onDataChannelMessageListener=this.onDataChannelMessageListener,e.onSessionConnectionStateChangedListener=this.onSessionConnectionStateChangedListener,e.onErrorListener=this.onErrorListener,this.sessionsStore[e.id]=e,e}},{key:"getMediaDevices",value:(e=(0,s.default)(i.default.mark((function e(t){var r;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._listDevices();case 2:if(r=e.sent,t!==d.VIDEO){e.next=7;break}return e.abrupt("return",r.filter((function(e){return e.kind===d.VIDEO})));case 7:if(t!==d.AUDIO){e.next=9;break}return e.abrupt("return",r.filter((function(e){return e.kind===d.AUDIO})));case 9:return e.abrupt("return",r);case 10:case"end":return e.stop()}}),e,this)}))),function(t){return e.apply(this,arguments)})},{key:"_listDevices",value:function(){return h.enumerateDevices()}},{key:"clearSession",value:function(e){delete this.sessionsStore[e]}},{key:"getCurrentSessionToken",value:function(){if(!this.proxy.getSession())throw new Error("Session does not exist");return this.proxy.getSession().token}}]);var e}();e.exports=f},4230:e=>{"use strict";e.exports={CALL_TYPES:{VIDEO:"video",AUDIO:"audio"},DEVICE_INPUT_TYPES:{VIDEO:"videoinput",AUDIO:"audioinput"},JANUS_EVENTS:{PARTICIPANT_JOINED:"participant_joined",PARTICIPANT_LEFT:"participant_left",LOCAL_STREAM:"local_stream",REMOTE_STREAM:"remote_stream",REMOTE_TRACKS_UPDATED:"remote_tracks_updated",DATA_CHANNEL_OPEN:"data_channel_open",DATA_CHANNEL_MESSAGE:"data_channel_message",ERROR:"error"},JANUS_MEDIA_TRACKS_REASONS:{CREATED:"created",ENDED:"ended",MUTE:"mute",UNMUTE:"unmute"}}},355:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(4756)),s=n(r(3738)),a=n(r(3693)),o=n(r(9293)),c=n(r(7383)),u=n(r(4579));function l(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function d(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?l(Object(r),!0).forEach((function(t){(0,a.default)(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):l(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var p=r(3532),h=r(4673).mediaDevices,f=r(3974).Client,m=r(4230),v=m.CALL_TYPES,g=m.JANUS_EVENTS,y=function(){return(0,u.default)((function e(t){(0,c.default)(this,e),this.id="".concat(Math.random()),this._clientConf=new f(t),this._setOnParticipantJoinListener(),this._setOnParticipantLeftListener(),this._setOnRemoteStreamListener(),this._setOnRemoteTracksUpdatedListener(),this._setOnDataChannelOpenListener(),this._setOnDataChannelMessageListener(),this._setOnErrorListener(),this.currentUserDisplayName,this.localStream,this.onParticipantJoinedListener=null,this.onParticipantLeftListener=null,this.onSlowLinkListener=null,this.onRemoteStreamListener=null,this.onRemoteTracksUpdatedListener=null,this.onRemoteConnectionStateChangedListener=null,this.onDataChannelOpenedListener=null,this.onDataChannelMessageListener=null,this.onSessionConnectionStateChangedListener=null,this.onErrorListener=null}),[{key:"currentRoomId",get:function(){return this._clientConf.currentRoomId},set:function(e){return this._clientConf.currentRoomId=e}},{key:"currentPublisherPC",get:function(){return this._clientConf.videoRoomPlugin.webrtcStuff.pc}},{key:"_createSession",value:function(){var e=this,t=!1;return new Promise((function(r,n){e._clientConf.createSession({success:function(){t=!0,r()},error:function(r){t?e._onError(r):n(r)}})}))}},{key:"join",value:(a=(0,o.default)(i.default.mark((function e(t,r,n){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentUserDisplayName=n,e.next=3,this._createSession();case 3:return this.currentRoomId=t,e.next=6,this._createHandler(!1,r);case 6:return e.next=8,this._join(this.currentRoomId,r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return a.apply(this,arguments)})},{key:"joinAsListener",value:(n=(0,o.default)(i.default.mark((function e(t,r,n){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentUserDisplayName=n,e.next=3,this._createSession();case 3:return this.currentRoomId=t,e.next=6,this._createHandler(!1,r,!0);case 6:return e.next=8,this._join(this.currentRoomId,r);case 8:case"end":return e.stop()}}),e,this)}))),function(e,t,r){return n.apply(this,arguments)})},{key:"sendKeyframeRequest",value:function(e){var t=this;return new Promise((function(r,n){t._clientConf.sendKeyframeRequest(e,{success:r,error:n})}))}},{key:"_createListener",value:(r=(0,o.default)(i.default.mark((function e(t){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._createHandler(!0,t);case 2:case"end":return e.stop()}}),e,this)}))),function(e){return r.apply(this,arguments)})},{key:"_createHandler",value:function(e,t){var r=this,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return new Promise((function(i,s){r._clientConf.attachVideoConferencingPlugin(e,t,n,{success:i,error:s,iceState:e?r._onRemoteIceStateChanged.bind(r,t):r._onLocalIceStateChanged.bind(r),slowLink:e?r._onSlowLink.bind(r,t):r._onSlowLink.bind(r,void 0),localStream:r.localStream,displayName:r.currentUserDisplayName})}))}},{key:"_join",value:function(e,t){var r=this;return new Promise((function(n,i){r._clientConf.join(e,t,!1,{success:n,error:i,displayName:r.currentUserDisplayName})}))}},{key:"_setOnParticipantJoinListener",value:function(){this._clientConf.on(g.PARTICIPANT_JOINED,this._onParticipantJoined.bind(this))}},{key:"_setOnParticipantLeftListener",value:function(){this._clientConf.on(g.PARTICIPANT_LEFT,this._onParticipantLeft.bind(this))}},{key:"_setOnRemoteStreamListener",value:function(){this._clientConf.on(g.REMOTE_STREAM,this._onRemoteStream.bind(this))}},{key:"_setOnRemoteTracksUpdatedListener",value:function(){this._clientConf.on(g.REMOTE_TRACKS_UPDATED,this._onRemoteTracksUpdated.bind(this))}},{key:"_setOnDataChannelOpenListener",value:function(){this._clientConf.on(g.DATA_CHANNEL_OPEN,this._onDataChannelOpen.bind(this))}},{key:"_setOnDataChannelMessageListener",value:function(){this._clientConf.on(g.DATA_CHANNEL_MESSAGE,this._onDataChannelMessage.bind(this))}},{key:"_setOnErrorListener",value:function(){this._clientConf.on(g.ERROR,this._onError.bind(this))}},{key:"_onParticipantJoined",value:function(e,t,r){p.DLog("[_onParticipantJoined]",e,t,r),this._createListener(e),p.safeCallbackCall(this.onParticipantJoinedListener,this,e,t,r)}},{key:"_onParticipantLeft",value:function(e,t){p.DLog("[_onParticipantLeft]",e,t),p.safeCallbackCall(this.onParticipantLeftListener,this,e,t)}},{key:"_onError",value:function(e){p.DLog("[_onError]",e),p.safeCallbackCall(this.onErrorListener,this,e)}},{key:"_onDataChannelOpen",value:function(e){p.DLog("[_onDataChannelOpen]",e),p.safeCallbackCall(this.onDataChannelOpenedListener,this,e)}},{key:"_onDataChannelMessage",value:function(e,t){p.DLog("[_onDataChannelMessage]",e,t),p.safeCallbackCall(this.onDataChannelMessageListener,this,e,t)}},{key:"_onLocalIceStateChanged",value:function(e){p.DLog("[_onLocalIceStateChanged]",e),p.safeCallbackCall(this.onSessionConnectionStateChangedListener,this,e)}},{key:"_onRemoteIceStateChanged",value:function(e,t){p.DLog("[_onRemoteIceStateChanged]",e,t),p.safeCallbackCall(this.onRemoteConnectionStateChangedListener,this,e,t)}},{key:"_onRemoteStream",value:function(e,t){p.DLog("[_onRemoteStream]",e,t),p.safeCallbackCall(this.onRemoteStreamListener,this,e,t)}},{key:"_onRemoteTracksUpdated",value:function(e,t,r){p.DLog("[_onRemoteTracksUpdated]",e,t,r),p.safeCallbackCall(this.onRemoteTracksUpdatedListener,this,e,t,r)}},{key:"_onSlowLink",value:function(e,t,r){p.DLog("[_onSlowLink]",e,t,r),p.safeCallbackCall(this.onSlowLinkListener,this,e,t,r)}},{key:"listOfOnlineParticipants",value:function(){var e=this;return new Promise((function(t,r){e._clientConf.listOnlineParticipants(e.currentRoomId,{success:t,error:r})}))}},{key:"leave",value:(t=(0,o.default)(i.default.mark((function e(){return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._leaveGroup();case 2:return this.currentRoomId=void 0,this.currentUserDisplayName=void 0,e.next=6,this._detachVideoConferencingPlugin();case 6:return e.next=8,this._destroy();case 8:this.localStream&&(this.localStream.getTracks().forEach((function(e){return e.stop()})),this.localStream=void 0);case 9:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})},{key:"_leaveGroup",value:function(){var e=this;return new Promise((function(t,r){e._clientConf.leave({success:t,error:r})}))}},{key:"_destroy",value:function(){var e=this;return new Promise((function(t,r){e._clientConf.destroySession({success:t,error:r})}))}},{key:"_detachVideoConferencingPlugin",value:function(){var e=this;return new Promise((function(t,r){e._clientConf.detachVideoConferencingPlugin({success:t,error:r})}))}},{key:"getDisplayMedia",value:function(e){var t=this;if(!h.getDisplayMedia)throw new Error("Your environment does not support 'getDisplayMedia' API");var r=e&&e.elementId,n=e&&e.options,i=d({},e);return delete i.elementId,delete i.options,h.getDisplayMedia(i).then((function(e){return t._upsertStream(e,r,n)})).catch((function(e){throw new Error(e)}))}},{key:"getUserMedia",value:function(e){var t=this,r=e&&e.elementId,n=e&&e.options,i=d({},e);return delete i.elementId,delete i.options,h.getUserMedia(i).then((function(e){return t._upsertStream(e,r,n)})).catch((function(e){throw new Error(e)}))}},{key:"_upsertStream",value:function(e,t,r){var n=this,i=!!this.localStream;return i?(this.localStream.getTracks().forEach((function(t){t.kind===v.AUDIO&&0===e.getAudioTracks().length||(t.stop(),n.localStream.removeTrack(t))})),this._replaceTracks(e)):this.localStream=e,t&&(i&&this.detachMediaStream(t,r),this.attachMediaStream(t,this.localStream,r)),this.localStream}},{key:"_replaceTracks",value:function(e){var t=this;e.getTracks().forEach((function(e){var r=t.currentPublisherPC.getSenders().find((function(t){return e.kind===t.track.kind}));e.kind===v.AUDIO?e.enabled=t.localStream.getAudioTracks().every((function(e){return e.enabled})):e.enabled=t.localStream.getVideoTracks().every((function(e){return e.enabled})),r?(r.replaceTrack(e),t.localStream.addTrack(e)):console.warn("No sender found for track kind: ".concat(e.kind))}))}},{key:"switchMediaTracks",value:function(e){return e[v.VIDEO]?this._switchVideo(e[v.VIDEO]):e[v.AUDIO]?this._switchAudio(e[v.AUDIO]):Promise.reject()}},{key:"_switchVideo",value:function(e){return this._switchMediaTracks({audio:!0,video:{deviceId:e}})}},{key:"_switchAudio",value:function(e){return this._switchMediaTracks({audio:{deviceId:e},video:!0})}},{key:"_switchMediaTracks",value:function(e){var t=this;return this.getUserMedia(e,!0).then((function(e){var r=e.getTracks(),n=t.currentPublisherPC.getSenders();return r.forEach((function(e){n.find((function(t){return e.kind===t.track.kind})).replaceTrack(e)})),t.localStream}))}},{key:"muteVideo",value:function(){this.isVideoMuted()||this._clientConf.toggleVideoMute()}},{key:"unmuteVideo",value:function(){this.isVideoMuted()&&this._clientConf.toggleVideoMute()}},{key:"muteAudio",value:function(){this.isAudioMuted()||this._clientConf.toggleAudioMute()}},{key:"unmuteAudio",value:function(){this.isAudioMuted()&&this._clientConf.toggleAudioMute()}},{key:"isVideoMuted",value:function(){return this._clientConf.isVideoMuted()}},{key:"isAudioMuted",value:function(){return this._clientConf.isAudioMuted()}},{key:"getUserVolume",value:function(){var e=this;return new Promise((function(t,r){return e._clientConf.getVolume(t)}))}},{key:"getRemoteUserBitrate",value:function(e){return this._clientConf.getUserBitrate(e)}},{key:"getRemoteUserVolume",value:function(e){var t=this;return new Promise((function(r,n){return t._clientConf.getUserVolume(e,r)}))}},{key:"attachMediaStream",value:function(e,t,r){var n=document.getElementById(e);if(!n)throw new Error("Unable to attach media stream, element "+e+" is undefined");"object"===(0,s.default)(n.srcObject)?n.srcObject=t:n.src=window.URL.createObjectURL(t),r&&r.muted&&(n.muted=!0),r&&r.mirror&&(n.style.webkitTransform="scaleX(-1)",n.style.transform="scaleX(-1)"),n.onloadedmetadata=function(e){n.play()}}},{key:"detachMediaStream",value:function(e,t){var r=document.getElementById(e);if(!r)throw new Error("Unable to attach media stream, element "+e+" is undefined");r.pause(),"object"===(0,s.default)(r.srcObject)?r.srcObject=null:r.src="",t&&!t.mirror&&(r.style.webkitTransform="",r.style.transform="")}},{key:"sendData",value:(e=(0,o.default)(i.default.mark((function e(t,r){var n,s=this;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={data:t,label:r},e.abrupt("return",new Promise((function(e,t){var r={success:e,error:t};Object.assign(r,n),s._clientConf.videoRoomPlugin.data(r)})));case 2:case"end":return e.stop()}}),e)}))),function(t,r){return e.apply(this,arguments)})}]);var e,t,r,n,a}();e.exports=y},4651:(e,t,r)=>{"use strict";var n=r(4994),i=n(r(4756)),s=n(r(9293)),a=n(r(3738));function o(e,t){var r="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return c(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?c(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var s,a=!0,o=!1;return{s:function(){r=r.call(e)},n:function(){var e=r.next();return a=e.done,e},e:function(e){o=!0,s=e},f:function(){try{a||null==r.return||r.return()}finally{if(o)throw s}}}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n}var u=r(4673),l=u.adapter,d=u.navigator,p=u.MediaStream,h=u.MediaStreamTrack,f=u.RTCPeerConnection,m=u.RTCRtpReceiver,v=u.RTCRtpSender,g=r(3532);b.sessions={},b.mobile=g.getEnv().reactnative,b.isExtensionEnabled=function(){if(b.mobile)return!1;if(d.mediaDevices&&d.mediaDevices.getDisplayMedia)return!0;if(window.navigator.userAgent.match("Chrome")){var e=parseInt(window.navigator.userAgent.match(/Chrome\/(.*) /)[1],10),t=33;return window.navigator.userAgent.match("Linux")&&(t=35),e>=26&&e<=t||b.extension.isInstalled()}return!0};var y={extensionId:"hapfgfdkleiggjjpfpenajgdnfckjpaj",isInstalled:function(){return!b.mobile&&null!==document.querySelector("#janus-extension-installed")},getScreen:function(e){if(b.mobile)e();else{var t=window.setTimeout((function(){var t=new Error("NavigatorUserMediaError");return t.name='The required Chrome extension is not installed: click <a href="#">here</a> to install it. (NOTE: this will need you to refresh the page)',e(t)}),1e3);this.cache[t]=e,window.postMessage({type:"janusGetScreen",id:t},"*")}},init:function(){var e={};this.cache=e,b.mobile||window.addEventListener("message",(function(t){if(t.origin==window.location.origin)if("janusGotScreen"==t.data.type&&e[t.data.id]){var r=e[t.data.id];if(delete e[t.data.id],""===t.data.sourceId){var n=new Error("NavigatorUserMediaError");n.name="You cancelled the request for permission, giving up...",r(n)}else r(null,t.data.sourceId)}else"janusGetScreenPending"==t.data.type&&window.clearTimeout(t.data.id)}))}};function b(e){if((e=e||{}).success="function"==typeof e.success?e.success:b.noop,e.error="function"==typeof e.error?e.error:b.noop,e.destroyed="function"==typeof e.destroyed?e.destroyed:b.noop,!b.initDone)return e.error("Library not initialized"),{};if(!b.isWebrtcSupported())return e.error("WebRTC not supported by this browser"),{};if(b.log("Library initialized: "+b.initDone),!e.server)return e.error("Invalid server url"),{};var t=!1,r=null,n={},a=null,c=null,u=0,l=e.server;b.isArray(l)?(b.log("Multiple servers provided ("+l.length+"), will use the first that works"),l=null,c=e.server,b.debug(c)):0===l.indexOf("ws")?(t=!0,b.log("Using WebSockets to contact Janus: "+l)):(t=!1,b.log("Using REST API to contact Janus: "+l));var g=e.iceServers||[{urls:"stun:stun.l.google.com:19302"}],y=e.iceTransportPolicy,k=e.bundlePolicy,C=!1;void 0!==e.withCredentials&&null!==e.withCredentials&&(C=!0===e.withCredentials);var S=10;void 0!==e.max_poll_events&&null!==e.max_poll_events&&(S=e.max_poll_events),S<1&&(S=1);var w=null;void 0!==e.token&&null!==e.token&&(w=e.token);var x=null;void 0!==e.apisecret&&null!==e.apisecret&&(x=e.apisecret),this.destroyOnUnload=!0,void 0!==e.destroyOnUnload&&null!==e.destroyOnUnload&&(this.destroyOnUnload=!0===e.destroyOnUnload);var _=25e3;void 0!==e.keepAlivePeriod&&null!==e.keepAlivePeriod&&(_=e.keepAlivePeriod),isNaN(_)&&(_=25e3);var T=6e4;function I(e){var t={high:9e5,medium:3e5,low:1e5};return null!=e&&(e.high&&(t.high=e.high),e.medium&&(t.medium=e.medium),e.low&&(t.low=e.low)),t}void 0!==e.longPollTimeout&&null!==e.longPollTimeout&&(T=e.longPollTimeout),isNaN(T)&&(T=6e4);var E=!1,O=null,D={},L=this,P=0,A={};function j(){if(null!=O)if(b.debug("Long poll..."),E){var t=l+"/"+O+"?rid="+(new Date).getTime();S&&(t=t+"&maxev="+S),w&&(t=t+"&token="+encodeURIComponent(w)),x&&(t=t+"&apisecret="+encodeURIComponent(x)),b.httpAPICall(t,{verb:"GET",withCredentials:C,success:R,timeout:T,error:function(t,r){if(b.error(t+":",r),++P>3)return E=!1,void e.error("Lost connection to the server (is it down?)");j()}})}else b.warn("Is the server down? (connected=false)")}function R(e,n){if(P=0,t||null==O||!0===n||j(),t||!b.isArray(e))if("keepalive"!==e.janus)if("server_info"!==e.janus)if("ack"!==e.janus)if("success"!==e.janus)if("trickle"===e.janus){var i=e.sender;if(!i)return void b.warn("Missing sender...");var s=D[i];if(!s)return void b.debug("This handle is not attached to this session");var a=e.candidate;b.debug("Got a trickled candidate on session "+O),b.debug(a);var o=s.webrtcStuff;o.pc&&o.remoteSdp?(b.debug("Adding remote candidate:",a),a&&!0!==a.completed?o.pc.addIceCandidate(a):o.pc.addIceCandidate(b.endOfCandidates)):(b.debug("We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate"),o.candidates||(o.candidates=[]),o.candidates.push(a),b.debug(o.candidates))}else{if("webrtcup"===e.janus){b.debug("Got a webrtcup event on session "+O),b.debug(e);var c=e.sender;if(!c)return void b.warn("Missing sender...");var u=D[c];return u?void u.webrtcState(!0):void b.debug("This handle is not attached to this session")}if("hangup"===e.janus){b.debug("Got a hangup event on session "+O),b.debug(e);var l=e.sender;if(!l)return void b.warn("Missing sender...");var d=D[l];if(!d)return void b.debug("This handle is not attached to this session");d.webrtcState(!1,e.reason),d.hangup()}else if("detached"===e.janus){b.debug("Got a detached event on session "+O),b.debug(e);var p=e.sender;if(!p)return void b.warn("Missing sender...");var h=D[p];if(!h)return;h.ondetached(),h.detach()}else if("media"===e.janus){b.debug("Got a media event on session "+O),b.debug(e);var f=e.sender;if(!f)return void b.warn("Missing sender...");var m=D[f];if(!m)return void b.debug("This handle is not attached to this session");m.mediaState(e.type,e.receiving,e.mid)}else if("slowlink"===e.janus){b.debug("Got a slowlink event on session "+O),b.debug(e);var v=e.sender;if(!v)return void b.warn("Missing sender...");var g=D[v];if(!g)return void b.debug("This handle is not attached to this session");g.slowLink(e.uplink,e.lost,e.mid)}else{if("error"===e.janus){b.error("Ooops: "+e.error.code+" "+e.error.reason),b.debug(e);var y=e.transaction;if(y){var k=A[y];k&&k(e),delete A[y]}return}if("event"===e.janus){b.debug("Got a plugin event on session "+O),b.debug(e);var C=e.sender;if(!C)return void b.warn("Missing sender...");var S=e.plugindata;if(!S)return void b.warn("Missing plugindata...");b.debug("  -- Event is coming from "+C+" ("+S.plugin+")");var w=S.data;b.debug(w);var x=D[C];if(!x)return void b.warn("This handle is not attached to this session");var _=e.jsep;_&&(b.debug("Handling SDP as well..."),b.debug(_));var T=x.onmessage;T?(b.debug("Notifying application..."),T(w,_)):b.debug("No provided notification callback")}else{if("timeout"===e.janus)return b.error("Timeout on session "+O),b.debug(e),void(t&&r.close(3504,"Gateway timeout"));b.warn("Unknown message/event  '"+e.janus+"' on session "+O),b.debug(e)}}}else{b.debug("Got a success on session "+O),b.debug(e);var I=e.transaction;if(I){var E=A[I];E&&E(e),delete A[I]}}else{b.debug("Got an ack on session "+O),b.debug(e);var L=e.transaction;if(L){var M=A[L];M&&M(e),delete A[L]}}else{b.debug("Got info on the Janus instance"),b.debug(e);var U=e.transaction;if(U){var N=A[U];N&&N(e),delete A[U]}}else b.vdebug("Got a keepalive on session "+O);else for(var z=0;z<e.length;z++)R(e[z],!0)}function M(){if(l&&t&&E){a=setTimeout(M,_);var e={janus:"keepalive",session_id:O,transaction:b.randomString(12)};w&&(e.token=w),x&&(e.apisecret=x),r.send(JSON.stringify(e))}}function U(i){var s=b.randomString(12),o={janus:"create",transaction:s};if(i.reconnect&&(E=!1,o.janus="claim",o.session_id=O,r&&(r.onopen=null,r.onerror=null,r.onclose=null,a&&(clearTimeout(a),a=null))),w&&(o.token=w),x&&(o.apisecret=x),!l&&b.isArray(c)&&(0===(l=c[u]).indexOf("ws")?(t=!0,b.log("Server #"+(u+1)+": trying WebSockets to contact Janus ("+l+")")):(t=!1,b.log("Server #"+(u+1)+": trying REST API to contact Janus ("+l+")"))),t)for(var d in r=b.newWebSocket(l,"janus-protocol"),n={error:function(){if(b.error("Error connecting to the Janus WebSockets server... "+l),b.isArray(c)&&!i.reconnect)return++u===c.length?void i.error("Error connecting to any of the provided Janus servers: Is the server down?"):(l=null,void setTimeout((function(){U(i)}),200));i.error("Error connecting to the Janus WebSockets server: Is the server down?")},open:function(){A[s]=function(e){if(b.debug(e),"success"!==e.janus)return b.error("Ooops: "+e.error.code+" "+e.error.reason),void i.error(e.error.reason);a=setTimeout(M,_),E=!0,O=e.session_id?e.session_id:e.data.id,i.reconnect?b.log("Claimed session: "+O):b.log("Created session: "+O),b.sessions[O]=L,i.success()},r.send(JSON.stringify(o))},message:function(e){R(JSON.parse(e.data))},close:function(){l&&E&&(E=!1,e.error("Lost connection to the server (is it down?)"))}})r.addEventListener(d,n[d]);else b.httpAPICall(l,{verb:"POST",withCredentials:C,body:o,success:function(e){if(b.debug(e),"success"!==e.janus)return b.error("Ooops: "+e.error.code+" "+e.error.reason),void i.error(e.error.reason);E=!0,O=e.session_id?e.session_id:e.data.id,i.reconnect?b.log("Claimed session: "+O):b.log("Created session: "+O),b.sessions[O]=L,j(),i.success()},error:function(e,t){if(b.error(e+":",t),b.isArray(c)&&!i.reconnect)return++u===c.length?void i.error("Error connecting to any of the provided Janus servers: Is the server down?"):(l=null,void setTimeout((function(){U(i)}),200));""===t?i.error(e+": Is the server down?"):t&&t.error?i.error(e+": "+t.error.message):i.error(e+": "+t)}})}function N(e,n){if((n=n||{}).success="function"==typeof n.success?n.success:b.noop,n.error="function"==typeof n.error?n.error:b.noop,!E)return b.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var i=D[e];if(!i||!i.webrtcStuff)return b.warn("Invalid handle"),void n.error("Invalid handle");var s=n.message,a=n.jsep,o=b.randomString(12),c={janus:"message",body:s,transaction:o};if(i.token&&(c.token=i.token),x&&(c.apisecret=x),a&&(c.jsep={type:a.type,sdp:a.sdp},a.e2ee&&(c.jsep.e2ee=!0),"hml"!==a.rid_order&&"lmh"!==a.rid_order||(c.jsep.rid_order=a.rid_order),a.force_relay&&(c.jsep.force_relay=!0)),b.debug("Sending message to plugin (handle="+e+"):"),b.debug(c),t)return c.session_id=O,c.handle_id=e,A[o]=function(e){if(b.debug("Message sent!"),b.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return b.warn("Request succeeded, but missing plugindata..."),void n.success();b.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return b.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(b.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(b.error("Unknown error"),n.error("Unknown error"))},void r.send(JSON.stringify(c));b.httpAPICall(l+"/"+O+"/"+e,{verb:"POST",withCredentials:C,body:c,success:function(e){if(b.debug("Message sent!"),b.debug(e),"success"===e.janus){var t=e.plugindata;if(!t)return b.warn("Request succeeded, but missing plugindata..."),void n.success();b.log("Synchronous transaction successful ("+t.plugin+")");var r=t.data;return b.debug(r),void n.success(r)}"ack"===e.janus?n.success():e.error?(b.error("Ooops: "+e.error.code+" "+e.error.reason),n.error(e.error.code+" "+e.error.reason)):(b.error("Unknown error"),n.error("Unknown error"))},error:function(e,t){b.error(e+":",t),n.error(e+": "+t)}})}function z(e,n){if(E){var i=D[e];if(i&&i.webrtcStuff){var s={janus:"trickle",candidate:n,transaction:b.randomString(12)};if(i.token&&(s.token=i.token),x&&(s.apisecret=x),b.vdebug("Sending trickle candidate (handle="+e+"):"),b.vdebug(s),t)return s.session_id=O,s.handle_id=e,void r.send(JSON.stringify(s));b.httpAPICall(l+"/"+O+"/"+e,{verb:"POST",withCredentials:C,body:s,success:function(e){b.vdebug("Candidate sent!"),b.vdebug(e),"ack"===e.janus||b.error("Ooops: "+e.error.code+" "+e.error.reason)},error:function(e,t){b.error(e+":",t)}})}else b.warn("Invalid handle")}else b.warn("Is the server down? (connected=false)")}function J(e,t,r,n,i){var s=D[e];if(s&&s.webrtcStuff){var a=s.webrtcStuff;if(a.pc){var c=function(e){b.log("Received state change on data channel:",e);var t=e.target.label,r=e.target.protocol,n=a.dataChannel[t]?a.dataChannel[t].readyState:"null";if(b.log("State change on <"+t+"> data channel: "+n),"open"===n){if(a.dataChannel[t].pending&&a.dataChannel[t].pending.length>0){b.log("Sending pending messages on <"+t+">:",a.dataChannel[t].pending.length);var i,c=o(a.dataChannel[t].pending);try{for(c.s();!(i=c.n()).done;){var u=i.value;b.log("Sending data on data channel <"+t+">"),b.debug(u),a.dataChannel[t].send(u)}}catch(e){c.e(e)}finally{c.f()}a.dataChannel[t].pending=[]}s.ondataopen(t,r)}};if(n)a.dataChannel[t]=n;else{var u=a.dataChannelOptions;r&&(u.protocol=r),a.dataChannel[t]=a.pc.createDataChannel(t,u)}a.dataChannel[t].onmessage=function(e){b.log("Received message on data channel:",e);var t=e.target.label;s.ondata(e.data,t)},a.dataChannel[t].onopen=c,a.dataChannel[t].onclose=c,a.dataChannel[t].onerror=function(e){b.error("Got error on data channel:",e)},a.dataChannel[t].pending=[],i&&a.dataChannel[t].pending.push(i)}else b.warn("Invalid PeerConnection")}else b.warn("Invalid handle")}function F(e,t){(t=t||{}).success="function"==typeof t.success?t.success:b.noop,t.error="function"==typeof t.error?t.error:b.noop;var r=D[e];if(!r||!r.webrtcStuff)return b.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff,i=t.text||t.data;if(!i)return b.warn("Invalid data"),void t.error("Invalid data");var s=t.label?t.label:b.dataChanDefaultLabel;return n.dataChannel[s]?"open"!==n.dataChannel[s].readyState?(n.dataChannel[s].pending.push(i),void t.success()):(b.log("Sending data on data channel <"+s+">"),b.debug(i),n.dataChannel[s].send(i),void t.success()):(J(e,s,t.protocol,!1,i,t.protocol),void t.success())}function q(e,t){(t=t||{}).success="function"==typeof t.success?t.success:b.noop,t.error="function"==typeof t.error?t.error:b.noop;var r=D[e];if(!r||!r.webrtcStuff)return b.warn("Invalid handle"),void t.error("Invalid handle");var n=r.webrtcStuff;if(!n.dtmfSender){if(n.pc){var i=n.pc.getSenders().find((function(e){return e.track&&"audio"===e.track.kind}));if(!i)return b.warn("Invalid DTMF configuration (no audio track)"),void t.error("Invalid DTMF configuration (no audio track)");n.dtmfSender=i.dtmf,n.dtmfSender&&(b.log("Created DTMF Sender"),n.dtmfSender.ontonechange=function(e){b.debug("Sent DTMF tone: "+e.tone)})}if(!n.dtmfSender)return b.warn("Invalid DTMF configuration"),void t.error("Invalid DTMF configuration")}var s=t.dtmf;if(!s)return b.warn("Invalid DTMF parameters"),void t.error("Invalid DTMF parameters");var a=s.tones;if(!a)return b.warn("Invalid DTMF string"),void t.error("Invalid DTMF string");var o="number"==typeof s.duration?s.duration:500,c="number"==typeof s.gap?s.gap:50;b.debug("Sending DTMF string "+a+" (duration "+o+"ms, gap "+c+"ms)"),n.dtmfSender.insertDTMF(a,o,c),t.success()}function V(e,n){(n=n||{}).success="function"==typeof n.success?n.success:b.noop,n.error="function"==typeof n.error?n.error:b.noop;var i=!0===n.noRequest;b.log("Destroying handle "+e+" (only-locally="+i+")"),le(e);var s=D[e];if(!s||s.detached)return delete D[e],void n.success();if(s.detached=!0,i)return delete D[e],void n.success();if(!E)return b.warn("Is the server down? (connected=false)"),void n.error("Is the server down? (connected=false)");var a={janus:"detach",transaction:b.randomString(12)};if(s.token&&(a.token=s.token),x&&(a.apisecret=x),t)return a.session_id=O,a.handle_id=e,r.send(JSON.stringify(a)),delete D[e],void n.success();b.httpAPICall(l+"/"+O+"/"+e,{verb:"POST",withCredentials:C,body:a,success:function(t){b.log("Destroyed handle:"),b.debug(t),"success"!==t.janus&&b.error("Ooops: "+t.error.code+" "+t.error.reason),delete D[e],n.success()},error:function(t,r){b.error(t+":",r),delete D[e],n.success()}})}function W(e,t){var r=D[e];if(!r||!r.webrtcStuff)throw b.warn("Invalid handle"),"Invalid handle";var n=r.webrtcStuff;if(!n.pc){var i={iceServers:g,iceTransportPolicy:y,bundlePolicy:k,sdpSemantics:"unified-plan"},s=!1;if(t.tracks){var a,c=o(t.tracks);try{for(c.s();!(a=c.n()).done;){var u=a.value;if(u.transforms&&(u.transforms.sender||u.transforms.receiver)){s=!0;break}}}catch(e){c.e(e)}finally{c.f()}}v&&(v.prototype.createEncodedStreams||v.prototype.createEncodedAudioStreams&&v.prototype.createEncodedVideoStreams)&&s&&(n.insertableStreams=!0,i.forceEncodedAudioInsertableStreams=!0,i.forceEncodedVideoInsertableStreams=!0,i.encodedInsertableStreams=!0),b.log("Creating PeerConnection"),n.pc=new f(i),b.debug(n.pc),n.pc.getStats&&(n.volume={},n.bitrate.value="0 kbits/sec"),b.log("Preparing local SDP and gathering candidates (trickle="+n.trickle+")"),n.pc.oniceconnectionstatechange=function(){n.pc&&r.iceState(n.pc.iceConnectionState)},n.pc.onicecandidate=function(r){if(!r.candidate||r.candidate.candidate&&r.candidate.candidate.indexOf("endOfCandidates")>0)b.log("End of candidates."),n.iceDone=!0,!0===n.trickle?z(e,{completed:!0}):function(e,t){(t=t||{}).success="function"==typeof t.success?t.success:b.noop,t.error="function"==typeof t.error?t.error:b.noop;var r=D[e];if(r&&r.webrtcStuff){var n=r.webrtcStuff;b.log("Sending offer/answer SDP..."),n.mySdp?(n.mySdp={type:n.pc.localDescription.type,sdp:n.pc.localDescription.sdp},!1===n.trickle&&(n.mySdp.trickle=!1),b.debug(t),n.sdpSent=!0,t.success(n.mySdp)):b.warn("Local SDP instance is invalid, not sending anything...")}else b.warn("Invalid handle, not sending anything")}(e,t);else{var i={candidate:r.candidate.candidate,sdpMid:r.candidate.sdpMid,sdpMLineIndex:r.candidate.sdpMLineIndex};!0===n.trickle&&z(e,i)}},n.pc.ontrack=function(e){if(b.log("Handling Remote Track",e),e.streams&&e.track){var t=e.transceiver?e.transceiver.mid||e.transceiver._mid:e.track.id;try{r.onremotetrack(e.track,t,!0,{reason:"created"})}catch(e){b.error("Error calling onremotetrack",e)}if(!e.track.onended){var i=null;b.log("Adding onended callback to track:",e.track),e.track.onended=function(e){b.log("Remote track removed:",e),clearTimeout(i);var t=n.pc?n.pc.getTransceivers():null,s=t?t.find((function(t){var r=t.receiver||t._receiver;return(r.track||r._track)===e.target})):null,a=s?s.mid||s._mid:e.target.id;try{r.onremotetrack(e.target,a,!1,{reason:"ended"})}catch(e){b.error("Error calling onremotetrack on removal",e)}},e.track.onmute=function(e){if(b.log("Remote track muted:",e),!i){var t=e.target;i=setTimeout((function(){b.log("Removing remote track");var e=n.pc?n.pc.getTransceivers():null,s=e?e.find((function(e){var r=e.receiver||e._receiver;return(r.track||r._track)===t})):null,a=s?s.mid||s._mid:t.id;try{r.onremotetrack(t,a,!1,{reason:"mute"})}catch(e){b.error("Error calling onremotetrack on mute",e)}i=null}),2520)}},e.track.onunmute=function(e){if(b.log("Remote track flowing again:",e),null!=i)clearTimeout(i),i=null;else try{var t=n.pc?n.pc.getTransceivers():null,s=t?t.find((function(t){var r=t.receiver||t._receiver;return(r.track||r._track)===e.target})):null,a=s?s.mid||s._mid:e.target.id;r.onremotetrack(e.target,a,!0,{reason:"unmute"})}catch(e){b.error("Error calling onremotetrack on unmute",e)}}}}}}}function B(e,t,r){return G.apply(this,arguments)}function G(){return(G=(0,s.default)(i.default.mark((function e(t,r,n){var s,a,c,u,l,d,p,h,f,m;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=n||{}).success="function"==typeof n.success?n.success:b.noop,n.error="function"==typeof n.error?n.error:ue,s=n.jsep,!r||!s){e.next=10;break}return b.error("Provided a JSEP to a createOffer"),n.error("Provided a JSEP to a createOffer"),e.abrupt("return");case 10:if(r||s&&s.type&&s.sdp){e.next=14;break}return b.error("A valid JSEP is required for createAnswer"),n.error("A valid JSEP is required for createAnswer"),e.abrupt("return");case 14:if(!n.media||n.tracks){e.next=36;break}if(n.tracks=b.mediaToTracks(n.media),!0!==n.simulcast&&!0!==n.simulcast2&&!n.svc){e.next=35;break}a=o(n.tracks),e.prev=18,a.s();case 20:if((c=a.n()).done){e.next=27;break}if("video"!==(u=c.value).type){e.next=25;break}return!0===n.simulcast||!0===n.simulcast2?u.simulcast=!0:n.svc&&(u.svc=n.svc),e.abrupt("break",27);case 25:e.next=20;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(18),a.e(e.t0);case 32:return e.prev=32,a.f(),e.finish(32);case 35:b.warn("Deprecated media object passed, use tracks instead. Automatically translated to:",n.tracks);case 36:if(!n.tracks||Array.isArray(n.tracks)){e.next=40;break}return b.error("Tracks must be an array"),n.error("Tracks must be an array"),e.abrupt("return");case 40:if((l=D[t])&&l.webrtcStuff){e.next=45;break}return b.warn("Invalid handle"),n.error("Invalid handle"),e.abrupt("return");case 45:if((d=l.webrtcStuff).trickle=(i=n.trickle,b.debug("isTrickleEnabled:",i),!1!==i),e.prev=47,W(t,n),!r){e.next=52;break}return e.next=52,ee(t,n);case 52:if(s){e.next=59;break}return e.next=55,X(t,n);case 55:p=e.sent,n.success(p),e.next=70;break;case 59:return e.next=61,d.pc.setRemoteDescription(s);case 61:if(b.log("Remote description accepted!"),d.remoteSdp=s.sdp,d.candidates&&d.candidates.length>0){for(h=0;h<d.candidates.length;h++)f=d.candidates[h],b.debug("Adding remote candidate:",f),f&&!0!==f.completed?d.pc.addIceCandidate(f):d.pc.addIceCandidate(b.endOfCandidates);d.candidates=[]}return e.next=66,ee(t,n);case 66:return e.next=68,Q(t,n);case 68:m=e.sent,n.success(m);case 70:e.next=76;break;case 72:e.prev=72,e.t1=e.catch(47),b.error(e.t1),n.error(e.t1);case 76:case"end":return e.stop()}var i}),e,null,[[18,29,32,35],[47,72]])})))).apply(this,arguments)}function H(e,t){(t=t||{}).success="function"==typeof t.success?t.success:b.noop,t.error="function"==typeof t.error?t.error:ue,t.customizeSdp="function"==typeof t.customizeSdp?t.customizeSdp:b.noop;var r=t.jsep,n=D[e];if(!n||!n.webrtcStuff)return b.warn("Invalid handle"),void t.error("Invalid handle");var i=n.webrtcStuff;if(r){if(!i.pc)return b.warn("Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep"),void t.error("No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep");t.customizeSdp(r),i.pc.setRemoteDescription(r).then((function(){if(b.log("Remote description accepted!"),i.remoteSdp=r.sdp,i.candidates&&i.candidates.length>0){for(var e=0;e<i.candidates.length;e++){var n=i.candidates[e];b.debug("Adding remote candidate:",n),n&&!0!==n.completed?i.pc.addIceCandidate(n):i.pc.addIceCandidate(b.endOfCandidates)}i.candidates=[]}t.success()}),t.error)}else t.error("Invalid JSEP")}function X(e,t){return K.apply(this,arguments)}function K(){return(K=(0,s.default)(i.default.mark((function e(t,r){var n,s,a,o,c;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=r||{}).customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:b.noop,(n=D[t])&&n.webrtcStuff){e.next=6;break}throw b.warn("Invalid handle"),"Invalid handle";case 6:return s=n.webrtcStuff,b.log("Creating offer (iceDone="+s.iceDone+")"),a={},!0===r.iceRestart&&(a.iceRestart=!0),b.debug(a),e.next=14,s.pc.createOffer(a);case 14:return o=e.sent,b.debug(o),c={type:"offer",sdp:o.sdp},r.customizeSdp(c),o.sdp=c.sdp,b.log("Setting local description"),s.mySdp={type:"offer",sdp:o.sdp},e.next=23,s.pc.setLocalDescription(o);case 23:if(s.mediaConstraints=a,s.iceDone||s.trickle){e.next=27;break}return b.log("Waiting for all candidates..."),e.abrupt("return",null);case 27:return s.insertableStreams&&(o.e2ee=!0),e.abrupt("return",o);case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Q(e,t){return $.apply(this,arguments)}function $(){return($=(0,s.default)(i.default.mark((function e(t,r){var n,s,a,o;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=r||{}).customizeSdp="function"==typeof r.customizeSdp?r.customizeSdp:b.noop,(n=D[t])&&n.webrtcStuff){e.next=6;break}throw b.warn("Invalid handle"),"Invalid handle";case 6:return s=n.webrtcStuff,b.log("Creating answer (iceDone="+s.iceDone+")"),e.next=10,s.pc.createAnswer();case 10:return a=e.sent,b.debug(a),o={type:"answer",sdp:a.sdp},r.customizeSdp(o),a.sdp=o.sdp,b.log("Setting local description"),s.mySdp={type:"answer",sdp:a.sdp},e.next=19,s.pc.setLocalDescription(a);case 19:if(s.iceDone||s.trickle){e.next=22;break}return b.log("Waiting for all candidates..."),e.abrupt("return",null);case 22:return s.insertableStreams&&(a.e2ee=!0),e.abrupt("return",a);case 24:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Y(e,t){return Z.apply(this,arguments)}function Z(){return(Z=(0,s.default)(i.default.mark((function e(t,r){var n,s,a;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=r||{}).success="function"==typeof r.success?r.success:b.noop,r.error="function"==typeof r.error?r.error:b.noop,!r.tracks||Array.isArray(r.tracks)){e.next=7;break}return b.error("Tracks must be an array"),r.error("Tracks must be an array"),e.abrupt("return");case 7:n=o(r.tracks);try{for(n.s();!(s=n.n()).done;)((a=s.value).add||!a.replace&&!a.remove)&&(a.replace=!0)}catch(e){n.e(e)}finally{n.f()}return e.prev=9,e.next=12,ee(t,r);case 12:r.success(),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(9),b.error(e.t0),r.error(e.t0);case 19:case"end":return e.stop()}}),e,null,[[9,15]])})))).apply(this,arguments)}function ee(e,t){return te.apply(this,arguments)}function te(){return(te=(0,s.default)(i.default.mark((function e(t,r){var n,s,a,c,u,l,f,g,y,k,C,S,w,x,_,T,E,O;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((n=D[t])&&n.webrtcStuff){e.next=4;break}throw b.warn("Invalid handle, not sending anything"),"Invalid handle";case 4:if((s=n.webrtcStuff).pc){e.next=8;break}throw b.warn("Invalid PeerConnection"),"Invalid PeerConnection";case 8:if((a=r.tracks)&&Array.isArray(a)&&0!==a.length){e.next=11;break}return e.abrupt("return");case 11:c=!1,u={},l=o(a),e.prev=14,l.s();case 16:if((f=l.n()).done){e.next=31;break}if(delete(g=f.value).gumGroup,g.type&&["audio","video"].includes(g.type)){e.next=21;break}return e.abrupt("continue",29);case 21:if(g.capture&&!(g.capture instanceof h)){e.next=23;break}return e.abrupt("continue",29);case 23:if(y=g.group?g.group:"default",u[y]||(u[y]={}),!u[y][g.type]){e.next=27;break}return e.abrupt("continue",29);case 27:g.gumGroup=y,u[y][g.type]=g;case 29:e.next=16;break;case 31:e.next=36;break;case 33:e.prev=33,e.t0=e.catch(14),l.e(e.t0);case 36:return e.prev=36,l.f(),e.finish(36);case 39:for(k=Object.keys(u),C=0,S=k;C<S.length;C++)w=S[C],(x=u[w]).audio&&x.video||(x.audio&&delete x.audio.gumGroup,x.video&&delete x.video.gumGroup,delete u[w]);_=!!r.jsep,T=o(a),e.prev=43,O=i.default.mark((function e(){var r,a,l,f,g,y,k,C,S,w,x,T,O,D,L,P,A,j,R,M,U,N,z,F,q,V,W,B,G,H,X,K,Q,$,Y,Z;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((r=E.value).type){e.next=4;break}return b.warn("Missing track type:",r),e.abrupt("return",0);case 4:if("data"!==r.type){e.next=12;break}if(!s.pc.ondatachannel){e.next=8;break}return b.warn("Data channel exists already, not creating another one"),e.abrupt("return",0);case 8:return b.log("Creating default data channel"),J(t,b.dataChanDefaultLabel,null,!1),s.pc.ondatachannel=function(e){b.log("Data channel created by Janus:",e),J(t,e.channel.label,e.channel.protocol,e.channel)},e.abrupt("return",0);case 12:if(void 0===r.add&&null===r.add&&void 0===r.remove&&null===r.remove&&void 0===r.replace&&null===r.replace&&(r.add=!0),!(r.add&&r.remove||r.add&&r.remove&&r.replace)){e.next=16;break}return b.warn("Conflicting actions for track, ignoring:",r),e.abrupt("return",0);case 16:if(r.add&&r.replace?(b.warn("Both add and replace provided, falling back to replace:",r),delete r.add):r.remove&&r.replace&&(b.warn("Both remove and replace provided, falling back to remove:",r),delete r.replace),a=r.type,"screen"===r.type&&(a="video"),l=null,f=null,l=r.mid?s.pc.getTransceivers().find((function(e){return e.mid===r.mid&&e.receiver.track.kind===a})):s.pc.getTransceivers().find((function(e){return e.receiver.track.kind===a})),!r.replace&&!r.remove){e.next=29;break}if(l){e.next=25;break}return b.warn("Couldn't find a transceiver for track:",r),e.abrupt("return",0);case 25:if(l.sender){e.next=28;break}return b.warn("No sender in the transceiver for track:",r),e.abrupt("return",0);case 28:f=l.sender;case 29:if(!_||l){e.next=34;break}if(l=s.pc.getTransceivers().find((function(e){return e.receiver.track.kind===a})),l){e.next=34;break}return b.warn("Couldn't find a transceiver for track:",r),e.abrupt("return",0);case 34:if(g=null,y=null,!r.remove){e.next=42;break}return b.log("Removing track from PeerConnection",r),y=f.track?f.track.id:null,e.next=40,f.replaceTrack(null);case 40:e.next=122;break;case 42:if(!r.capture){e.next=121;break}if(!(r.gumGroup&&u[r.gumGroup]&&u[r.gumGroup].stream)){e.next=51;break}k=u[r.gumGroup].stream,g="audio"===r.type?k.getAudioTracks()[0]:k.getVideoTracks()[0],delete u[r.gumGroup].stream,delete u[r.gumGroup],delete r.gumGroup,e.next=69;break;case 51:if(!(r.capture instanceof h)){e.next=55;break}g=r.capture,e.next=69;break;case 55:if(c||(c=!0,n.consentDialog(!0)),C=b.trackConstraints(r),S=null,"audio"!==r.type&&"video"!==r.type){e.next=65;break}return r.gumGroup&&(w="audio"===r.type?"video":"audio",u[r.gumGroup]&&u[r.gumGroup][w]&&(x=u[r.gumGroup][w],T=b.trackConstraints(x),C[w]=T[w])),e.next=61,d.mediaDevices.getUserMedia(C);case 61:S=e.sent,r.gumGroup&&C.audio&&C.video&&(u[r.gumGroup].stream=S,delete r.gumGroup),e.next=68;break;case 65:return e.next=67,d.mediaDevices.getDisplayMedia(C);case 67:S=e.sent;case 68:g="audio"===r.type?S.getAudioTracks()[0]:S.getVideoTracks()[0];case 69:if(!r.replace){e.next=77;break}return e.next=72,f.replaceTrack(g);case 72:O="sendrecv",!1!==r.recv&&"inactive"!==l.direction&&"sendonly"!==l.direction||(O="sendonly"),l.setDirection?l.setDirection(O):l.direction=O,e.next=118;break;case 77:if(s.myStream||(s.myStream=new p),"audio"===a||!r.simulcast&&!r.svc?(f=s.pc.addTrack(g,s.myStream),l=s.pc.getTransceivers().find((function(e){return e.sender===f}))):r.simulcast?"firefox"!==b.webRTCAdapter.browserDetails.browser?(b.log("Enabling rid-based simulcasting:",g),D=I(r.simulcastMaxBitrates),l=s.pc.addTransceiver(g,{direction:"sendrecv",streams:[s.myStream],sendEncodings:r.sendEncodings||[{rid:"h",active:!0,maxBitrate:D.high},{rid:"m",active:!0,maxBitrate:D.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:D.low,scaleResolutionDownBy:4}]})):(b.log("Enabling Simulcasting for Firefox (RID)"),l=s.pc.addTransceiver(g,{direction:"sendrecv",streams:[s.myStream]}),(f=l?l.sender:null)&&((L=f.getParameters())||(L={}),P=I(r.simulcastMaxBitrates),L.encodings=r.sendEncodings||[{rid:"h",active:!0,maxBitrate:P.high},{rid:"m",active:!0,maxBitrate:P.medium,scaleResolutionDownBy:2},{rid:"l",active:!0,maxBitrate:P.low,scaleResolutionDownBy:4}],f.setParameters(L))):(b.log("Enabling SVC ("+r.svc+"):",g),l=s.pc.addTransceiver(g,{direction:"sendrecv",streams:[s.myStream],sendEncodings:[{scalabilityMode:r.svc}]})),f||(f=l?l.sender:null),r.codec)if("firefox"===b.webRTCAdapter.browserDetails.browser)b.warn("setCodecPreferences not supported in Firefox, ignoring codec for track:",r);else if("string"!=typeof r.codec)b.warn("Invalid codec value, ignoring for track:",r);else if(A=a+"/"+r.codec.toLowerCase(),(j=m.getCapabilities(a).codecs.filter((function(e){return e.mimeType.toLowerCase()===A})))&&0!==j.length){if(l)try{l.setCodecPreferences(j)}catch(e){b.warn("Failed enforcing codec for this "+a+" track:",e)}}else b.warn("Codec not supported in this browser for this track, ignoring:",r);if(!r.bitrate){e.next=99;break}if(!r.simulcast&&!r.svc){e.next=86;break}b.warn("Ignoring bitrate for simulcast/SVC track, use sendEncodings for that"),e.next=99;break;case 86:if(!(isNaN(r.bitrate)||r.bitrate<0)){e.next=90;break}b.warn("Ignoring invalid bitrate for track:",r),e.next=99;break;case 90:if(!f){e.next=99;break}if((R=f.getParameters())&&R.encodings&&0!==R.encodings.length){e.next=96;break}b.warn("No encodings in the sender parameters, ignoring bitrate for track:",r),e.next=99;break;case 96:return R.encodings[0].maxBitrate=r.bitrate,e.next=99,f.setParameters(R);case 99:if("video"!==a||!r.framerate){e.next=117;break}if(!r.simulcast&&!r.svc){e.next=104;break}b.warn("Ignoring framerate for simulcast/SVC track, use sendEncodings for that"),e.next=117;break;case 104:if(!(isNaN(r.framerate)||r.framerate<0)){e.next=108;break}b.warn("Ignoring invalid framerate for track:",r),e.next=117;break;case 108:if(!f){e.next=117;break}if((M=f.getParameters())&&M.encodings&&0!==M.encodings.length){e.next=114;break}b.warn("No encodings in the sender parameters, ignoring framerate for track:",r),e.next=117;break;case 114:return M.encodings[0].maxFramerate=r.framerate,e.next=117,f.setParameters(M);case 117:r.transforms&&(f&&r.transforms.sender&&(U=null,v.prototype.createEncodedStreams?U=f.createEncodedStreams():(v.prototype.createAudioEncodedStreams||v.prototype.createEncodedVideoStreams)&&("audio"===a?U=f.createEncodedAudioStreams():"video"===a&&(U=f.createEncodedVideoStreams())),U&&(b.log("Insertable Streams sender transform:",U),U.readableStream&&U.writableStream?U.readableStream.pipeThrough(r.transforms.sender).pipeTo(U.writableStream):U.readable&&U.writable&&U.readable.pipeThrough(r.transforms.sender).pipeTo(U.writable))),l&&l.receiver&&r.transforms.receiver&&(N=null,m.prototype.createEncodedStreams?N=l.receiver.createEncodedStreams():(m.prototype.createAudioEncodedStreams||m.prototype.createEncodedVideoStreams)&&("audio"===a?N=l.receiver.createEncodedAudioStreams():"video"===a&&(N=l.receiver.createEncodedVideoStreams())),N&&(b.log("Insertable Streams receiver transform:",N),N.readableStream&&N.writableStream?N.readableStream.pipeThrough(r.transforms.receiver).pipeTo(N.writableStream):N.readable&&N.writable&&N.readable.pipeThrough(r.transforms.receiver).pipeTo(N.writable))));case 118:g&&!0===r.dontStop&&(g.dontStop=!0),e.next=122;break;case 121:if(r.recv&&!l&&(l=s.pc.addTransceiver(a))){if(r.codec)if("firefox"===b.webRTCAdapter.browserDetails.browser)b.warn("setCodecPreferences not supported in Firefox, ignoring codec for track:",r);else if("string"!=typeof r.codec)b.warn("Invalid codec value, ignoring for track:",r);else if(z=a+"/"+r.codec.toLowerCase(),(F=m.getCapabilities(a).codecs.filter((function(e){return e.mimeType.toLowerCase()===z})))&&0!==F.length)try{l.setCodecPreferences(F)}catch(e){b.warn("Failed enforcing codec for this "+a+" track:",e)}else b.warn("Codec not supported in this browser for this track, ignoring:",r);l.receiver&&r.transforms&&r.transforms.receiver&&(q=null,m.prototype.createEncodedStreams?q=l.receiver.createEncodedStreams():(m.prototype.createAudioEncodedStreams||m.prototype.createEncodedVideoStreams)&&("audio"===a?q=l.receiver.createEncodedAudioStreams():"video"===a&&(q=l.receiver.createEncodedVideoStreams())),q&&(b.log("Insertable Streams receiver transform:",q),q.readableStream&&q.writableStream?q.readableStream.pipeThrough(r.transforms.receiver).pipeTo(q.writableStream):q.readable&&q.writable&&q.readable.pipeThrough(r.transforms.receiver).pipeTo(q.writable)))}case 122:if(y&&s.myStream){if(V=null,"audio"===a&&s.myStream.getAudioTracks()&&s.myStream.getAudioTracks().length){W=o(s.myStream.getAudioTracks());try{for(W.s();!(B=W.n()).done;)(G=B.value).id===y&&(V=G,b.log("Removing audio track:",V))}catch(e){W.e(e)}finally{W.f()}}else if("video"===a&&s.myStream.getVideoTracks()&&s.myStream.getVideoTracks().length){H=o(s.myStream.getVideoTracks());try{for(H.s();!(X=H.n()).done;)(K=X.value).id===y&&(V=K,b.log("Removing video track:",V))}catch(e){H.e(e)}finally{H.f()}}if(V){try{s.myStream.removeTrack(V),n.onlocaltrack(V,!1)}catch(e){b.error("Error calling onlocaltrack on removal for renegotiation",e)}if(!0!==V.dontStop)try{V.stop()}catch(e){}}}if(g){s.myStream.addTrack(g),g.onended=function(e){b.log("Local track removed:",e);try{n.onlocaltrack(e.target,!1)}catch(e){b.error("Error calling onlocaltrack following end",e)}};try{n.onlocaltrack(g,!0)}catch(e){b.error("Error calling onlocaltrack for track add",e)}}l&&(Q=l.direction,$=null,Y=g&&l.sender.track,Z=!1!==r.recv&&l.receiver.track,Y&&Z?$="sendrecv":Y&&!Z?$="sendonly":!Y&&Z?$="recvonly":Y||Z||($="inactive"),$&&$!==Q&&(b.warn("Changing direction of transceiver to "+$+" (was "+Q+")",r),l.setDirection?l.setDirection($):l.direction=$));case 125:case"end":return e.stop()}}),e)})),T.s();case 46:if((E=T.n()).done){e.next=53;break}return e.delegateYield(O(),"t1",48);case 48:if(0!==e.t1){e.next=51;break}return e.abrupt("continue",51);case 51:e.next=46;break;case 53:e.next=58;break;case 55:e.prev=55,e.t2=e.catch(43),T.e(e.t2);case 58:return e.prev=58,T.f(),e.finish(58);case 61:c&&n.consentDialog(!1);case 62:case"end":return e.stop()}}),e,null,[[14,33,36,39],[43,55,58,61]])})))).apply(this,arguments)}function re(e){var t=D[e];if(!t||!t.webrtcStuff)return b.warn("Invalid handle"),null;var r=t.webrtcStuff;if(!r.pc)return b.warn("Invalid PeerConnection"),null;var n,i=[],s=o(r.pc.getTransceivers());try{for(s.s();!(n=s.n()).done;){var a=n.value,c=null;a.sender&&a.sender.track&&((c={mid:a.mid}).type=a.sender.track.kind,c.id=a.sender.track.id,c.label=a.sender.track.label),c&&i.push(c)}}catch(e){s.e(e)}finally{s.f()}return i}function ne(e){var t=D[e];if(!t||!t.webrtcStuff)return b.warn("Invalid handle"),null;var r=t.webrtcStuff;if(!r.pc)return b.warn("Invalid PeerConnection"),null;var n,i=[],s=o(r.pc.getTransceivers());try{for(s.s();!(n=s.n()).done;){var a=n.value,c=null;a.receiver&&a.receiver.track&&((c={mid:a.mid}).type=a.receiver.track.kind,c.id=a.receiver.track.id,c.label=a.receiver.track.label),c&&i.push(c)}}catch(e){s.e(e)}finally{s.f()}return i}function ie(e,t,r,n){n="function"==typeof n?n:b.noop;var i=D[e];if(!i||!i.webrtcStuff)return b.warn("Invalid handle"),void n(0);var s=r?"remote":"local",a=i.webrtcStuff;if(a.volume[s]||(a.volume[s]={value:0}),a.pc&&a.pc.getStats&&("chrome"===b.webRTCAdapter.browserDetails.browser||"safari"===b.webRTCAdapter.browserDetails.browser)){var o=a.pc;if(t){var c=a.pc.getTransceivers().find((function(e){return e.mid===t&&"audio"===e.receiver.track.kind}));if(!c)return b.warn("No audio transceiver with mid "+t),void n(0);if(r&&!c.receiver)return b.warn("Remote transceiver track unavailable"),void n(0);if(!r&&!c.sender)return b.warn("Local transceiver track unavailable"),void n(0);o=r?c.receiver:c.sender}return o.getStats().then((function(e){e.forEach((function(e){e&&"audio"===e.kind&&(r&&!e.remoteSource||!r&&"media-source"!==e.type||n(e.audioLevel?e.audioLevel:0))}))})),a.volume[s].value}return b.warn("Getting the "+s+" volume unsupported by browser"),void n(0)}function se(e,t,r){var n=D[e];if(!n||!n.webrtcStuff)return b.warn("Invalid handle"),!0;var i=n.webrtcStuff;if(!i.pc)return b.warn("Invalid PeerConnection"),!0;if(!i.myStream)return b.warn("Invalid local MediaStream"),!0;if(r){if(!i.myStream.getVideoTracks()||0===i.myStream.getVideoTracks().length)return b.warn("No video track"),!0;if(t){var s=i.pc.getTransceivers().find((function(e){return e.mid===t&&"video"===e.receiver.track.kind}));return s?s.sender&&s.sender.track?!s.sender.track.enabled:(b.warn("No video sender with mid "+t),!0):(b.warn("No video transceiver with mid "+t),!0)}return!i.myStream.getVideoTracks()[0].enabled}if(!i.myStream.getAudioTracks()||0===i.myStream.getAudioTracks().length)return b.warn("No audio track"),!0;if(t){var a=i.pc.getTransceivers().find((function(e){return e.mid===t&&"audio"===e.receiver.track.kind}));return a?a.sender&&a.sender.track?!a.sender.track.enabled:(b.warn("No audio sender with mid "+t),!0):(b.warn("No audio transceiver with mid "+t),!0)}return!i.myStream.getAudioTracks()[0].enabled}function ae(e,t,r,n){var i=D[e];if(!i||!i.webrtcStuff)return b.warn("Invalid handle"),!1;var s=i.webrtcStuff;if(!s.pc)return b.warn("Invalid PeerConnection"),!1;if(!s.myStream)return b.warn("Invalid local MediaStream"),!1;if(r){if(!s.myStream.getVideoTracks()||0===s.myStream.getVideoTracks().length)return b.warn("No video track"),!1;if(t){var a=s.pc.getTransceivers().find((function(e){return e.mid===t&&"video"===e.receiver.track.kind}));if(!a)return b.warn("No video transceiver with mid "+t),!1;if(!a.sender||!a.sender.track)return b.warn("No video sender with mid "+t),!1;a.sender.track.enabled=!n}else{var c,u=o(s.myStream.getVideoTracks());try{for(u.s();!(c=u.n()).done;)c.value.enabled=!n}catch(e){u.e(e)}finally{u.f()}}}else{if(!s.myStream.getAudioTracks()||0===s.myStream.getAudioTracks().length)return b.warn("No audio track"),!1;if(t){var l=s.pc.getTransceivers().find((function(e){return e.mid===t&&"audio"===e.receiver.track.kind}));if(!l)return b.warn("No audio transceiver with mid "+t),!1;if(!l.sender||!l.sender.track)return b.warn("No audio sender with mid "+t),!1;l.sender.track.enabled=!n}else{var d,p=o(s.myStream.getAudioTracks());try{for(p.s();!(d=p.n()).done;)d.value.enabled=!n}catch(e){p.e(e)}finally{p.f()}}}return!0}function oe(e,t){var r=D[e];if(!r||!r.webrtcStuff)return b.warn("Invalid handle"),"Invalid handle";var n=r.webrtcStuff;if(!n.pc)return"Invalid PeerConnection";if(n.pc.getStats){var i=n.pc,s=t||"default";if(t){var a=n.pc.getTransceivers().find((function(e){return e.mid===t&&"video"===e.receiver.track.kind}));if(!a)return b.warn("No video transceiver with mid "+t),"No video transceiver with mid "+t;if(!a.receiver)return b.warn("No video receiver with mid "+t),"No video receiver with mid "+t;i=a.receiver}return n.bitrate[s]||(n.bitrate[s]={timer:null,bsnow:null,bsbefore:null,tsnow:null,tsbefore:null,value:"0 kbits/sec"}),n.bitrate[s].timer?n.bitrate[s].value:(b.log("Starting bitrate timer"+(t?" for mid "+t:"")+" (via getStats)"),n.bitrate[s].timer=setInterval((function(){i.getStats().then((function(e){e.forEach((function(e){if(e){var t=!1;if(("video"===e.mediaType||e.id.toLowerCase().indexOf("video")>-1)&&"inbound-rtp"===e.type&&e.id.indexOf("rtcp")<0?t=!0:"ssrc"!=e.type||!e.bytesReceived||"VP8"!==e.googCodecName&&""!==e.googCodecName||(t=!0),t)if(n.bitrate[s].bsnow=e.bytesReceived,n.bitrate[s].tsnow=e.timestamp,null===n.bitrate[s].bsbefore||null===n.bitrate[s].tsbefore)n.bitrate[s].bsbefore=n.bitrate[s].bsnow,n.bitrate[s].tsbefore=n.bitrate[s].tsnow;else{var r=n.bitrate[s].tsnow-n.bitrate[s].tsbefore;"safari"===b.webRTCAdapter.browserDetails.browser&&(r/=1e3);var i=Math.round(8*(n.bitrate[s].bsnow-n.bitrate[s].bsbefore)/r);"safari"===b.webRTCAdapter.browserDetails.browser&&(i=parseInt(i/1e3)),n.bitrate[s].value=i+" kbits/sec",n.bitrate[s].bsbefore=n.bitrate[s].bsnow,n.bitrate[s].tsbefore=n.bitrate[s].tsnow}}}))}))}),1e3),"0 kbits/sec")}return b.warn("Getting the video bitrate unsupported by browser"),"Feature unsupported by browser"}function ce(e,t,r){var n=D[e];if(n&&n.webrtcStuff){var i=n.webrtcStuff;if(i.pc){var s=i.pc.getTransceivers().find((function(e){return e.mid===t}));if(s)if(s.sender){var a=s.sender.getParameters();a&&a.encodings&&0!==a.encodings.length?a.encodings.length>1?b.warn("Ignoring bitrate for simulcast track, use sendEncodings for that"):isNaN(r)||r<0?b.warn("Invalid bitrate (must be a positive integer)"):(a.encodings[0].maxBitrate=r,s.sender.setParameters(a)):b.warn("No parameters encodings")}else b.warn("No sender for transceiver with mid",t);else b.warn("No transceiver with mid",t)}else b.warn("Invalid PeerConnection")}else b.warn("Invalid handle")}function ue(e){b.error("WebRTC error:",e)}function le(e,n){b.log("Cleaning WebRTC stuff");var i=D[e];if(i){var s=i.webrtcStuff;if(s){if(!0===n){var a={janus:"hangup",transaction:b.randomString(12)};i.token&&(a.token=i.token),x&&(a.apisecret=x),b.debug("Sending hangup request (handle="+e+"):"),b.debug(a),t?(a.session_id=O,a.handle_id=e,r.send(JSON.stringify(a))):b.httpAPICall(l+"/"+O+"/"+e,{verb:"POST",withCredentials:C,body:a})}for(var o in s.volume&&(s.volume.local&&s.volume.local.timer&&clearInterval(s.volume.local.timer),s.volume.remote&&s.volume.remote.timer&&clearInterval(s.volume.remote.timer)),s.bitrate)s.bitrate[o].timer&&clearInterval(s.bitrate[o].timer);s.bitrate={},!s.streamExternal&&s.myStream&&(b.log("Stopping local stream tracks"),b.stopAllTracks(s.myStream)),s.streamExternal=!1,s.myStream=null;try{s.pc.close()}catch(e){}s.pc=null,s.candidates=null,s.mySdp=null,s.remoteSdp=null,s.iceDone=!1,s.dataChannel={},s.dtmfSender=null,s.insertableStreams=!1}i.oncleanup()}}U(e),this.getServer=function(){return l},this.isConnected=function(){return E},this.reconnect=function(e){(e=e||{}).success="function"==typeof e.success?e.success:b.noop,e.error="function"==typeof e.error?e.error:b.noop,e.reconnect=!0,U(e)},this.getSessionId=function(){return O},this.getInfo=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:b.noop,e.error="function"==typeof e.error?e.error:b.noop,b.log("Getting info on Janus instance"),!E)return b.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=b.randomString(12),i={janus:"info",transaction:n};if(w&&(i.token=w),x&&(i.apisecret=x),t)return A[n]=function(t){b.log("Server info:"),b.debug(t),"server_info"!==t.janus&&b.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},void r.send(JSON.stringify(i));b.httpAPICall(l,{verb:"POST",withCredentials:C,body:i,success:function(t){b.log("Server info:"),b.debug(t),"server_info"!==t.janus&&b.error("Ooops: "+t.error.code+" "+t.error.reason),e.success(t)},error:function(t,r){b.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)},this.destroy=function(i){!function(i){(i=i||{}).success="function"==typeof i.success?i.success:b.noop,i.error="function"==typeof i.error?i.error:b.noop;var s=!0===i.unload,o=!0;void 0!==i.notifyDestroyed&&null!==i.notifyDestroyed&&(o=!0===i.notifyDestroyed);var c=!0===i.cleanupHandles;if(b.log("Destroying session "+O+" (unload="+s+")"),!O)return b.warn("No session to destroy"),i.success(),void(o&&e.destroyed());if(c)for(var u in D)V(u,{noRequest:!0});if(!E)return b.warn("Is the server down? (connected=false)"),O=null,void i.success();var p={janus:"destroy",transaction:b.randomString(12)};if(w&&(p.token=w),x&&(p.apisecret=x),s)return t?(r.onclose=null,r.close(),r=null):d.sendBeacon(l+"/"+O,JSON.stringify(p)),b.log("Destroyed session:"),O=null,E=!1,i.success(),void(o&&e.destroyed());if(t){p.session_id=O;var h=function(){for(var e in n)r.removeEventListener(e,n[e]);r.removeEventListener("message",f),r.removeEventListener("error",m),a&&clearTimeout(a),r.close()},f=function(t){var r=JSON.parse(t.data);r.session_id==p.session_id&&r.transaction==p.transaction&&(h(),i.success(),o&&e.destroyed())},m=function(){h(),i.error("Failed to destroy the server: Is the server down?"),o&&e.destroyed()};return r.addEventListener("message",f),r.addEventListener("error",m),void(1===r.readyState?r.send(JSON.stringify(p)):m())}b.httpAPICall(l+"/"+O,{verb:"POST",withCredentials:C,body:p,success:function(t){b.log("Destroyed session:"),b.debug(t),O=null,E=!1,"success"!==t.janus&&b.error("Ooops: "+t.error.code+" "+t.error.reason),i.success(),o&&e.destroyed()},error:function(t,r){b.error(t+":",r),O=null,E=!1,i.success(),o&&e.destroyed()}})}(i)},this.attach=function(e){!function(e){if((e=e||{}).success="function"==typeof e.success?e.success:b.noop,e.error="function"==typeof e.error?e.error:b.noop,e.dataChannelOptions=e.dataChannelOptions||{ordered:!0},e.consentDialog="function"==typeof e.consentDialog?e.consentDialog:b.noop,e.iceState="function"==typeof e.iceState?e.iceState:b.noop,e.mediaState="function"==typeof e.mediaState?e.mediaState:b.noop,e.webrtcState="function"==typeof e.webrtcState?e.webrtcState:b.noop,e.slowLink="function"==typeof e.slowLink?e.slowLink:b.noop,e.onmessage="function"==typeof e.onmessage?e.onmessage:b.noop,e.onlocaltrack="function"==typeof e.onlocaltrack?e.onlocaltrack:b.noop,e.onremotetrack="function"==typeof e.onremotetrack?e.onremotetrack:b.noop,e.ondata="function"==typeof e.ondata?e.ondata:b.noop,e.ondataopen="function"==typeof e.ondataopen?e.ondataopen:b.noop,e.oncleanup="function"==typeof e.oncleanup?e.oncleanup:b.noop,e.ondetached="function"==typeof e.ondetached?e.ondetached:b.noop,!E)return b.warn("Is the server down? (connected=false)"),void e.error("Is the server down? (connected=false)");var n=e.plugin;if(!n)return b.error("Invalid plugin"),void e.error("Invalid plugin");var i=e.opaqueId,s=e.loopIndex,a=e.token?e.token:w,o=b.randomString(12),c={janus:"attach",plugin:n,opaque_id:i,loop_index:s,transaction:o};if(a&&(c.token=a),x&&(c.apisecret=x),t)return A[o]=function(t){if(b.debug(t),"success"!==t.janus)return b.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;b.log("Created handle: "+r);var i={session:L,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(e,t){return ie(r,e,!0,t)},getRemoteVolume:function(e,t){return ie(r,e,!0,t)},getLocalVolume:function(e,t){return ie(r,e,!1,t)},isAudioMuted:function(e){return se(r,e,!1)},muteAudio:function(e){return ae(r,e,!1,!0)},unmuteAudio:function(e){return ae(r,e,!1,!1)},isVideoMuted:function(e){return se(r,e,!0)},muteVideo:function(e){return ae(r,e,!0,!0)},unmuteVideo:function(e){return ae(r,e,!0,!1)},getBitrate:function(e){return oe(r,e)},setMaxBitrate:function(e,t){return ce(r,e,t)},send:function(e){N(r,e)},data:function(e){F(r,e)},dtmf:function(e){q(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(r,!0,e)},createAnswer:function(e){B(r,!1,e)},handleRemoteJsep:function(e){H(r,e)},replaceTracks:function(e){Y(r,e)},getLocalTracks:function(){return re(r)},getRemoteTracks:function(){return ne(r)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){le(r,!0===e)},detach:function(e){V(r,e)}};D[r]=i,e.success(i)},c.session_id=O,void r.send(JSON.stringify(c));b.httpAPICall(l+"/"+O,{verb:"POST",withCredentials:C,body:c,success:function(t){if(b.debug(t),"success"!==t.janus)return b.error("Ooops: "+t.error.code+" "+t.error.reason),void e.error("Ooops: "+t.error.code+" "+t.error.reason);var r=t.data.id;b.log("Created handle: "+r);var i={session:L,plugin:n,id:r,token:a,detached:!1,webrtcStuff:{started:!1,myStream:null,streamExternal:!1,mySdp:null,mediaConstraints:null,pc:null,dataChannelOptions:e.dataChannelOptions,dataChannel:{},dtmfSender:null,trickle:!0,iceDone:!1,bitrate:{}},getId:function(){return r},getPlugin:function(){return n},getVolume:function(e,t){return ie(r,e,!0,t)},getRemoteVolume:function(e,t){return ie(r,e,!0,t)},getLocalVolume:function(e,t){return ie(r,e,!1,t)},isAudioMuted:function(e){return se(r,e,!1)},muteAudio:function(e){return ae(r,e,!1,!0)},unmuteAudio:function(e){return ae(r,e,!1,!1)},isVideoMuted:function(e){return se(r,e,!0)},muteVideo:function(e){return ae(r,e,!0,!0)},unmuteVideo:function(e){return ae(r,e,!0,!1)},getBitrate:function(e){return oe(r,e)},setMaxBitrate:function(e,t){return ce(r,e,t)},send:function(e){N(r,e)},data:function(e){F(r,e)},dtmf:function(e){q(r,e)},consentDialog:e.consentDialog,iceState:e.iceState,mediaState:e.mediaState,webrtcState:e.webrtcState,slowLink:e.slowLink,onmessage:e.onmessage,createOffer:function(e){B(r,!0,e)},createAnswer:function(e){B(r,!1,e)},handleRemoteJsep:function(e){H(r,e)},replaceTracks:function(e){Y(r,e)},getLocalTracks:function(){return re(r)},getRemoteTracks:function(){return ne(r)},onlocaltrack:e.onlocaltrack,onremotetrack:e.onremotetrack,ondata:e.ondata,ondataopen:e.ondataopen,oncleanup:e.oncleanup,ondetached:e.ondetached,hangup:function(e){le(r,!0===e)},detach:function(e){V(r,e)}};D[r]=i,e.success(i)},error:function(t,r){b.error(t+":",r),""===r?e.error(t+": Is the server down?"):e.error(t+": "+r)}})}(e)}}b.useDefaultDependencies=function(e){var t=e&&e.fetch||fetch,r=e&&e.Promise||Promise,n=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new n(e,t)},extension:e&&e.extension||y,isArray:function(e){return Array.isArray(e)},webRTCAdapter:e&&e.adapter||l,httpAPICall:function(e,n){var i={method:n.verb,headers:{Accept:"application/json, text/plain, */*"},cache:"no-cache"};"POST"===n.verb&&(i.headers["Content-Type"]="application/json"),void 0!==n.withCredentials&&(i.credentials=!0===n.withCredentials?"include":n.withCredentials?n.withCredentials:"omit"),n.body&&(i.body=JSON.stringify(n.body));var s=t(e,i).catch((function(e){return r.reject({message:"Probably a network error, is the server down?",error:e})}));if(n.timeout){var o=new r((function(e,t){var r=setTimeout((function(){return clearTimeout(r),t({message:"Request timed out",timeout:n.timeout})}),n.timeout)}));s=r.race([s,o])}return s.then((function(e){return e.ok?(0,a.default)(n.success)===(0,a.default)(b.noop)?e.json().then((function(e){try{n.success(e)}catch(e){b.error("Unhandled httpAPICall success callback error",e)}}),(function(t){return r.reject({message:"Failed to parse response body",error:t,response:e})})):void 0:r.reject({message:"API call failed",response:e})})).catch((function(e){(0,a.default)(n.error)===(0,a.default)(b.noop)&&n.error(e.message||"<< internal error >>",e)})),s}}},b.useOldDependencies=function(e){var t=e&&e.jQuery||jQuery,r=e&&e.WebSocket||WebSocket;return{newWebSocket:function(e,t){return new r(e,t)},isArray:function(e){return t.isArray(e)},extension:e&&e.extension||y,webRTCAdapter:e&&e.adapter||l,httpAPICall:function(e,r){var n=void 0!==r.body?{contentType:"application/json",data:JSON.stringify(r.body)}:{},i=void 0!==r.withCredentials?{xhrFields:{withCredentials:r.withCredentials}}:{};return t.ajax(t.extend(n,i,{url:e,type:r.verb,cache:!1,dataType:"json",async:r.async,timeout:r.timeout,success:function(e){(0,a.default)(r.success)===(0,a.default)(b.noop)&&r.success(e)},error:function(e,t,n){(0,a.default)(r.error)===(0,a.default)(b.noop)&&r.error(t,n)}}))}}},b.mediaToTracks=function(e){var t=[];if(e){if(!e.keepAudio&&!1!==e.audio&&(void 0===e.audio||e.audio||e.audioSend||e.audioRecv||e.addAudio||e.replaceAudio||e.removeAudio)){var r={type:"audio"};e.removeAudio?r.remove=!0:(e.addAudio?r.add=!0:e.replaceAudio&&(r.replace=!0),!1!==e.audioSend&&(r.capture=e.audio||!0),!1!==e.audioRecv&&(r.recv=!0)),(r.remove||r.capture||r.recv)&&t.push(r)}if(!e.keepVideo&&!1!==e.video&&(void 0===e.video||e.video||e.videoSend||e.videoRecv||e.addVideo||e.replaceVideo||e.removeVideo)){var n={type:"video"};e.removeVideo?n.remove=!0:(e.addVideo?n.add=!0:e.replaceVideo&&(n.replace=!0),!1!==e.videoSend&&(n.capture=e.video||!0,["screen","window","desktop"].includes(n.capture)&&(n.type="screen",n.capture={video:{}},e.screenshareFrameRate&&(n.capture.frameRate=e.screenshareFrameRate),e.screenshareHeight&&(n.capture.height=e.screenshareHeight),e.screenshareWidth&&(n.capture.width=e.screenshareWidth))),!1!==e.videoRecv&&(n.recv=!0)),(n.remove||n.capture||n.recv)&&t.push(n)}e.data&&t.push({type:"data"})}else t.push({type:"audio",capture:!0,recv:!0}),t.push({type:"video",capture:!0,recv:!0});return t},b.trackConstraints=function(e){var t={};if(!e||!e.capture)return t;if("audio"===e.type)t.audio=e.capture;else if("video"===e.type)if((e.simulcast||e.svc)&&!0===e.capture&&(e.capture="hires"),!0===e.capture||"object"===(0,a.default)(e.capture))t.video=e.capture;else{var r=0,n=0;"lowres"===e.capture?(r=320,n=240):"lowres-16:9"===e.capture?(r=320,n=180):"hires"===e.capture||"hires-16:9"===e.capture||"hdres"===e.capture?(r=1280,n=720):"fhdres"===e.capture?(r=1920,n=1080):"4kres"===e.capture?(r=3840,n=2160):"stdres"===e.capture?(r=640,n=480):"stdres-16:9"===e.capture?(r=640,n=360):(b.log("Default video setting is stdres 4:3"),r=640,n=480),t.video={width:{ideal:r},height:{ideal:n}}}else"screen"===e.type&&(t.video=e.capture);return t},b.noop=function(){},b.dataChanDefaultLabel="JanusDataChannel",b.endOfCandidates=null,b.stopAllTracks=function(e){try{var t,r=o(e.getTracks());try{for(r.s();!(t=r.n()).done;){var n=t.value;b.log(n),n&&!0!==n.dontStop&&n.stop()}}catch(e){r.e(e)}finally{r.f()}}catch(e){}},b.init=function(e){if((e=e||{}).callback="function"==typeof e.callback?e.callback:b.noop,b.initDone)e.callback();else{if(void 0===console.log&&(console.log=function(){}),b.trace=b.noop,b.debug=b.noop,b.vdebug=b.noop,b.log=b.noop,b.warn=b.noop,b.error=b.noop,!0===e.debug||"all"===e.debug)b.trace=console.trace.bind(console),b.debug=console.debug.bind(console),b.vdebug=console.debug.bind(console),b.log=console.log.bind(console),b.warn=console.warn.bind(console),b.error=console.error.bind(console);else if(Array.isArray(e.debug)){var t,r=o(e.debug);try{for(r.s();!(t=r.n()).done;){var n=t.value;switch(n){case"trace":b.trace=console.trace.bind(console);break;case"debug":b.debug=console.debug.bind(console);break;case"vdebug":b.vdebug=console.debug.bind(console);break;case"log":b.log=console.log.bind(console);break;case"warn":b.warn=console.warn.bind(console);break;case"error":b.error=console.error.bind(console);break;default:console.error("Unknown debugging option '"+n+"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')")}}}catch(e){r.e(e)}finally{r.f()}}b.log("Initializing library");var i=e.dependencies||b.useDefaultDependencies();if(b.isArray=i.isArray,b.webRTCAdapter=i.webRTCAdapter,b.httpAPICall=i.httpAPICall,b.newWebSocket=i.newWebSocket,b.extension=i.extension,b.extension.init(),b.listDevices=function(e,t){e="function"==typeof e?e:b.noop,t||(t={audio:!0,video:!0}),b.isGetUserMediaAvailable()?d.mediaDevices.getUserMedia(t).then((function(t){d.mediaDevices.enumerateDevices().then((function(r){b.debug(r),e(r),b.stopAllTracks(t)}))})).catch((function(t){b.error(t),e([])})):(b.warn("navigator.mediaDevices unavailable"),e([]))},b.safariVp8=!1,"safari"===b.webRTCAdapter.browserDetails.browser&&b.webRTCAdapter.browserDetails.version>=605)if(v&&v.getCapabilities&&v.getCapabilities("video")&&v.getCapabilities("video").codecs&&v.getCapabilities("video").codecs.length){var s,a=o(v.getCapabilities("video").codecs);try{for(a.s();!(s=a.n()).done;){var c=s.value;if(c&&c.mimeType&&"video/vp8"===c.mimeType.toLowerCase()){b.safariVp8=!0;break}}}catch(e){a.e(e)}finally{a.f()}b.safariVp8?b.log("This version of Safari supports VP8"):b.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu")}else{var u=new f({});u.createOffer({offerToReceiveVideo:!0}).then((function(e){b.safariVp8=-1!==e.sdp.indexOf("VP8"),b.safariVp8?b.log("This version of Safari supports VP8"):b.warn("This version of Safari does NOT support VP8: if you're using a Technology Preview, try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu"),u.close(),u=null}))}b.initDone=!0,e.callback()}},b.isWebrtcSupported=function(){return!!f},b.isGetUserMediaAvailable=function(){return d.mediaDevices&&d.mediaDevices.getUserMedia},b.randomString=function(e){for(var t="",r=0;r<e;r++){var n=Math.floor(62*Math.random());t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n)}return t},e.exports=b},9021:function(e,t,r){var n;e.exports=(n=n||function(e){var t;if("undefined"!=typeof window&&window.crypto&&(t=window.crypto),"undefined"!=typeof self&&self.crypto&&(t=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(t=globalThis.crypto),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==r.g&&r.g.crypto&&(t=r.g.crypto),!t)try{t=r(477)}catch(e){}var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},i=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),s={},a=s.lib={},o=a.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=o.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,r=e.words,n=this.sigBytes,i=e.sigBytes;if(this.clamp(),n%4)for(var s=0;s<i;s++){var a=r[s>>>2]>>>24-s%4*8&255;t[n+s>>>2]|=a<<24-(n+s)%4*8}else for(var o=0;o<i;o+=4)t[n+o>>>2]=r[o>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=4294967295<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=o.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(n());return new c.init(t,e)}}),u=s.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var s=t[i>>>2]>>>24-i%4*8&255;n.push((s>>>4).toString(16)),n.push((15&s).toString(16))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n+=2)r[n>>>3]|=parseInt(e.substr(n,2),16)<<24-n%8*4;return new c.init(r,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,n=[],i=0;i<r;i++){var s=t[i>>>2]>>>24-i%4*8&255;n.push(String.fromCharCode(s))}return n.join("")},parse:function(e){for(var t=e.length,r=[],n=0;n<t;n++)r[n>>>2]|=(255&e.charCodeAt(n))<<24-n%4*8;return new c.init(r,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=o.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,n=this._data,i=n.words,s=n.sigBytes,a=this.blockSize,o=s/(4*a),u=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*a,l=e.min(4*u,s);if(u){for(var d=0;d<u;d+=a)this._doProcessBlock(i,d);r=i.splice(0,u),n.sigBytes-=l}return new c.init(r,l)},clone:function(){var e=o.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),f=(a.Hasher=h.extend({cfg:o.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new f.HMAC.init(e,r).finalize(t)}}}),s.algo={});return s}(Math),n)},7327:function(e,t,r){var n;e.exports=(n=r(9021),r(5471),r(1025),n.HmacSHA1)},3793:function(e,t,r){var n;e.exports=(n=r(9021),r(3009),r(1025),n.HmacSHA256)},1025:function(e,t,r){var n,i,s;e.exports=(i=(n=r(9021)).lib.Base,s=n.enc.Utf8,void(n.algo.HMAC=i.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var r=e.blockSize,n=4*r;t.sigBytes>n&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),o=i.words,c=a.words,u=0;u<r;u++)o[u]^=1549556828,c[u]^=909522486;i.sigBytes=a.sigBytes=n,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})))},5471:function(e,t,r){var n,i,s,a,o,c,u,l;e.exports=(i=(n=l=r(9021)).lib,s=i.WordArray,a=i.Hasher,o=n.algo,c=[],u=o.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],s=r[2],a=r[3],o=r[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(n<<5|n>>>27)+o+c[u];d+=u<20?1518500249+(i&s|~i&a):u<40?1859775393+(i^s^a):u<60?(i&s|i&a|s&a)-1894007588:(i^s^a)-899497514,o=a,a=s,s=i<<30|i>>>2,i=n,n=d}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+o|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,n=8*e.sigBytes;return t[n>>>5]|=128<<24-n%32,t[14+(n+64>>>9<<4)]=Math.floor(r/4294967296),t[15+(n+64>>>9<<4)]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),n.SHA1=a._createHelper(u),n.HmacSHA1=a._createHmacHelper(u),l.SHA1)},3009:function(e,t,r){var n;e.exports=(n=r(9021),function(e){var t=n,r=t.lib,i=r.WordArray,s=r.Hasher,a=t.algo,o=[],c=[];!function(){function t(t){for(var r=e.sqrt(t),n=2;n<=r;n++)if(!(t%n))return!1;return!0}function r(e){return 4294967296*(e-(0|e))|0}for(var n=2,i=0;i<64;)t(n)&&(i<8&&(o[i]=r(e.pow(n,.5))),c[i]=r(e.pow(n,1/3)),i++),n++}();var u=[],l=a.SHA256=s.extend({_doReset:function(){this._hash=new i.init(o.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,n=r[0],i=r[1],s=r[2],a=r[3],o=r[4],l=r[5],d=r[6],p=r[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var f=u[h-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,v=u[h-2],g=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;u[h]=m+u[h-7]+g+u[h-16]}var y=n&i^n&s^i&s,b=(n<<30|n>>>2)^(n<<19|n>>>13)^(n<<10|n>>>22),k=p+((o<<26|o>>>6)^(o<<21|o>>>11)^(o<<7|o>>>25))+(o&l^~o&d)+c[h]+u[h];p=d,d=l,l=o,o=a+k|0,a=s,s=i,i=n,n=k+(b+y)|0}r[0]=r[0]+n|0,r[1]=r[1]+i|0,r[2]=r[2]+s|0,r[3]=r[3]+a|0,r[4]=r[4]+o|0,r[5]=r[5]+l|0,r[6]=r[6]+d|0,r[7]=r[7]+p|0},_doFinalize:function(){var t=this._data,r=t.words,n=8*this._nDataBytes,i=8*t.sigBytes;return r[i>>>5]|=128<<24-i%32,r[14+(i+64>>>9<<4)]=e.floor(n/4294967296),r[15+(i+64>>>9<<4)]=n,t.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(l),t.HmacSHA256=s._createHmacHelper(l)}(Math),n.SHA256)},7007:e=>{"use strict";var t,r="object"==typeof Reflect?Reflect:null,n=r&&"function"==typeof r.apply?r.apply:function(e,t,r){return Function.prototype.apply.call(e,t,r)};t=r&&"function"==typeof r.ownKeys?r.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var i=Number.isNaN||function(e){return e!=e};function s(){s.init.call(this)}e.exports=s,e.exports.once=function(e,t){return new Promise((function(r,n){function i(r){e.removeListener(t,s),n(r)}function s(){"function"==typeof e.removeListener&&e.removeListener("error",i),r([].slice.call(arguments))}m(e,t,s,{once:!0}),"error"!==t&&function(e,t){"function"==typeof e.on&&m(e,"error",t,{once:!0})}(e,i)}))},s.EventEmitter=s,s.prototype._events=void 0,s.prototype._eventsCount=0,s.prototype._maxListeners=void 0;var a=10;function o(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function c(e){return void 0===e._maxListeners?s.defaultMaxListeners:e._maxListeners}function u(e,t,r,n){var i,s,a,u;if(o(r),void 0===(s=e._events)?(s=e._events=Object.create(null),e._eventsCount=0):(void 0!==s.newListener&&(e.emit("newListener",t,r.listener?r.listener:r),s=e._events),a=s[t]),void 0===a)a=s[t]=r,++e._eventsCount;else if("function"==typeof a?a=s[t]=n?[r,a]:[a,r]:n?a.unshift(r):a.push(r),(i=c(e))>0&&a.length>i&&!a.warned){a.warned=!0;var l=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");l.name="MaxListenersExceededWarning",l.emitter=e,l.type=t,l.count=a.length,u=l,console&&console.warn&&console.warn(u)}return e}function l(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function d(e,t,r){var n={fired:!1,wrapFn:void 0,target:e,type:t,listener:r},i=l.bind(n);return i.listener=r,n.wrapFn=i,i}function p(e,t,r){var n=e._events;if(void 0===n)return[];var i=n[t];return void 0===i?[]:"function"==typeof i?r?[i.listener||i]:[i]:r?function(e){for(var t=new Array(e.length),r=0;r<t.length;++r)t[r]=e[r].listener||e[r];return t}(i):f(i,i.length)}function h(e){var t=this._events;if(void 0!==t){var r=t[e];if("function"==typeof r)return 1;if(void 0!==r)return r.length}return 0}function f(e,t){for(var r=new Array(t),n=0;n<t;++n)r[n]=e[n];return r}function m(e,t,r,n){if("function"==typeof e.on)n.once?e.once(t,r):e.on(t,r);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(s){n.once&&e.removeEventListener(t,i),r(s)}))}}Object.defineProperty(s,"defaultMaxListeners",{enumerable:!0,get:function(){return a},set:function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");a=e}}),s.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},s.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||i(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},s.prototype.getMaxListeners=function(){return c(this)},s.prototype.emit=function(e){for(var t=[],r=1;r<arguments.length;r++)t.push(arguments[r]);var i="error"===e,s=this._events;if(void 0!==s)i=i&&void 0===s.error;else if(!i)return!1;if(i){var a;if(t.length>0&&(a=t[0]),a instanceof Error)throw a;var o=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw o.context=a,o}var c=s[e];if(void 0===c)return!1;if("function"==typeof c)n(c,this,t);else{var u=c.length,l=f(c,u);for(r=0;r<u;++r)n(l[r],this,t)}return!0},s.prototype.addListener=function(e,t){return u(this,e,t,!1)},s.prototype.on=s.prototype.addListener,s.prototype.prependListener=function(e,t){return u(this,e,t,!0)},s.prototype.once=function(e,t){return o(t),this.on(e,d(this,e,t)),this},s.prototype.prependOnceListener=function(e,t){return o(t),this.prependListener(e,d(this,e,t)),this},s.prototype.removeListener=function(e,t){var r,n,i,s,a;if(o(t),void 0===(n=this._events))return this;if(void 0===(r=n[e]))return this;if(r===t||r.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,r.listener||t));else if("function"!=typeof r){for(i=-1,s=r.length-1;s>=0;s--)if(r[s]===t||r[s].listener===t){a=r[s].listener,i=s;break}if(i<0)return this;0===i?r.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(r,i),1===r.length&&(n[e]=r[0]),void 0!==n.removeListener&&this.emit("removeListener",e,a||t)}return this},s.prototype.off=s.prototype.removeListener,s.prototype.removeAllListeners=function(e){var t,r,n;if(void 0===(r=this._events))return this;if(void 0===r.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==r[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete r[e]),this;if(0===arguments.length){var i,s=Object.keys(r);for(n=0;n<s.length;++n)"removeListener"!==(i=s[n])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=r[e]))this.removeListener(e,t);else if(void 0!==t)for(n=t.length-1;n>=0;n--)this.removeListener(e,t[n]);return this},s.prototype.listeners=function(e){return p(this,e,!0)},s.prototype.rawListeners=function(e){return p(this,e,!1)},s.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):h.call(e,t)},s.prototype.listenerCount=h,s.prototype.eventNames=function(){return this._eventsCount>0?t(this._events):[]}},2881:(e,t,r)=>{var n={EventEmitter:r(4566),EmitterSubscription:r(7274)};e.exports=n},4566:(e,t,r)=>{"use strict";var n=r(7274),i=r(9402),s=r(646),a=r(9395),o=function(){function e(){this._subscriber=new i,this._currentSubscription=null}var t=e.prototype;return t.addListener=function(e,t,r){return this._subscriber.addSubscription(e,new n(this._subscriber,t,r))},t.once=function(e,t,r){var n=this;return this.addListener(e,(function(){n.removeCurrentListener(),t.apply(r,arguments)}))},t.removeAllListeners=function(e){this._subscriber.removeAllSubscriptions(e)},t.removeCurrentListener=function(){this._currentSubscription||s(!1),this._subscriber.removeSubscription(this._currentSubscription)},t.listeners=function(e){var t=this._subscriber.getSubscriptionsForType(e);return t?t.filter(a.thatReturnsTrue).map((function(e){return e.listener})):[]},t.emit=function(e){var t=this._subscriber.getSubscriptionsForType(e);if(t){for(var r=Object.keys(t),n=0;n<r.length;n++){var i=t[r[n]];i&&(this._currentSubscription=i,this.__emitToSubscription.apply(this,[i].concat(Array.prototype.slice.call(arguments))))}this._currentSubscription=null}},t.__emitToSubscription=function(e,t){var r=Array.prototype.slice.call(arguments,2);e.listener.apply(e.context,r)},e}();e.exports=o},7274:(e,t,r)=>{"use strict";var n=function(e){var t,r;function n(t,r,n){var i;return(i=e.call(this,t)||this).listener=r,i.context=n,i}return r=e,(t=n).prototype=Object.create(r.prototype),t.prototype.constructor=t,t.__proto__=r,n}(r(5856));e.exports=n},5856:e=>{"use strict";var t=function(){function e(e){this.subscriber=e}return e.prototype.remove=function(){this.subscriber&&(this.subscriber.removeSubscription(this),this.subscriber=null)},e}();e.exports=t},9402:(e,t,r)=>{"use strict";var n=r(646),i=function(){function e(){this._subscriptionsForType={},this._currentSubscription=null}var t=e.prototype;return t.addSubscription=function(e,t){t.subscriber!==this&&n(!1),this._subscriptionsForType[e]||(this._subscriptionsForType[e]=[]);var r=this._subscriptionsForType[e].length;return this._subscriptionsForType[e].push(t),t.eventType=e,t.key=r,t},t.removeAllSubscriptions=function(e){void 0===e?this._subscriptionsForType={}:delete this._subscriptionsForType[e]},t.removeSubscription=function(e){var t=e.eventType,r=e.key,n=this._subscriptionsForType[t];n&&delete n[r]},t.getSubscriptionsForType=function(e){return this._subscriptionsForType[e]},e}();e.exports=i},9395:e=>{"use strict";function t(e){return function(){return e}}var r=function(){};r.thatReturns=t,r.thatReturnsFalse=t(!1),r.thatReturnsTrue=t(!0),r.thatReturnsNull=t(null),r.thatReturnsThis=function(){return this},r.thatReturnsArgument=function(e){return e},e.exports=r},646:e=>{"use strict";e.exports=function(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(!e){var s;if(void 0===t)s=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var a=0;(s=new Error(t.replace(/%s/g,(function(){return String(n[a++])})))).name="Invariant Violation"}throw s.framesToPop=1,s}}},8287:e=>{"use strict";e.exports=function(e){if(!Array.isArray(e))throw new TypeError("Middleware stack must be an array!");for(const t of e)if("function"!=typeof t)throw new TypeError("Middleware must be composed of functions!");return function(t,r){let n=-1;return function i(s){if(s<=n)return Promise.reject(new Error("next() called multiple times"));n=s;let a=e[s];if(s===e.length&&(a=r),!a)return Promise.resolve();try{return Promise.resolve(a(t,i.bind(null,s+1)))}catch(e){return Promise.reject(e)}}(0)}}},4011:function(e,t,r){!function(e,t){function r(){}r.prototype.name="ANONYMOUS",r.prototype.clientFirst=!0,r.prototype.response=function(e){return e.trace||""},r.prototype.challenge=function(e){},t.exports=r}(0,e=r.nmd(e))},3481:function(e,t,r){!function(e,t,r){(t.exports=r).Mechanism=r}(0,e=r.nmd(e),r(4011))},7474:function(e,t,r){!function(e,t){function r(){}r.prototype.name="PLAIN",r.prototype.clientFirst=!0,r.prototype.response=function(e){var t="";return t+=e.authzid||"",t+="\0",t+=e.username,(t+="\0")+e.password},r.prototype.challenge=function(e){return this},t.exports=r}(0,e=r.nmd(e))},1978:function(e,t,r){!function(e,t,r){(t.exports=r).Mechanism=r}(0,e=r.nmd(e),r(7474))},2074:function(e,t,r){!function(e,t){function r(){this._mechs=[]}r.prototype.use=function(e,t){return t||(e=(t=e).prototype.name),this._mechs.push({name:e,mech:t}),this},r.prototype.create=function(e){for(var t=0,r=this._mechs.length;t<r;t++)for(var n=0,i=e.length;n<i;n++){var s=this._mechs[t];if(s.name==e[n])return new s.mech}return null},t.exports=r}(0,e=r.nmd(e))},5591:function(e,t,r){!function(e,t,r){(t.exports=r).Factory=r}(0,e=r.nmd(e),r(2074))},6245:e=>{"use strict";e.exports=t},8849:t=>{"use strict";t.exports=e},2969:()=>{},732:()=>{},477:()=>{},79:e=>{e.exports=function(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=Array(t);r<t;r++)n[r]=e[r];return n},e.exports.__esModule=!0,e.exports.default=e.exports},2987:e=>{e.exports=function(e){if(Array.isArray(e))return e},e.exports.__esModule=!0,e.exports.default=e.exports},9293:e=>{function t(e,t,r,n,i,s,a){try{var o=e[s](a),c=o.value}catch(e){return void r(e)}o.done?t(c):Promise.resolve(c).then(n,i)}e.exports=function(e){return function(){var r=this,n=arguments;return new Promise((function(i,s){var a=e.apply(r,n);function o(e){t(a,i,s,o,c,"next",e)}function c(e){t(a,i,s,o,c,"throw",e)}o(void 0)}))}},e.exports.__esModule=!0,e.exports.default=e.exports},7383:e=>{e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")},e.exports.__esModule=!0,e.exports.default=e.exports},4579:(e,t,r)=>{var n=r(7736);function i(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,n(i.key),i)}}e.exports=function(e,t,r){return t&&i(e.prototype,t),r&&i(e,r),Object.defineProperty(e,"prototype",{writable:!1}),e},e.exports.__esModule=!0,e.exports.default=e.exports},3693:(e,t,r)=>{var n=r(7736);e.exports=function(e,t,r){return(t=n(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e},e.exports.__esModule=!0,e.exports.default=e.exports},4994:e=>{e.exports=function(e){return e&&e.__esModule?e:{default:e}},e.exports.__esModule=!0,e.exports.default=e.exports},1156:e=>{e.exports=function(e,t){var r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var n,i,s,a,o=[],c=!0,u=!1;try{if(s=(r=r.call(e)).next,0===t){if(Object(r)!==r)return;c=!1}else for(;!(c=(n=s.call(r)).done)&&(o.push(n.value),o.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(u)throw i}}return o}},e.exports.__esModule=!0,e.exports.default=e.exports},7752:e=>{e.exports=function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")},e.exports.__esModule=!0,e.exports.default=e.exports},1847:(e,t,r)=>{var n=r(4893);e.exports=function(e,t){if(null==e)return{};var r,i,s=n(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)r=a[i],t.includes(r)||{}.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s},e.exports.__esModule=!0,e.exports.default=e.exports},4893:e=>{e.exports=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(t.includes(n))continue;r[n]=e[n]}return r},e.exports.__esModule=!0,e.exports.default=e.exports},5407:e=>{e.exports=function(e){throw new TypeError('"'+e+'" is read-only')},e.exports.__esModule=!0,e.exports.default=e.exports},4633:(e,t,r)=>{var n=r(3738).default;function i(){"use strict";e.exports=i=function(){return r},e.exports.__esModule=!0,e.exports.default=e.exports;var t,r={},s=Object.prototype,a=s.hasOwnProperty,o=Object.defineProperty||function(e,t,r){e[t]=r.value},c="function"==typeof Symbol?Symbol:{},u=c.iterator||"@@iterator",l=c.asyncIterator||"@@asyncIterator",d=c.toStringTag||"@@toStringTag";function p(e,t,r){return Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{p({},"")}catch(t){p=function(e,t,r){return e[t]=r}}function h(e,t,r,n){var i=t&&t.prototype instanceof k?t:k,s=Object.create(i.prototype),a=new A(n||[]);return o(s,"_invoke",{value:O(e,r,a)}),s}function f(e,t,r){try{return{type:"normal",arg:e.call(t,r)}}catch(e){return{type:"throw",arg:e}}}r.wrap=h;var m="suspendedStart",v="suspendedYield",g="executing",y="completed",b={};function k(){}function C(){}function S(){}var w={};p(w,u,(function(){return this}));var x=Object.getPrototypeOf,_=x&&x(x(j([])));_&&_!==s&&a.call(_,u)&&(w=_);var T=S.prototype=k.prototype=Object.create(w);function I(e){["next","throw","return"].forEach((function(t){p(e,t,(function(e){return this._invoke(t,e)}))}))}function E(e,t){function r(i,s,o,c){var u=f(e[i],e,s);if("throw"!==u.type){var l=u.arg,d=l.value;return d&&"object"==n(d)&&a.call(d,"__await")?t.resolve(d.__await).then((function(e){r("next",e,o,c)}),(function(e){r("throw",e,o,c)})):t.resolve(d).then((function(e){l.value=e,o(l)}),(function(e){return r("throw",e,o,c)}))}c(u.arg)}var i;o(this,"_invoke",{value:function(e,n){function s(){return new t((function(t,i){r(e,n,t,i)}))}return i=i?i.then(s,s):s()}})}function O(e,r,n){var i=m;return function(s,a){if(i===g)throw Error("Generator is already running");if(i===y){if("throw"===s)throw a;return{value:t,done:!0}}for(n.method=s,n.arg=a;;){var o=n.delegate;if(o){var c=D(o,n);if(c){if(c===b)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(i===m)throw i=y,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);i=g;var u=f(e,r,n);if("normal"===u.type){if(i=n.done?y:v,u.arg===b)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(i=y,n.method="throw",n.arg=u.arg)}}}function D(e,r){var n=r.method,i=e.iterator[n];if(i===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,D(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),b;var s=f(i,e.iterator,r.arg);if("throw"===s.type)return r.method="throw",r.arg=s.arg,r.delegate=null,b;var a=s.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,b):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,b)}function L(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function P(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function A(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(L,this),this.reset(!0)}function j(e){if(e||""===e){var r=e[u];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,s=function r(){for(;++i<e.length;)if(a.call(e,i))return r.value=e[i],r.done=!1,r;return r.value=t,r.done=!0,r};return s.next=s}}throw new TypeError(n(e)+" is not iterable")}return C.prototype=S,o(T,"constructor",{value:S,configurable:!0}),o(S,"constructor",{value:C,configurable:!0}),C.displayName=p(S,d,"GeneratorFunction"),r.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===C||"GeneratorFunction"===(t.displayName||t.name))},r.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,S):(e.__proto__=S,p(e,d,"GeneratorFunction")),e.prototype=Object.create(T),e},r.awrap=function(e){return{__await:e}},I(E.prototype),p(E.prototype,l,(function(){return this})),r.AsyncIterator=E,r.async=function(e,t,n,i,s){void 0===s&&(s=Promise);var a=new E(h(e,t,n,i),s);return r.isGeneratorFunction(t)?a:a.next().then((function(e){return e.done?e.value:a.next()}))},I(T),p(T,d,"Generator"),p(T,u,(function(){return this})),p(T,"toString",(function(){return"[object Generator]"})),r.keys=function(e){var t=Object(e),r=[];for(var n in t)r.push(n);return r.reverse(),function e(){for(;r.length;){var n=r.pop();if(n in t)return e.value=n,e.done=!1,e}return e.done=!0,e}},r.values=j,A.prototype={constructor:A,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(P),!e)for(var r in this)"t"===r.charAt(0)&&a.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function n(n,i){return o.type="throw",o.arg=e,r.next=n,i&&(r.method="next",r.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var s=this.tryEntries[i],o=s.completion;if("root"===s.tryLoc)return n("end");if(s.tryLoc<=this.prev){var c=a.call(s,"catchLoc"),u=a.call(s,"finallyLoc");if(c&&u){if(this.prev<s.catchLoc)return n(s.catchLoc,!0);if(this.prev<s.finallyLoc)return n(s.finallyLoc)}else if(c){if(this.prev<s.catchLoc)return n(s.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<s.finallyLoc)return n(s.finallyLoc)}}}},abrupt:function(e,t){for(var r=this.tryEntries.length-1;r>=0;--r){var n=this.tryEntries[r];if(n.tryLoc<=this.prev&&a.call(n,"finallyLoc")&&this.prev<n.finallyLoc){var i=n;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var s=i?i.completion:{};return s.type=e,s.arg=t,i?(this.method="next",this.next=i.finallyLoc,b):this.complete(s)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),b},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.finallyLoc===e)return this.complete(r.completion,r.afterLoc),P(r),b}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var r=this.tryEntries[t];if(r.tryLoc===e){var n=r.completion;if("throw"===n.type){var i=n.arg;P(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:j(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),b}},r}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},5715:(e,t,r)=>{var n=r(2987),i=r(1156),s=r(7122),a=r(7752);e.exports=function(e,t){return n(e)||i(e,t)||s(e,t)||a()},e.exports.__esModule=!0,e.exports.default=e.exports},9045:(e,t,r)=>{var n=r(3738).default;e.exports=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)},e.exports.__esModule=!0,e.exports.default=e.exports},7736:(e,t,r)=>{var n=r(3738).default,i=r(9045);e.exports=function(e){var t=i(e,"string");return"symbol"==n(t)?t:t+""},e.exports.__esModule=!0,e.exports.default=e.exports},3738:e=>{function t(r){return e.exports=t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(r)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},7122:(e,t,r)=>{var n=r(79);e.exports=function(e,t){if(e){if("string"==typeof e)return n(e,t);var r={}.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(e,t):void 0}},e.exports.__esModule=!0,e.exports.default=e.exports},4756:(e,t,r)=>{var n=r(4633)();e.exports=n;try{regeneratorRuntime=n}catch(e){"object"==typeof globalThis?globalThis.regeneratorRuntime=n:Function("r","regeneratorRuntime = r")(n)}},9022:(e,t,r)=>{"use strict";var n=r(611);class i{constructor(e,t){this.name=e,this.parent=null,this.children=[],this.attrs={},this.setAttrs(t)}is(e,t){return this.getName()===e&&(!t||this.getNS()===t)}getName(){const e=this.name.indexOf(":");return e>=0?this.name.slice(e+1):this.name}getNS(){const e=this.name.indexOf(":");if(e>=0){const t=this.name.slice(0,e);return this.findNS(t)}return this.findNS()}findNS(e){if(e){const t="xmlns:"+e;if(this.attrs[t])return this.attrs[t];if(this.parent)return this.parent.findNS(e)}else{if(this.attrs.xmlns)return this.attrs.xmlns;if(this.parent)return this.parent.findNS()}}getXmlns(){let e={};this.parent&&(e=this.parent.getXmlns());for(const t in this.attrs){const r=t.match("xmlns:?(.*)");this.attrs.hasOwnProperty(t)&&r&&(e[this.attrs[t]]=r[1])}return e}setAttrs(e){"string"==typeof e?this.attrs.xmlns=e:e&&Object.assign(this.attrs,e)}getAttr(e,t){if(!t)return this.attrs[e];const r=this.getXmlns();return r[t]?this.attrs[[r[t],e].join(":")]:null}getChild(e,t){return this.getChildren(e,t)[0]}getChildren(e,t){const r=[];for(const n of this.children)!n.getName||n.getName()!==e||t&&n.getNS()!==t||r.push(n);return r}getChildByAttr(e,t,r,n){return this.getChildrenByAttr(e,t,r,n)[0]}getChildrenByAttr(e,t,r,n){let i=[];for(const s of this.children)!s.attrs||s.attrs[e]!==t||r&&s.getNS()!==r||i.push(s),n&&s.getChildrenByAttr&&i.push(s.getChildrenByAttr(e,t,r,!0));return n&&(i=i.flat()),i}getChildrenByFilter(e,t){let r=[];for(const n of this.children)e(n)&&r.push(n),t&&n.getChildrenByFilter&&r.push(n.getChildrenByFilter(e,!0));return t&&(r=r.flat()),r}getText(){let e="";for(const t of this.children)"string"!=typeof t&&"number"!=typeof t||(e+=t);return e}getChildText(e,t){const r=this.getChild(e,t);return r?r.getText():null}getChildElements(){return this.getChildrenByFilter((e=>e instanceof i))}root(){return this.parent?this.parent.root():this}up(){return this.parent?this.parent:this}c(e,t){return this.cnode(new i(e,t))}cnode(e){return this.children.push(e),"object"==typeof e&&(e.parent=this),e}append(...e){for(const t of e)this.children.push(t),"object"==typeof t&&(t.parent=this)}prepend(...e){for(const t of e)this.children.unshift(t),"object"==typeof t&&(t.parent=this)}t(e){return this.children.push(e),this}remove(e,t){const r="string"==typeof e?r=>!(r.is&&r.is(e,t)):t=>t!==e;return this.children=this.children.filter(r),this}text(e){return e&&1===this.children.length?(this.children[0]=e,this):this.getText()}attr(e,t){return void 0!==t||null===t?(this.attrs||(this.attrs={}),this.attrs[e]=t,this):this.attrs[e]}toString(){let e="";return this.write((t=>{e+=t})),e}_addChildren(e){e(">");for(const t of this.children)null!=t&&(t.write?t.write(e):"string"==typeof t?e(n.escapeXMLText(t)):t.toString&&e(n.escapeXMLText(t.toString(10))));e("</"),e(this.name),e(">")}write(e){e("<"),e(this.name);for(const t in this.attrs){const r=this.attrs[t];null!=r&&(e(" "),e(t),e('="'),e(n.escapeXML("string"==typeof r?r:r.toString(10))),e('"'))}0===this.children.length?e("/>"):this._addChildren(e)}}i.prototype.tree=i.prototype.root,e.exports=i},7830:(e,t,r)=>{"use strict";var n=r(9022);function i(e,t){if(Array.isArray(t))for(const r of t)i(e,r);else""!==t&&null!=t&&!0!==t&&!1!==t&&e.cnode(t)}e.exports=function(e,t,...r){if("object"==typeof t&&null!==t){delete t.__source,delete t.__self;for(const[e,r]of Object.entries(t))null==r?delete t[e]:t[e]=r.toString(10)}const s=new n(e,t);for(const e of r)i(s,e);return s}},611:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&apos;"};function n(e){return r[e]}const i={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&apos;":"'"};function s(e){if("#"===e[1]){const t="x"===e[2]?parseInt(e.slice(3),16):parseInt(e.slice(2),10);if(9===t||10===t||13===t||t>=32&&t<=55295||t>=57344&&t<=65533||t>=65536&&t<=1114111)return String.fromCodePoint(t);throw new Error("Illegal XML character 0x"+t.toString(16))}if(i[e])return i[e]||e;throw new Error("Illegal XML entity "+e)}t.escapeXML=function(e){return e.replace(/["&'<>]/g,n)},t.escapeXMLText=function(e){return e.replace(/[&<>]/g,n)},t.unescapeXML=function(e){let t="",r=-1,n=-1,i=0;for(;-1!==(r=e.indexOf("&",i))&&-1!==(n=e.indexOf(";",r+1));)t=t+e.slice(i,r)+s(e.slice(r,n+1)),i=n+1;return 0===i?e:(t+=e.substring(i),t)},t.unescapeXMLText=function(e){return e.replace(/&(amp|#38|lt|#60|gt|#62);/g,s)}},9573:(e,t,r)=>{"use strict";var n=r(7007),i=r(611);class s extends n.EventEmitter{constructor(){super();let e,t,r,n,s,a,o,c,u,l=0,d=0;this._handleTagOpening=function(e,t,r){e?this.emit("endElement",t):(this.emit("startElement",t,r),a&&this.emit("endElement",t))},this.write=function(p){"string"!=typeof p&&(p=p.toString());let h=0;function f(){if("number"==typeof d){const e=p.slice(d,h);return d=void 0,e}}for(e&&(p=e+p,h+=t?0:e.length,t=!1,e=null);h<p.length;h++){switch(l){case 0:{const e=p.indexOf("<",h);-1!==e&&h!==e&&(h=e);break}case 8:{const e=p.indexOf(c,h);-1!==e&&(h=e);break}case 1:{const e=p.indexOf("--\x3e",h);-1!==e&&(h=e+2);break}case 10:{const e=p.indexOf("]]>",h);-1!==e&&(h=e+2);break}}const e=p.charCodeAt(h);switch(l){case 0:if(60===e){const e=f();e&&this.emit("text",i.unescapeXML(e)),l=3,d=h+1,n={}}break;case 9:if(93===e)if("]>"===p.substr(h+1,2)){const e=f();e&&this.emit("text",e),l=0}else p.length<h+2&&(t=!0,h=p.length);break;case 3:47===e&&d===h?(d=h+1,s=!0):33===e?"[CDATA["===p.substr(h+1,7)?(d=h+8,l=9):p.length<h+8&&"[CDATA[".startsWith(p.slice(h+1))?(t=!0,h=p.length):(d=void 0,l=1):63===e?(d=void 0,l=2):(e<=32||47===e||62===e)&&(r=f(),h--,l=4);break;case 1:if(62===e){const e=p.charCodeAt(h-1),t=p.charCodeAt(h-2);(45===e&&45===t||93===e&&93===t)&&(l=0)}break;case 2:62===e&&63===p.charCodeAt(h-1)&&(l=0);break;case 4:62===e?(this._handleTagOpening(s,r,n),r=void 0,n=void 0,s=void 0,a=void 0,l=0,d=h+1):47===e?a=!0:e>32&&(d=h,l=5);break;case 5:(e<=32||61===e)&&(u=f(),h--,l=6);break;case 6:61===e&&(l=7);break;case 7:34!==e&&39!==e||(o=e,c=34===e?'"':"'",l=8,d=h+1);break;case 8:if(e===o){const e=i.unescapeXML(f());n[u]=e,u=void 0,l=4}}}"number"==typeof d&&d<=p.length&&(e=p.slice(d),d=0)}}end(e){e&&this.write(e),this.write=function(){}}}e.exports=s},8330:e=>{"use strict";e.exports={rE:"3.35.1"}}},n={};function i(e){var t=n[e];if(void 0!==t)return t.exports;var s=n[e]={id:e,loaded:!1,exports:{}};return r[e].call(s.exports,s,s.exports,i),s.loaded=!0,s.exports}return i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.nmd=e=>(e.paths=[],e.children||(e.children=[]),e),i(3453)})()));
//# sourceMappingURL=connectycube.min.map